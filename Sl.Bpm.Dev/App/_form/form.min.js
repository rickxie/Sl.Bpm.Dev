/**** commonUltility.js *****/
_shared.service("fmTool",["mabp.app.module","mabp.app.bpm",function(n,t){return{LoadInitData:function(n,t){for(var i=n,u,r;!!i&&!i.base;)i=i.$parent;if(n.Init=t.pageState=="1"?!0:!1,u=!1,!n.Init&&i&&i.base.basicAndViewData)switch(n.datatype){case"view":if(!!i.base.basicAndViewData[n.datacode])for(r=0;r<i.base.basicAndViewData[n.datacode].length;r++)if(i.base.basicAndViewData[n.datacode][r][t.valueMember]==n.fmModel){n.selectItem=[i.base.basicAndViewData[n.datacode][r]];u=!0;break}break;case"dataitem":!i.base.basicAndViewData[n.datacode]||(n.items=i.base.basicAndViewData[n.datacode],u=!0)}n.Init=u},textInit:function(n){var t=n.integer!=undefined&&n.integer!="false",i=n.cny!=undefined&&n.cny!="false",r=n.datetime!=undefined&&n.date!="false",u=n.date!=undefined&&n.datetime!="false",f=n.time!=undefined&&n.time!="false",e=n.month!=undefined&&n.month!="false",o=n.creditcard!=undefined&&n.creditcard!="false";n.formatFunc=function(n){return n};switch(n.$ctrlType){case"fm-datetime":r?(n.view="datetime",n.minView="minutes",n.format="YYYY-MM-DD HH:mm",n.formatStr="YYYY-MM-DD HH:mm"):u?(n.view="date",n.minView="date",n.format="YYYY-MM-DD",n.formatStr="YYYY-MM-DD"):f?(n.view="hours",n.maxView="hours",n.minView="minutes",n.format="HH:mm",n.formatStr="HH:mm"):e&&(n.view="month",n.maxView="month",n.minView="month",n.format="YYYY-MM",n.formatStr="YYYY-MM");break;case"fm-number":t?(n.scale=n.scale||1,n.displayScale=n.displayScale||0,n.NumLength=n.NumLength||10,n.fmPattern="^(-?[0-9]{1,"+n.NumLength+"})?$"):i?(n.scale=n.scale||6,n.displayScale=n.displayScale||-1,n.maxDisplayScale=n.maxDisplayScale||-1,n.NumLength=n.NumLength||12,n.unit="",n.fmPattern="^(-?[0-9]{1,"+n.NumLength+"}(\\.([0-9]{1,"+n.scale+"})?)?)?$",n.formatFunc=function(t){var o,s,r;if(t==null||isNaN(t))return"";var f=parseFloat(t||0),i=""+f,u=0;f.toString().split(".").length>1&&(u=f.toString().split(".")[1].length);u<=2?i=""+f.pushZero(2):(u<=n.displayScale||u>6)&&(o=u>6?6:u,s=Math.max(o,n.displayScale),i=""+f.pushZero(s));n.maxDisplayScale>0&&u>n.maxDisplayScale&&(i=""+f.pushZero(n.maxDisplayScale));var e=[],h=i.lastIndexOf(".")==-1?i.length:i.lastIndexOf("."),c=0;for(r=i.length-1;r>=0;r--)if(e.splice(0,0,i[r]),(h-r)%3==0&&r!=0&&r<h-2){if(i[0]=="-"&&r==1)continue;e.splice(0,0,",");c++}return e.join("")}):(n.scale=n.scale||6,n.displayScale=n.displayScale||2,n.NumLength=n.NumLength||12,n.fmPattern=n.scale==0?"^(-?[0-9]{0,"+n.NumLength+"})?$":"^(-?[0-9]{1,"+n.NumLength+"}(\\.([0-9]{1,"+n.scale+"})?)?)?$");break;case"fm-text":case"fm-textarea":o&&(n.formatFunc=function(n){var r,i,t;if(!n||typeof n=="object")return"";for(r=(""+n).replace(/\s/g,""),i=[],t=r.length-1;t>=0;t--)i.splice(0,0,r[t]),t%4==0&&t!=0&&i.splice(0,0," ");return i.join("")})}},setScopeState:function(n,t){if(t.pageState=$("[page-state]").attr("page-state"),n.state=n.state||t.state,!!t.pageState)switch(""+t.pageState){case"1":n.pageState="normal";t.state=n.pageState;break;case"2":n.pageState="disabled";t.state=n.pageState}if(t.readonly!==undefined&&t.readonly!="false"?n.state="readonly":t.disabled!==undefined&&t.disabled!="false"?n.state="disabled":t.hidden!==undefined&&t.hidden!="false"?n.state="hidden":t.normal!==undefined&&t.normal!="false"?n.state="normal":n.state||(n.state=n.pageState||"normal"),n.datatype=n.datatype===undefined&&!!t.datatype?t.datatype:n.datatype,n.datatype||(n.datatype="source"),t.view!==undefined&&t.view.toLowerCase()!="false"?(n.datatype="view",t.view!=""&&(n.datacode=t.view)):t.source!==undefined&&t.source.toLowerCase()!="false"?n.datatype="source":t.dataitem!==undefined&&t.dataitem.toLowerCase()!="false"?(n.datatype="dataitem",t.dataitem!=""&&(n.datacode=t.dataitem)):t.group!==undefined&&t.group.toLowerCase()!="false"?(n.datatype="group",t.group!=""&&(n.datacode=t.group)):t.joblevel!==undefined&&t.joblevel.toLowerCase()!="false"&&(n.datatype="joblevel",t.joblevel!=""&&(n.datacode=t.joblevel)),!!t.pageState)switch(""+t.pageState){case"3":n.state="readonly";n.pageState="readonly";t.state=n.pageState}},setValidate:function(n){var t=[];return n.fmModel!=undefined&&n.fmModel!="false"&&t.push("fm-model='"+n.fmModel+"'"),n.required!=undefined&&n.required!="false"&&t.push("required"),!n.minValue||n.minValue=="false"||t.push("min-value='"+n.minValue+"'"),!n.maxValue||n.maxValue=="false"||t.push("max-value='"+n.maxValue+"'"),!n.minlength||n.minlength=="false"||t.push("min-length='"+n.minlength+"'"),!n.maxlength||n.maxlength=="false"||t.push("max-length='"+n.maxlength+"'"),!n.view||n.view=="false"||t.push("view='"+n.view+"'"),!n.minView||n.minView=="false"||t.push("min-view='"+n.minView+"'"),!n.format||n.format=="false"||t.push("format='"+n.format+"'"),t},setDefaultMember:function(n){n.disabledMember||(n.disabledMember="_isDisabled");n.displayMember||(n.displayMember="text");n.codeMember||(n.codeMember="value");n.valueMember||(n.valueMember="id");n.mustleaf=n.mustleaf!==undefined&&n.mustleaf!=="false"},setDataSource:function(i,r,u){var e,o,f,s;switch(i.datatype){case"view":e=function(n){var u,t;if(!!n){for(u={},t=0;t<n.displayColumList.length;t++)n.displayColumList[t].displayColumn=n.displayColumList[t].displayColumn.substring(0,1).toLowerCase()+n.displayColumList[t].displayColumn.substring(1),u[n.displayColumList[t].displayColumn]=n.displayColumList[t].name;i.columns=u;i.items=n.viewTable;r.formTitle=n.viewName}};u?u.batchAdd("Module","getViewTable",{code:i.datacode,filters:mabp.toArray(i.filter),key:i.isLoadBefore?"":i.fmModel}).then(e):n.getViewTable({code:i.datacode,filters:mabp.toArray(i.filter),key:i.isLoadBefore?"":i.fmModel}).then(e);break;case"dataitem":o=function(n){!n||(i.items=n.data,r.formTitle=n.name)};u?u.batchAdd("Module","getBasicData",{code:i.datacode,filters:mabp.toArray(i.filter)}).then(o):n.getBasicData({code:i.datacode,filters:mabp.toArray(i.filter)}).then(o);break;case"group":f=function(n){i.items=n;for(var t=0;t<i.items.length;t++)i.items[t].$$isExpend=!0;r.formTitle=n[0].text};u?u.batchAdd("Bpm","getSelectedGroupTree",{id:!!i.filter&&!!i.filter.id?i.filter.id:"",areaCode:!!i.filter&&!!i.filter.areaCode?i.filter.areaCode:""}).then(f):t.getSelectedGroupTree({id:!!i.filter&&!!i.filter.id?i.filter.id:"",areaCode:!!i.filter&&!!i.filter.areaCode?i.filter.areaCode:""}).then(f);break;case"joblevel":s=function(n){n.id=n.value;n.text=n.name;i.items=[n];for(var t=0;t<i.items.length;t++)i.items[t].$$isExpend=!0;r.formTitle=n.name};u?u.batchAdd("Module","getJobLevelEnumNameByValue",{id:i.fmModel}).then(f):n.getJobLevelEnumNameByValue({id:i.fmModel}).then(s)}},getOne:function(i,r,u,f){var e,o;if(i.fmModel!=null)switch(i.datatype){case"view":e=mabp.toArray(i.filter);e.push({name:"id",value:i.fmModel});function s(n){!n||i.fmModel==null||(i.selectItem=n.viewTable)}f?f.batchAdd("Module","getViewOne",{code:i.datacode,filters:e,key:i.fmModel}).then(s):n.getViewOne({code:i.datacode,filters:e,key:i.fmModel}).then(s);break;case"dataitem":if(o=r.bid==="true",r.valueMember=="value"||o){function l(n){var t=n.data;t&&t.length&&(i.selectItem=t,i.parentId=t[0].parentId)}function h(n){!n||i.fmModel==null||n.data&&n.data.length>0&&(i.selectItem=_.filter(n.data,{value:(i.fmModel||"").toString()}),i.selectItem.length>0&&(i.parentId=i.selectItem[0].parentId))}f?o&&u==null?f.batchAdd("Module","getBasicDataById",{code:i.datacode,filters:mabp.toArray(i.filter),key:i.fmModel,type:!0}).then(l):f.batchAdd("Module","getBasicData",{code:i.datacode,filters:mabp.toArray(i.filter),key:i.fmModel,type:!1}).then(h):n.getBasicData({code:i.datacode,filters:mabp.toArray(i.filter),key:i.fmModel,type:!1}).then(h)}else{function c(n){!n||i.fmModel==null||n.data&&n.data.length>0&&(i.selectItem=n.data,n.data.length>0&&(i.parentId=n.data[0].parentId))}f?f.batchAdd("Module","getBasicData",{code:i.datacode,filters:mabp.toArray(i.filter),key:i.fmModel,type:!0}).then(c):n.getBasicData({code:i.datacode,filters:mabp.toArray(i.filter),key:i.fmModel,type:!0}).then(c)}break;case"group":n.getGroups({filters:mabp.toArray(i.filter),key:i.fmModel}).then(function(n){i.selectItem=n});break;case"job":t.getSelectedJobUsers({id:i.fmModel}).then(function(n){var t;if(i.selectItem=[],!!n&&i.fmModel!=null)if(!!u&&u.hideUser)for(t=0;t<n.length;t++)i.selectItem.push({id:n[t].id,text:n[t].jobName});else for(t=0;t<n.length;t++)i.selectItem.push({id:n[t].id,text:n[t].jobName+"("+n[t].jobUsers+")"})});break;case"joblevel":n.getJobLevelEnumNameByValue({id:i.fmModel}).then(function(n){n.id=n.value;n.text=n.value+" "+n.name;n.value=n.value;i.selectItem=[n]})}},setDefaultWatch:function(n,t,i){t.$watch("fmNormal",function(i,r){if(!!n.pageState)switch(""+n.pageState){case"3":t.state="readonly";return}t.fmNormal!==undefined&&(t.fmNormal&&(t.state="normal"),!t.updateState||i==r||t.updateState(),!t.dataUpdate||i==r||t.dataUpdate())});t.$watch("fmDisabled",function(i,r){if(!!n.pageState)switch(""+n.pageState){case"3":t.state="readonly";return}t.fmDisabled!==undefined&&(t.fmDisabled?t.state="disabled":t.fmNormal!==undefined||t.fmReadonly||t.fmDisabled||(t.state=n.state||t.pageState),!t.updateState||i==r||t.updateState(),!t.dataUpdate||i==r||t.dataUpdate())});t.$watch("fmReadonly",function(i,r){if(!!n.pageState)switch(""+n.pageState){case"3":t.state="readonly";return}t.fmReadonly!==undefined&&(t.fmReadonly?t.state="readonly":t.fmNormal!==undefined||t.fmReadonly||t.fmDisabled||(t.state=n.state||t.pageState),!t.updateState||i==r||t.updateState(),!t.dataUpdate||i==r||t.dataUpdate())});t.$watch("fmHide",function(i,r){if(!!n.pageState)switch(""+n.pageState){case"3":t.state="readonly";return}t.fmHide!==undefined&&(t.fmHide?t.state="hide":t.fmNormal!==undefined||t.fmReadonly||t.fmDisabled||(t.state=n.state||t.pageState),!t.updateState||i==r||t.updateState(),!t.dataUpdate||i==r||t.dataUpdate())});t.$watch("fmRequired",function(n,r){t.fmRequired!==undefined&&(t.fmRequired?i.attr("required","required"):i.removeAttr("required"),!t.updateState||n==r||t.updateState(),!t.dataUpdate||n==r||t.dataUpdate())})},getView:function(t,i,r,u,f){f?f.batchAdd("Module","getViewTable",{code:t,filters:mabp.toArray(i),pageInput:u}).then(function(n){!n||r&&r(n)}):n.getViewTable({code:t,filters:mabp.toArray(i),pageInput:u}).then(function(n){!n||r&&r(n)})},getBasicdata:function(t,i,r,u){u?u.batchAdd("Module","getBasicData",{code:t,filters:mabp.toArray(i)}).then(function(n){!n||r&&r(n)}):n.getBasicData({code:t,filters:mabp.toArray(i)}).then(function(n){!n||r&&r(n)})},getGroupTree:function(n,i){t.getSelectedGroupTree({id:!!n&&!!n.id?n.id:"",areaCode:!!n&&!!n.areaCode?n.areaCode:""}).then(function(n){!n||i&&i(n)})},getTreeData:function(n,t,i){var r=function(n){if(!!n)for(var t=0;t<n.length;t++)f.indexOf(n[t][i.valueMember])>=0&&u.push(n[t]),r(n[t].children)},f=(t||"").split(","),u=[];return r(n),u},isInitialed:function(n,t,i){for(var r=n,v,f,e;!!r&&!r.base;)r=r.$parent;if(r==null||r.base==null&&r.form==null||r.$initial==null)return!0;var o=t.parents("[ng-repeat]"),s="item",h="",c=-1,u=i.fmModel.replace(/^form./,"$initial.");if(o.length>0){var l=o.attr("ng-repeat"),a=l.match(/^(.*)\s+in\s+/),y=l.match(/^.*\s+in\s+form\.([0-9a-zA-z\.]*)/);a.length>0&&(s=a[1],h=y[1]);c=n.$parent.$index;u="$initial."+h+"["+c+"]."+i.fmModel.replace(s+".","")}return(v=r.$eval(u),f=r.$initial.$initaled[u],f!=null)?f:(e=!0,v==n.fmModel&&(e=!1),r.$initial.$initaled[u]=!0,e)}}}]);
/**** fm-cache.js *****/
_shared.directive("fmCache",["$timeout","mabp.app.module",function(n,t){return{restrict:"AE",controller:["$scope",function(){var i=this;this.cachedList=[];this.batchRequest=[];this.batchAdd=function(t,r,u){var o=_$.getGUID(),f={id:o,service:t,method:r,param:u,response:null,promise:$.Deferred()},e=_.find(i.cachedList,function(n){return _.isEqual(f.service,n.service)&&_.isEqual(f.method,n.method)&&_.isEqual(f.param,n.param)});return e!=null?(n(function(){f.promise.resolve(e.response)}),f.promise):(i.batchRequest.push(f),i.batchRequest.length===1&&i.startService(),f.promise)};this.splitCachedRequest=function(n){return _.filter(n,function(n){var t=_.find(i.cachedList,function(t){return _.isEqual(n.service,t.service)&&_.isEqual(n.method,t.method)&&_.isEqual(n.param,t.param)});return t!=null&&n.promise.resolve(t.response),t==null})};this.getDuplicationObj=function(n){var i={requestItem:[],callBackItem:[]},t,r;return n!=null&&(t=[],r=[],_.forEach(n,function(n){var i=_.cloneDeep(n),u=_.find(t,function(n){return _.isEqual(n.service,i.service)&&_.isEqual(n.method,i.method)&&_.isEqual(n.param,i.param)});u?r.push(i):t.push(i)}),i.requestItem=t,i.callBackItem=r),i};this.prepareRequest=function(n){var r=[],t,i;if(n!=null)for(t=0;t<n.length;t++)i=n[t],i.param=JSON.stringify(i.param),r.push(i);return r};this.startService=function(){n(function(){var f=i.batchRequest;i.batchRequest=[];var r=i.splitCachedRequest(f),u=i.getDuplicationObj(r),n=i.prepareRequest(u.requestItem);n!=null&&n.length>0&&t.getBatchResult(n).then(function(n){var e,t,f;if(n!=null&&n.length>0){for(e=0;e<n.length;e++)t=n[e],f=_.find(r,{id:t.id}),t.response.isSuccess?(f.promise.resolve(t.response.data),f.response=t.response.data,i.cachedList.push(f)):(console.error("调用失败: Service: "+t.serviceName+"Method: "+t.methodName+"错误信息:"+t.response.Error),f.promise.reject(null));i.splitCachedRequest(u.callBackItem)}})},100)}}]}}]);
/**** fm-category.js *****/
_shared.directive("fmCategory",["fmTool","mabp.app.module","$timeout",function(n,t,i){return{restrict:"E",replace:!0,template:function(t,i){return n.setDefaultMember(i),i.name||(i.name=i.fmModel.toString().substring(i.fmModel.lastIndexOf(".")+1)),'<div fm-model="'+i.fmModel+'" class="fm-category" ng-class="state" ids="{{fmModel}}" ng-blur="event_Blur()"><div class="fm-category-group"><button ng-if="!!items && items.length > 1 && isall" ng-class="{true:\'btn-primary\',false:\'\'}[isCheckAll()]" class="btn btn-sm" ng-click="event_ChangeValueOfAll($event)" >'+L("All")+'&nbsp;<span class="label label-badge">{{allCount}}<\/span><\/button><button ng-repeat="item in items track by $index" ng-disabled="state == \'disabled\' || state == \'readonly\' || item.'+i.disabledMember+' === true" ng-class="{true:\'btn-primary\',false:\'\'}[isChecked(item) || (!!items && items.length == 1)]" class="btn btn-sm" ng-click="event_ChangeValue(item, $event)" >{{item.'+i.displayMember+'}}&nbsp;<span class="label label-badge">{{item.'+i.codeMember+"}}<\/span><\/button><\/div><\/div>"},scope:{fmModel:"=",fmCode:"=",items:"=",selectItem:"=",fmRequired:"=",fmDisabled:"=",fmReadonly:"=",filter:"=",group:"=",allCount:"=",callbackFunc:"&"},require:"?^fmCache",compile:function(){return{pre:function(){},post:function(t,r,u,f){t.isall=u.isall!==undefined&&u.isall!=="false"?!0:!1;u.ismulti=u.ismulti||!1;t.selectItem=[];n.setScopeState(t,u,f);n.setDataSource(t,u,f);t.$watch("filter",function(i,r){!i||i==r||n.setDataSource(t,u)},!0);t.isChecked=function(n){return t.items.length==1&&(t.fmModel=t.items[0][u.valueMember]),(t.fmModel?t.fmModel.split(","):[]).indexOf(n[u.valueMember])>=0};t.isCheckAll=function(){var i,r,n;if(!t.fmModel)return!0;for(i=!0,r=t.fmModel?t.fmModel.split(","):[],n=0;n<t.items.length;n++)if(r.indexOf(t.items[n][u.valueMember])>-1){i=!1;break}return i};n.setDefaultWatch(u,t,r);t.$watch("fmModel",function(){var r,i,n;if(t.fmModel===undefined||!t.items)t.event_ChangeValueOfAll();else{for(r=t.fmModel?t.fmModel.split(","):[],n=0;n<t.items.length;n++)if(r.indexOf(t.items[n][u.valueMember])>=0){t.selectItem.push(t.items[n][u.valueMember]);break}if(u.codeMember&&!!t.selectItem){for(i=[],n=0;n<t.selectItem.length;n++)i.push(t.selectItem[n][u.codeMember]);t.fmCode=i.join(",")}t.isCheckAll()&&(t.fmModel=t.isall?"":t.items.length>0?t.items[0][u.valueMember]:"");t.items.length==1&&t.callbackFunc({selectItem:t.items[0]})}});t.$watch("items",function(){var i,n;if(!!t.items){for(i=!t.fmModel?[]:t.fmModel.split(","),t.selectItem=[],_tempCode=[],t.allCount=0,n=0;n<t.items.length;n++)t.allCount+=parseInt(t.items[n][u.codeMember]),i.indexOf(t.items[n][u.valueMember])>=0&&(t.selectItem.push(t.items[n]),_tempCode.push(t.items[n][u.codeMember]));t.fmCode=_tempCode.join(",")}},!0);t.event_ChangeValue=function(n){if(u.ismulti){var r=t.fmModel?(t.fmModel||"").split(","):[],f=r.indexOf(n[u.valueMember]);f>=0?r.splice(f,1):r.push(n[u.valueMember]);t.fmModel=r.join(",")}else t.fmModel=n[u.valueMember];console.info(n[u.displayMember],n[u.valueMember],n[u.codeMember]);i(function(){t.callbackFunc({selectItem:n})})};t.event_ChangeValueOfAll=function(){t.isall?(t.fmModel="",i(function(){t.callbackFunc({selectItem:{id:"",text:"全部"}})})):t.fmModel=t.items.length>0?t.items[0][u.valueMember]:""};t.event_Blur=function(){$(r).removeClass("focus")}}}}}}]);
/**** fm-grid.js *****/
_shared.directive("fmGrid",["mabp.app.module","mabp.app.file","fmTool","$timeout",function(){return{restrict:"E",replace:!0,template:function(){return'<div class="jq-grid-bd"><table id="jqgrid" class="jq-grid" ><\/table><div id = "pager"'+$("")+' class="jq-pager" ><\/div> <div class="table-footer"><div class="edit-bd" > <input type = "BUTTON" ng-click="setColShow()" value = "选择列" /> <div class="set-cols"><ul ng-show="setcol"><li style="text-align: right;line-height: 20px;"><i class="icon-remove-sign" style="cursor: pointer" ng-click="setColShow()"><\/i><\/li><li ng-repeat="m in columnConfig"><input type="checkbox" ng-init="m.check=true" ng-click="colSelect()" ng-model="m.check"/>{{m.displayName}}<\/li><\/ul><\/div><\/div>  <div class="table-footer-pager" ng-if="pageModel.paging.totalCount > 0"> <rs-pager  current-page="pageModel.paging.currentPage" load="pageModel.load()" total-count="pageModel.paging.totalCount" page-size="pageModel.paging.pageSize"><\/rs-pager><\/div> <\/div><\/div>'},scope:{columnConfig:"=",pageModel:"=",rowHandel:"=",height:"=",definedRowclass:"=",multiselect:"="},link:function(n,t){var i=$(t).find(".jq-grid"),r=n.pageModel.datas;n.colNames=[];n.pageInit=function(){i.jqGrid({data:n.pageModel.datas,datatype:"local",colNames:n.colNames,colModel:n.columnConfig,rowNum:n.pageModel.paging.pageSize,rowList:[10,20,30],height:n.height||400,autowidth:!0,multiselect:n.multiselect||!1,gridComplete:function(){for(var u,r,e,f=i.jqGrid("getDataIDs"),t=0;t<n.pageModel.datas.length;t++){if(u="",edit='<i class="icon-edit grid-btn ed"  data-edit="'+t+'"><\/i>',remove='<i class="icon-remove-sign grid-btn ed"  data-del="'+t+'"><\/i>',n.pageModel.edit&&(u+=edit),n.pageModel.delete&&(u+=remove),n.pageModel.customHandel)for(r=0;r<n.pageModel.customHandel.length;r++)u+='<i class="'+n.pageModel.customHandel[r].className+'"data-id="'+r+'"  data-custom="'+t+'">'+n.pageModel.customHandel[r].text+"<\/i>";i.jqGrid("setRowData",f[t],{act:u});e=n.pageModel.datas[t];n.definedRowclass&&e[n.definedRowclass.name]==n.definedRowclass.value&&i.find("#"+f[t]).addClass(n.definedRowclass.class)}},loadComplete:function(){$(t).find(".jq-grid *[data-edit]").click(function(){n.edit($(this).data("edit"))});$(t).find(".jq-grid *[data-del]").click(function(){n.del($(this).data("del"))});$(t).find(".jq-grid *[data-custom]").click(function(){var t=$(this).data("id"),i=$(this).data("custom");n.pageModel.customHandel[t].event(n.pageModel.datas[i])});i.setGridWidth($(t).width())},onSortCol:function(t,i,r){n.sort(t,r)},onSelectRow:function(t,r,u){var f=n.pageModel.datas[i.find("#"+t)[0].rowIndex-1];u.which!=1||!n.pageModel.clickRow||n.pageModel.clickRow(f);n.pageModel.getSelected&&n.pageModel.getSelected(i.jqGrid("getGridParam","selarrrow"))},ondblClickRow:function(t){var r=n.pageModel.datas[i.find("#"+t)[0].rowIndex-1];!n.pageModel.doubleClickRow||n.pageModel.doubleClickRow(r)},rowNum:100,rowList:[100],onSelectAll:function(){n.pageModel.getSelected&&n.pageModel.getSelected(i.jqGrid("getGridParam","selarrrow"))}})};n.load=function(){for(var r=0;r<n.columnConfig.length;r++)n.columnConfig[r].sortable||(n.columnConfig[r].sortable=!1),n.columnConfig[r].key=!1,n.colNames.push(n.columnConfig[r].displayName);!n.pageModel.datas||(n.pageInit(),$(window).resize(function(){i.setGridWidth($(t).width())}),n.columnConfig[0].frozen&&(setTimeout(function(){i.jqGrid("setFrozenColumns")},3e3),$(t).find(".edit-bd").hide()))};n.load();n.colSelect=function(){for(var i,t=0;t<n.columnConfig.length;t++)i=$("td[aria-describedby='jqgrid_"+n.columnConfig[t].name+"'],#jqgrid_"+n.columnConfig[t].name),n.columnConfig[t].check?(i.show(),$(".jqgfirstrow td").eq(t).show()):(i.hide(),$(".jqgfirstrow td").eq(t).hide())};n.edit=function(t){n.pageModel.edit(n.pageModel.datas[t])};n.del=function(t){n.pageModel.delete(n.pageModel.datas[t])};n.setColShow=function(){n.setcol=!n.setcol};n.sort=function(t,i){n.pageModel.paging.orderByProperty=t;n.pageModel.paging.ascending=i=="asc"?!0:!1;n.pageModel.load()};n.$watch("pageModel.datas",function(){i.jqGrid("clearGridData");i.jqGrid("setGridParam",{data:n.pageModel.datas}).trigger("reloadGrid")})}}}]);_shared.directive("onFinishRender",function(n){return{restrict:"A",link:function(t){t.$last===!0&&n(function(){t.$emit("ngRepeatFinished")})}}});
/**** fm-import-advance.js *****/
_shared.directive("fmImportAdvance",["fmTool","dialog","mabp.app.file",function(n,t,i){return{restrict:"E",replace:!0,scope:{fmDisabled:"=",fmReadonly:"=",fmNormal:"=",config:"=",callbackFunc:"&",taskId:"=",linkId:"=",formFiles:"=",fmRequired:"="},template:function(n,t){return'<div style="display: inline-block;" class="fm-import-advance '+t.class+'" ng-class="state"><button ng-if="state==\'normal\'" type="button" class="btn btn-info btn-sm" ng-click="openDialog()">{{config.base.buttonName}}<\/button>  <a ng-if="config.base.displayAttachment" target="_blank" ng-href="/File/Download?fileId={{fileInfo.id}}">{{fileInfo.fileName}}<\/a><\/div>'},link:function(r,u,f){r.foreFileInfo={};n.setScopeState(r,f);r.openDialog=function(){t.open(_shared.dialogs.dataImport,r.config).then(function(n){!n||(r.data=n.data,!r.foreFileInfo.id||r.deleteFile({id:r.foreFileInfo.id}),r.fileInfo=n.fileModel,r.foreFileInfo=n.fileModel,r.formFiles.push({linkId:r.linkId,FileId:[r.fileInfo.id]}),r.callbackFunc({importData:n.dataReturn}))})};r.deleteFile=function(n){var t={};t.taskId=r.taskId;t.fileId=n.id;i.deleteFile(t).then(function(){_.remove(r.formFiles,function(t){return t.FileId[0]===n.id})})};!r.taskId||i.getTaskLinkedFiles({taskId:r.taskId,linkId:r.linkId}).then(function(n){r.fileInfo=n[0]})}}}]);
/**** fm-import-csv.js *****/
_shared.directive("fmImportCsv",["fmTool","$timeout","dialog","mabp.app.module",function(){return{restrict:"E",replace:!0,template:function(n,t){return t.inputname=_$.getGUID(!1),'<div style="display: inline-block;"><label class="btn btn-info btn-sm" for="'+t.inputname+'" ng-click="event_fileSelect()">导入<\/label><label style="vertical-align:bottom;margin-left: 5px;margin-right: 1px;" class="btn btn-info btn-sm '+(t.template?"":"hide")+'" target="_blank" href="'+t.template+'" >下载模板<\/label><input class="picUpload" type="file" id="'+t.inputname+'" /><\/div>'},scope:{filename:"=",fmDisabled:"=",columns:"=",items:"=",callbackFunc:"&"},compile:function(){return{pre:function(){},post:function(n,t,i){i.startIndex=i.startIndex?parseInt(i.startIndex):0;n.event_fileSelect=function(){};n.event_fileChange=function(){var n=e.target.files[0];csvParser.loadFile(n,function(){console.log(csvParser.getSheet())})};i.csvParser=new SimpleExcel.Parser.CSV;var r=t.find("#"+i.inputname);r[0].addEventListener("change",function(t){var u=t.target.files[0];i.csvParser.loadFile(u,function(){var f=i.csvParser.getSheet(),e,o,t,s,u;if(n.columns==undefined){for(e=[],t=0;t<f[0].length;t++)e.push(f[0][t].value);n.columns=e}for(o=[],t=i.startIndex||0;t<f.length;t++){for(s={},u=0;u<n.columns.length&&u<f[t].length;u++)s[n.columns[u]]=f[t][u].value;o.push(s)}$(r[0]).val("");n.callbackFunc({data:o})})})}}}}}]);
/**** fm-import-xls.js *****/
_shared.directive("fmImportXls",["fmTool","$timeout","dialog","mabp.app.module",function(){return{restrict:"E",replace:!0,template:function(n,t){return t.inputname=_$.getGUID(!1),'<div style="display: inline-block;"><label class="btn btn-info btn-sm btn-import" for="'+t.inputname+'" ng-click="event_fileSelect()">导入<\/label><a style="vertical-align:bottom;margin-left: 5px;margin-right: 1px;color:white;" class="btn btn-info btn-sm '+(t.template?"":"hide")+' btn-download" target="_blank" href="'+t.template+'" >下载模板<\/a><input class="picUpload" type="file" id="'+t.inputname+'" /><\/div>'},scope:{filename:"=",fmDisabled:"=",columns:"=",items:"=",callbackFunc:"&"},compile:function(){return{pre:function(){},post:function(n,t,i){function u(n){var t=[];return n.SheetNames.forEach(function(i){var r=XLSX.utils.sheet_to_row_object_array(n.Sheets[i]);r.length>0&&t.push(r)}),t}i.startIndex=i.startIndex?parseInt(i.startIndex):0;var r=t.find("#"+i.inputname);r[0].addEventListener("change",function(t){for(var s=t.target.files,o,h,f=0,e=s[f];f!=s.length;++f)o=new FileReader,h=e.name,o.onload=function(t){var p=t.target.result,w=XLSX.read(p,{type:"binary"}),l=u(w),s,f,a,h,e,c,y,v,o;if(!!l&&l.length>0){if(s=l[0],n.columns==undefined){a=[];for(f in s[0])a.push(f);n.columns=a}for(h=[],c=0;c<s.length;c++){e=[];for(y in s[c])e.push(s[c][y]);h.push(e)}for(v=[],f=i.startIndex||0;f<h.length;f++){for(e={},o=0;o<n.columns.length&&o<h[f].length;o++)e[n.columns[o]]=h[f][o];v.push(e)}$(r[0]).val("");n.callbackFunc({data:v})}},o.readAsBinaryString(e)})}}}}}]);
/**** fm-table.js *****/
_shared.directive("fmTable",["mabp.app.module","mabp.app.file","fmTool","$timeout",function(n,t,i,r){return{restrict:"E",replace:!0,template:function(n,t){var i="",r="display:none";return t.sortable!=undefined&&(i=" tableSort"),t.checkable!=undefined&&(r=""),'<div><div class="col-xs-12" style="min-height:32px;float:none"><button class="btn btn-info btn-sm" ng-if="allColumnFilter && hasSearch" ng-click="show()" > '+L("QueryCriteria")+'<\/button><div class="col-xs-2" style="text-align:right;float:right" ><button id="{{item.id}}" ng-if="item.enable" ng-repeat="item in actionButtons | orderBy : \'displayOrder\'" class="btn btn-info btn-sm" ng-click="item.action(selectItems)" style="margin:0 3px;">{{item.text}}<\/button><\/div><\/div > <div class="panel-heading float-panel-heading" ng-show="!!show1 && !!allColumnFilter && !!displayColumListAll"><div class="row search-condition"><div class="col-xs-3" ng-repeat="col in displayColumListAll" ng-show="col.isWhereEnable"><div class="input-group" style="margin-bottom:5px;"><span class="input-group-addon input-sm">{{col.name}}<\/span><input name="{{col.displayColumn}}" type="text" class="form-control input-sm" placeholder="" ng-enter="filterData()" /><\/div><\/div><\/div><div class="row"><div class="col-xs-6"><input type="button" value="'+L("Search")+'" class="btn btn-block btn-info btn-md" style="padding: 1px 5px;" ng-click="filterData();show()" /><\/div><div class="col-xs-6"><input type="button" value="'+L("Clear")+'" class="btn btn-block btn-default btn-md" style="padding: 1px 5px;" ng-click="clearCondition()" /><\/div><\/div><\/div><div id="{{guid}}" class="col-xs-12" style="height:380px;width:100%;display:none"><\/div><div id="table2018" class="table2018 '+i+'"><div class="excel-table-bd"><div style="{{check}}" class="ck-box-bd"><p><input ng-model="allcheck" ng-click="allChecked(allcheck)" type="checkbox"><\/p><p  ng-repeat="cls in viewdata" ><input ng-click="itemCheck()" ng-model="cls.check" type="checkbox"><\/p><\/div><div class="fixed-column"><table><thead><tr class="table-head"><th ng-repeat="th in thlist" columnName="{{th.displayColumn}}"><div class="td-warp"><label orderByProperty="{{th.displayColumn}}" ng-click="sortatart($event)">{{ th.name }}<\/label><\/div><\/th><th><\/th><\/tr><\/thead><tbody class="td-body"><tr ng-repeat="cls in ColumList" ng-click="itemSelect(cls.id)"><td ng-repeat="cl in cls.data track by $index"><div class="td-warp" id="{{cls.id}}">{{ cl }}<\/div><\/td><td style="width:1px;height:27px;display: table-cell;border:0;padding:0"><\/td><\/tr><\/tbody><\/table><\/div><div class="excel-box"><table id="sort" class="table-excel"><thead><tr class="sort-th table-head"><th ng-repeat="th in thlist" columnName="{{th.displayColumn}}"><div class="td-warp"><label orderByProperty="{{th.displayColumn}}" ng-click="sortatart($event)">{{ th.name }}<\/label><\/div><\/th><\/tr><\/thead><tbody class="sort-td"><tr ng-repeat="cls in ColumList" ng-click="itemSelect(cls.id)" on-finish-render><td ng-repeat="cl in cls.data track by $index"><div class="td-warp" id="{{cls.id}}">{{ cl }}<\/div><\/td><\/tr><\/tbody><\/table><\/div><\/div><\/div><div class="row float-bottom-oper"><div class=" col-xs-12"><div ng-if="pageSizeList && (isExcel || isMergeExcel)" class="col-xs-2">&nbsp;<\/div><ma-pager load="load(true)" current-page="paging.currentPage" total-count="paging.totalCount" page-size="paging.pageSize"><\/list-pager><\/div><\/div><\/div>'},scope:{view:"=",data:"=",filter:"=",refreshData:"=",selectItems:"=",guid:"=",currentPageData:"=",excel:"&",sumColumns:"=",zip:"&",addButtons:"=",colConfig:"=",mergeNum:"="},link:function(i,u,f){var e,o;i.moduleId=i.$parent!=null&&i.$parent.base!=null?i.$parent.base.moduleId:null;i.language=mabp.language;i.showPages=[];i.currentPageIndex=0;i.currentPageData=[];i.pageNum=0;i.pageSize=10;i.selectItems=[];i.refresh=!1;i.guid=_$.getGUID(!0);i.column=[];i.columnText=[];i.isExcel=null;i.isMergeExcel=null;i.zip=!1;i.page=null;i.paging={};i.paging.totalCount=0;i.checkbox=!1;i.radiobox=!1;i.sortable=!1;i.pageSizeList=null;i.isAllChecked=!1;i.allColumnFilter=!0;i.pdf=!1;i.show1=!1;i.fixColumnNum=f.fixColumnNum;i.mergeColumns=f.mergeColumns;(i.excel||f.excel!==undefined)&&(i.isExcel=!0);f.enableMerge===""&&(i.isMergeExcel=!0);(i.zip||f.zip!==undefined)&&(i.zip=!0);f.fixHeaderRow===""&&(i.fixedHeaderRow=!0);f.singleRowSelect===""&&(i.singleRowSelect=!0);f.checkedByRow===""&&(i.checkedByRow=!0);(i.page||f.page!==undefined)&&(i.page=!0,!f.page||(i.paging=JSON.parse(f.page),i.paging.totalCount=1,i.toPage=i.paging.currentPage));f.checkable==""&&(i.checkbox=!0);f.radiobox==""&&(i.radiobox=!0);f.sortable==""&&(i.sortable=!0);f.pageSizeList!==undefined&&(i.pageSizeList=[10,20,50,100]);f.pdf!=""&&!f.pdfLanguages||(i.pdf=!0);var s=_$.getGUID(!0),h=_$.getGUID(!0),c=_$.getGUID(!0);i.actionButtons=[{id:s,text:mabp.L("Export"),action:function(){i.exportExcel(s)},enable:i.isExcel||i.isMergeExcel,displayOrder:1},{id:h,text:mabp.L("Attachment"),action:function(){i.exportZip(h)},enable:i.zip,displayOrder:2},{id:c,text:"PDF",action:function(){i.exportPdf(c)},enable:i.pdf,displayOrder:3}];i.$watch("addButtons",function(){_.filter(i.addButtons,function(n){i.actionButtons.push(n)})},!0);i.load=function(t){!f.view||(i.condition(),i.page?n.getViewTable({code:f.view,filters:mabp.toArray(i.filter),allColumnFilter:!0,tableFilters:mabp.toArray(i.tableFilters),pageInput:i.paging,permissionKey:i.moduleId}).then(function(n){i.Loadtable(n);i.hasSearch=_.some(n.displayColumListAll,{isWhereEnable:!0});r(function(){i.data=n.viewTable;i.paging.totalCount=n.totalCount});t||(i.displayColumListAll=n.displayColumListAll)}):n.getViewTable({code:f.view,filters:mabp.toArray(i.filter),permissionKey:i.moduleId}).then(function(n){!n||(i.hasSearch=_.some(n.displayColumListAll,{isWhereEnable:!0}),i.paging.totalCount=n.totalCount)}))};i.changePageSize=function(){i.pageSize=i.paging.pageSize;i.load(!0)};i.sort=function(n,t,r){i.paging.orderByProperty=i.column[t];i.paging.ascending=r;i.load(!0)};i.$watch("refreshData",function(n,t){n!==t&&(i.paging.currentPage=1,i.filterData())},!0);i.exportExcel=function(n){var u=new mabp.ui.executor(n," 导出中..."),r;u.start();r={};i.page?(i.pagingExport={},i.pagingExport.pageSize=2147483647,i.pagingExport.currentPage=1,i.pagingExport.orderByProperty=i.paging.orderByProperty,i.pagingExport.ascending=i.paging.ascending,r={code:f.view,filters:mabp.toArray(i.filter),allColumnFilter:!0,tableFilters:mabp.toArray(i.tableFilters),pageInput:i.pagingExport,fileNamePrefix:i.$parent.base.title}):r={code:f.view,filters:mabp.toArray(i.filter),allColumnFilter:!0,tableFilters:mabp.toArray(i.tableFilters),pageInput:{pageSize:2147483647,currentPage:1,orderByProperty:"Id",ascending:!0},fileNamePrefix:i.$parent.base.title};f.excel===""&&t.downloadView(r,{responseType:"blob"}).then(function(){u.stop()});f.mergeExcel===""&&((f.mergeColumns==null||f.mergeNum==null)&&console.error("检查merge-columns (如 1,2,3,4 ), merge-num(如: 0 ) 是否未配置全。"),r.value=JSON.stringify(r),r.mergeColumns=f.mergeColumns,r.sumColumns=f.sumColumns,r.mergeNum=f.mergeNum|0,t.downloadMergeExcel(r,{responseType:"blob"}).then(function(){u.stop()}))};i.exportZip=function(n){var r=new mabp.ui.executor(n," 制作中...");r.start();t.zip(JSON.stringify(i.selectItems),{responseType:"blob"}).then(function(){r.stop()})};i.exportPdf=function(n){var u=new mabp.ui.executor(n," 制作中..."),r;if(u.start(),!!i.selectItems){if(r=[],_.forEach(i.selectItems,function(n){var t={sn:n.snNumber,fileName:n.snNumber+" "+(n.areaCode||""),sourceText:1,sourceIdentity:"",operationType:1,targetType:2,displayLanguages:f.pdfLanguages,param:f.param},i;r.push(t);i=_.findIndex(r,{sn:n.snNumber})>-1;i||(r.push(t),sns.push(n.snNumber))}),r.length==0){mabp.notify.info("请先选择一行数据");u.stop();return}t.insertJobConvertQueueAndUserFile(JSON.stringify(r)).then(function(){mabp.message.info("已经排队制作,请到 [我的]>[文件]菜单中下载 [批量PDF]","确认");u.stop()})}};i.filterData=function(){i.page?i.filterPaged():i.filterUnPaged()};i.filterPaged=function(){i.load(!0)};i.filterUnPaged=function(){for(var t,f,e,s,r={},u=document.querySelectorAll(".search-condition [name]"),n=0;n<u.length;n++)!u[n].value||(r[u[n].getAttribute("name")]=u[n].value);if(t=[],f=!0,Object.keys(r).length>0)for(n=0;n<i.data.length;n++){f=!0;for(e in r)if(s=e.lowerFirst(),(""+(angular.lowercase(i.data[n][s])||"")).indexOf(angular.lowercase(r[e]))<0){f=!1;break}f&&t.push(i.table[n])}else for(n=0;n<i.data.length;n++)t.push($.extend({},i.table[n]));for(i.pageNum=parseInt(t.length/i.pageSize),(t.length%i.pageSize!=0&&t.length>i.pageSize||i.pageNum===0)&&i.pageNum++,i.showPages=[],n=0;n<=i.pageNum-1;n++)n>=i.currentPageIndex-2&&n<=i.currentPageIndex+2&&i.showPages.push({index:n});var h=[],c=i.currentPageIndex*i.pageSize,o=i.currentPageIndex*i.pageSize+i.pageSize;for(o>t.length&&(o=t.length),n=c;n<o;n++)h.push(t[n]);i.currentPageData=h};i.condition=function(){for(var r={},t=document.querySelectorAll(".search-condition [name]"),n=0;n<t.length;n++)!t[n].value||(r[t[n].getAttribute("name")]=t[n].value);i.tableFilters=r};i.show=function(){i.show1=!i.show1};i.clearCondition=function(){for(var t=document.querySelectorAll(".search-condition [name]"),n=0;n<t.length;n++)t[n].value="";i.page?i.filterPaged():i.filterUnPaged()};i.load();e=new Table2018(u);o=null;i.Loadtable=function(n){i.thlist=e.GetThlist(n.displayColumList);i.ColumList=e.GetColumData(n);o=n.viewTable;i.viewdata=n.viewTable};i.$on("ngRepeatFinished",function(){e.InitSortTable();i.fixColumnNum!=undefined&&e.ShowFixedColumn(i.fixColumnNum);i.mergeNum!=undefined&&e.RowSpanData(i.ColumList,i.mergeNum,i.mergeColumns.split(","));e.ShowSortStaus(i.paging);i.currentPageData=o});i.sortatart=function(){i.paging.orderByProperty=$(event.target).attr("orderbyproperty");i.paging.ascending=!i.paging.ascending;i.load(!0)};i.itemSelect=function(n){var t=_.filter(o,{id:n});event.ctrlKey?i.selectItems.push(t[0]):i.selectItems=t};i.itemCheck=function(){var n=$.grep(i.viewdata,function(n){return n.check==!0});i.selectItems=n;console.log(n)};i.allChecked=function(n){for(var t=0;t<i.viewdata.length;t++)i.viewdata[t].check=n;i.itemCheck()}}}}]);_shared.directive("onFinishRender",function(n){return{restrict:"A",link:function(t){t.$last===!0&&n(function(){t.$emit("ngRepeatFinished")})}}});
/**** fm-table2018.js *****/
var Table2018=function(n){this.InitSortTable=function(){var t,i;$(".table-excel .sort-th .sort").append("<i><\/i>");$(".table-excel tr th,.table-excel tr td").each(function(){$(this).attr("data-col",$(this).index()+1)});n.find(".excel-table-bd th").each(function(){var n=$(this);$(this).closest("table").find("tbody tr").each(function(){$(this).find("td").eq(n.index()).find(".td-warp").addClass(n.attr("columnname"))})});t=function(t,i,r){n.find(".sort-td tr").each(function(){$("#1").insertAfter($("#3"));i?$(this).children("td[data-col='"+t+"']").insertAfter($(this).children("td[data-col='"+i+"']")):$(this).children("td[data-col='"+t+"']").insertBefore($(this).children("td[data-col='"+r+"']"))})};n.find(".table-excel th .td-warp").resizable({autoHide:!0,maxHeight:18,resize:function(t,i){$(i.element).parent().width(i.size.width);n.find(".table-excel td[data-col="+$(i.element).parent().attr("data-col")+"] .td-warp").width(i.size.width)}});n.find(".sort-th").JUIsortable({axis:"x",opacity:.5,placeholder:"ui-state-highlight",helper:"clone",stop:function(i,r){var f=r.item.attr("data-col"),u=n.find(".sort-th").JUIsortable("toArray",{attribute:"data-col"}),e=u[u.indexOf(f)-1],o=u[u.indexOf(f)+1];t(f,e,o)}});i=$("#table2018").offset().top+9;n.find(".table2018").scroll(function(){var n=$(this).scrollTop()-1,t=$(this).scrollLeft();n>0?$(this).find(".table-head th,.ck-box-bd p:first-child").css("top",n):$(this).find(".table-head th,.ck-box-bd p:first-child").css("top",0);t>0?$(this).find(".fixed-column,.ck-box-bd").css("left",t):$(this).find(".fixed-column,.ck-box-bd").css("left",0)});$(".table2018").css({position:"fixed",top:$(".table2018").offset().top+5});$(".table2018").length>1&&($(".table2018").css({position:"static",margin:"10px 0","max-height":"320px"}),$(".float-bottom-oper").css({position:"static","margin-bottom":"15px"}));$(".table-excel .sort-td tr,.fixed-column .td-body tr").mousedown(function(n){if(n.button==0){var t=$(this).index();n.ctrlKey||$(".table-excel .sort-td tr,.fixed-column .td-body tr").removeClass("select");$(".table-excel .sort-td tr").eq(t).addClass("select");$(".fixed-column .td-body tr").eq(t).addClass("select")}})};this.GetColumData=function(n){for(var r,i,u=[],t=0;t<n.viewTable.length;t++){for(r={id:n.viewTable[t].id,data:[]},i=0;i<n.displayColumList.length;i++){var f=n.displayColumList[i].displayColumn,e=f.substring(0,1).toLowerCase(),o=f.substring(1);r.data.push(n.viewTable[t][e+o])}u.push(r)}return u};this.GetThlist=function(n){for(var t=0;t<n.length;t++)n[t].displayColumn=n[t].displayColumn.substring(0,1).toLowerCase()+n[t].displayColumn.substring(1);return n};this.ShowFixedColumn=function(t){for(var i=0;i<t;i++)n.find(".fixed-column th").eq(i).show(),n.find(".fixed-column .td-body tr").each(function(){$(this).find("td").eq(i).show()}),n.find(".table-excel th").eq(i).hide(),n.find(".table-excel .sort-td tr").each(function(){$(this).find("td").eq(i).hide()})};this.RowSpanBy=null;this.RowSpan=null;this.TableRowSpan=function(t){for(var r,u,i=0;i<t.length;i++)for(r=0;r<this.RowSpan.length;r++)for(n.find(".table-excel tbody tr").eq(t[i].row[0]).find("td").eq(this.RowSpan[r]).attr("rowspan",t[i].row.length),n.find(".fixed-column .td-body tr").eq(t[i].row[0]).find("td").eq(this.RowSpan[r]).attr("rowspan",t[i].row.length),u=1;u<t[i].row.length;u++)n.find(".table-excel tbody tr").eq(t[i].row[u]).find("td").eq(this.RowSpan[r]).hide(),n.find(".fixed-column .td-body tr").eq(t[i].row[u]).find("td").eq(this.RowSpan[r]).hide()};this.RowSpanData=function(n,t,i){var u,r,f,i,e;for(this.RowSpanBy=t,this.RowSpan=i,u=[],r=0;r<n.length;r++)f=n[r].data[this.RowSpanBy],i=$.grep(u,function(n){return n.id==f}),i.length<1?u.push({id:n[r].data[this.RowSpanBy],row:[r]}):i[0].row.push(r);e=$.grep(u,function(n){return n.row.length>1});this.TableRowSpan(e)};this.ShowSortStaus=function(t){n.find(".tableSort th label[orderbyproperty="+t.orderByProperty+"]").addClass(t.ascending==!0?"sort-up":"sort-down")}};
/**** fm-tree-menu-x.js *****/
_shared.directive("fmTreeMenuX",["$compile",function(){return{restrict:"E",replace:!0,scope:{treeData:"="},link:function(n,t){var i=$(t);$('<fm-tree>                        <div class="fm-text-find" style="margin-bottom: 5px;"><i class="icon icon-search"><\/i><input class="form-control input-sm" type="text" placeholder="搜索"><\/div>                        <ul class="tree-view" style="min-height: calc(100vh - 190px);">                            <li  style="position:relative;height:80px;">\t\t                        <div class="content-spinner-bar" style="position:absolute;top: 40%;"><div class="bounce1"><\/div><div class="bounce2"><\/div><div class="bounce3"><\/div><\/div>\t                        <\/li>                        <\/ul ><\/fm-tree>').appendTo(i);n.$watch("treeData",function(n){n&&n.length&&i.treeMenu(n[0],{showMenu:function(n){var t=n.data.menu||[];return t.length},event:{showMenu:function(n,t){var f=t.data,r=f.menu||[],u,i;if(r.length){for(u=[],i=0;i<r.length;i++)(function(){var f=r[i];u.push({text:f.text,icon:f.icon,click:function(){typeof f.click=="function"&&f.click(n,t.data,function(){t.dom.removeClass("is-latest")})}})})();t.showMenu({title:f.name,item:u})}},nodedblClick:function(n,t){var i=t.data,r=i.dbclick||function(){};r(n,i)}},addNode:function(n){n.data.isLatest=="0"&&n.dom.addClass("is-latest")},sort:function(n,t,i){return n.depth<1?-1:t.text.localeCompare(i.text)}})})}}}]);
/**** fm-tree-menu.js *****/
_shared.directive("fmTreeMenu",["$compile","dialog","mabp.app.module","$timeout","$http",function(n,t,i,r){return{restrict:"E",replace:!0,templateUrl:"/treeMenu.html",scope:{treeData:"=",textField:"@",findText:"=",valueField:"@",itemDbClicked:"&",itemIconClicked:"&"},controller:["$scope",function(n){n.activeItem=null;n.menuOpen=!1;n.isQuickSelect=!0;n.itemExpended=function(n,t){n.$$isExpend=!n.$$isExpend;t.stopPropagation()};n.getItemIcon=function(n){return n.children!=null&&n.children.length>0?n.$$isExpend?"treeicon icon_open":"treeicon icon_close":"treeicon icon_blank"};n.itemIconClicked=function(t,i){console.log(t,i);(n.activeItem==null||n.activeItem.id!=i.id)&&(n.activeItem=i);n.menuOpen=!0;t.stopPropagation()};n.itemDbClicked=function(n,t){t.dbclick?t.dbclick(n,t):t.$$isExpend=!t.$$isExpend};n.findMenu=function(){var i=[],t,r;for(n.findItem(n.treeData[0].children,function(n){n.$$isHide=!0;n.$$isExpend=!1}),n.findItem(n.treeData[0].children,function(t){(!n.findTxt||t.text.toLowerCase().indexOf(n.findTxt.toLowerCase())>=0)&&i.push(t)}),t=0;t<i.length;t++)if(i[t].$$isHide=!1,i[t].nodePath!=null)for(r=0;r<i[t].nodePath.length;r++)!n.findTxt||(i[t].nodePath[r].$$isExpend=!0),i[t].nodePath[r].$$isHide=!1};n.findItem=function(t,i){for(var r=0;r<t.length;r++)i(t[r]),t[r].children!=null&&t[r].children.length>0&&n.findItem(t[r].children,i)};n.keyPress=function(t){n.isQuickSelect||t.keyCode!=13||n.findMenu()};n.keyDown=function(){n.isQuickSelect&&r(function(){n.findMenu()},50)};angular.element(document).on("mousedown",function(t){t==t&&n.menuOpen&&r(function(){n.menuOpen=!1},0)})}]}}]);
/**** fm-tree.js *****/
_shared.directive("fmTree",["$compile","dialog","mabp.app.module","treeTool",function(n,t,i,r){return{restrict:"E",template:"<div><\/div>",scope:{ismulti:"=",mustleaf:"=",treeData:"=",selectData:"=",canChecked:"=",textField:"@",valueField:"@",isLeaf:"&",itemClicked:"&",itemCheckedChanged:"&",itemTemplateUrl:"@"},link:function(n,t){n.$watch("treeData",function(){var i=n.treeData;if(i!=null&&i.length!==0){var e=n.ismulti===!0?["checkbox"]:[],u=r.toFormatTreeJson(i,_.map(n.selectData,"id"),n.mustleaf,n.textField,n.valueField),f=r.toArrayJson(u);$(t).jstree({checkbox:{keep_selected_style:!0,three_state:!1,undetermined:!1},core:{themes:{responsive:!1},data:u},plugins:e});$(t).on("select_node.jstree",function(t,i){n.selectData=_.filter(f,function(n){return i.selected!=null&&i.selected.indexOf(n.id)>-1});n.$apply();n.ismulti||i.selected.length!==1||n.itemClicked({item:n.selectData[0]})});$(t).on("deselect_node.jstree",function(t,i){n.selectData=_.filter(f,function(n){return i.selected!=null&&i.selected.indexOf(n.id)>-1});n.$apply()})}})}}}]);
/**** ma-code-sql.js *****/
_shared.directive("maCodeSql",["$compile","$timeout","mabp.app.module","appSession",function(n,t,i,r){return{restrict:"E",replace:!0,require:"^ngModel",template:function(){return'<div class="fm-code fm-code-sql"><pre class="prettyprint linenums lang-sql"><\/pre><textarea spellcheck="false" ng-model="ngModel" ng-click="event_Mouseclick()" ng-blur="event_Blur()"><\/textarea><div class="tool"><\/div><div ng-hide="!openOption" class="option" title="" style=""><div class="option-item"><ul class="fm-code-menu"><li ng-class="{\'active\':item.id==selectKeyword.id}" ng-repeat="item in menus | filter: findText" style="" ng-click="selectItem($event, item)" ng-mouseover="event_selectItemMouseOver($event,item)"><i class="icon {{::keyWordType[item.group].icon}}"><\/i>&nbsp;{{::item.name}}&nbsp;<span class="fm-code-menu-item-type">{{::item.type}}<\/span><span class="fm-code-menu-item-remark">{{::["tablename","columnname"].indexOf(item.group) >= 0 ? item.remark : ""}}<\/span><\/li><\/ul><\/div><div class="menu-remark" ng-class="{\'p-left\':pX>0}" ng-hide="!selectKeyword"><span class="menu-remark-type">{{keyWordType[selectKeyword.group].name}}<\/span><hr /><span class="menu-remark-title">{{selectKeyword.remark}}<\/span><br /><span class="menu-remark-title">{{selectKeyword.tablename}}<\/span><\/div><\/div><\/div>'},scope:{ngModel:"=",disabled:"=",tooltips:"=",menus:"=",openOption:"=",selectKeyword:"=",pX:"="},link:function(n,u){var b,k,p,d,e,nt;n.selectKeyword={text:"",groupname:"",name:"",tablename:""};n.keyWordType={systablename:{icon:"icon-table text-warning",name:"系统表"},tablename:{icon:"icon-table text-info",name:"业务表"},keyword:{icon:"icon-cube text-primary",name:"关键字"},syscolumnname:{icon:"icon-columns text-special",name:"系统表字段"},columnname:{icon:"icon-columns text-special",name:"业务表字段"},quickinput:{icon:"icon-code text-success",name:"代码段"},sqlfunction:{icon:"icon-lightbulb text-danger",name:"SQL Server函数"},alias:{icon:"icon-bookmark-empty text-muted",name:"表别名"}};n.openOption=n.openOption||!1;n.menus||(n.menus=[]);var f=-1,l="",s=0,c=0,g=/[^a-zA-z0-9_]/,o=[],tt=-1,v=[],w=[],a=[{id:0,text:n.ngModel,date:new Date,selectionStart:0,selectionEnd:0}],h=0,y=[];for(n.isDot=!1,n.dotTableName="",n.pX=0,n.printDiv=u.find(".prettyprint"),n.textControl=u.find("textarea"),prettyPrint_TextArea=u.find("textarea")[0],n.optionDiv=u.find(".option"),n.optionItems=u.find(".option-item"),n.optionRemarkDiv=u.find(".menu-remark"),n.findText=function(t){return n.isDot?["syscolumnname","columnname"].indexOf(t.group)>=0&&t.tablename.toLowerCase()==n.dotTableName.toLowerCase()?!0:!1:f<0||l.length<1||t.group=="columnname"&&v.indexOf(t.tablename)==-1?!1:t.name.toLowerCase().indexOf(l.toLowerCase())==0?!0:!1},n.event_Blur=function(){},b=[{name:"ssf",text:"SELECT * FROM"},{name:"scf",text:"SELECT COUNT(*) FROM"},{name:"st100",text:"SELECT TOP 100 * FROM"},{name:"ij",text:"INNER JOIN"},{name:"lj",text:"LEFT JOIN"},{name:"rj",text:"RIGHT JOIN"},{name:"fj",text:"FULL JOIN"},{name:"bt",text:"BEGIN TRANSACTION"},{name:"be",text:"begin ? end"},{name:"dec",text:"DECIMAL(18,2)"},{name:"nvc",text:"NVARCHAR(50)"}],e=0;e<b.length;e++)n.menus.push({id:n.menus.length+1,text:b[e].text,group:"quickinput",name:b[e].name,remark:b[e].text.replace("?","").toLowerCase()});for(k=[{group:"sqlfunction",name:"l",text:"L(?,'zh-CN')",remark:"[MC]获取表达式或字段的多语言。"},{group:"sqlfunction",name:"getdate",text:"GETDATE(?)",remark:"以Datetime的缺省格式返回系统当前的日期和时间。"},{group:"sqlfunction",name:"count",text:"COUNT(?)",remark:"返回指定列中唯一值的个数。"},{group:"sqlfunction",name:"length",text:"LENGTH(?)",remark:"返回指定字符列或表达式的长度。"},{group:"sqlfunction",name:"trim",text:"TRIM(?)",remark:"删除指定列或表达式前后的字符。"},{group:"sqlfunction",name:"newid",text:"NEWID()",remark:"返回一个新的GUID值。"},{group:"sqlfunction",name:"sum",text:"SUM(?)",remark:"返回指定列或表达式的数值和。"},{group:"sqlfunction",name:"avg",text:"AVG(?)",remark:"返回指定列或表达式中的数值平均值。"},{group:"sqlfunction",name:"min",text:"MIN(?)",remark:"返回指定列或表达式中的数值最小值。"},{group:"sqlfunction",name:"max",text:"MAX(?)",remark:"返回指定列或表达式中的数值最大值。"},{group:"sqlfunction",name:"day",text:"DAY(?)",remark:"返回指定表达式中的日期值。"},{group:"sqlfunction",name:"month",text:"MONTH(?)",remark:"返回指定表达式中的月份值。"},{group:"sqlfunction",name:"year",text:"YEAR(?)",remark:"返回指定表达式中的年份值。"},{group:"sqlfunction",name:"ascii",text:"ASCII(?)",remark:"返回字符表达式最左端字符的ASCII码值。"},{group:"sqlfunction",name:"char",text:"CHAR(?)",remark:"将ASCII码转换为字符。如果没有输入0~255之间的ASCII码值，CHAR()返回NULL 。"},{group:"sqlfunction",name:"lower",text:"LOWER(?)",remark:"将字符串全部转为小写。"},{group:"sqlfunction",name:"upper",text:"UPPER(?)",remark:"将字符串全部转为大写。"},{group:"sqlfunction",name:"str",text:"STR(?)",remark:"把数值型数据转换为字符型数据。"},{group:"sqlfunction",name:"ltrim",text:"LTRIM(?)",remark:"把字符串头部的空格去掉。"},{group:"sqlfunction",name:"rtrim",text:"RTRIM(?)",remark:"把字符串尾部的空格去掉。"},{group:"sqlfunction",name:"left",text:"LEFT(?)",remark:"返回字符串左起?个字符。"},{group:"sqlfunction",name:"right",text:"RIGHT(?)",remark:"返回字符串右起?个字符。"},{group:"sqlfunction",name:"substring",text:"SUBSTRING(?)",remark:"返回字符串第?个字符起共?个字符的部分。"},{group:"sqlfunction",name:"charindex",text:"CHARINDEX(?)",remark:"返回字符串中某个指定的子串出现的开始位置。（不可使用通配符）"},{group:"sqlfunction",name:"patindex",text:"PATINDEX(?)",remark:"返回字符串中某个指定的子串出现的开始位置。（可使用通配符）"},{group:"sqlfunction",name:"quotename",text:"QUOTENAME(?)",remark:"返回被特定字符括起来的字符串。"},{group:"sqlfunction",name:"replicate",text:"REPLICATE(?)",remark:"返回一个重复?次的字符串。"},{group:"sqlfunction",name:"reverse",text:"REVERSE(?)",remark:"将指定的字符串的字符排列顺序颠倒。"},{group:"sqlfunction",name:"replace",text:"REPLACE(?)",remark:"返回被替换了指定子串的字符串。"},{group:"sqlfunction",name:"space",text:"SPACE(?)",remark:"返回一个有指定长度的空白字符串。"},{group:"sqlfunction",name:"stuff",text:"STUFF(?)",remark:"用另一子串替换字符串指定位置、长度的子串。"},{group:"sqlfunction",name:"convert",text:"CONVERT(?)",remark:"用于转换数据的类型。"},{group:"sqlfunction",name:"weekday",text:"WEEKDAY(?)",remark:"返回指定表达式中的当周星期几。"},{group:"sqlfunction",name:"dateadd",text:"DATEADD(?)",remark:"返回指定日期加上指定的额外日期间隔产生的新日期。"},{group:"sqlfunction",name:"datediff",text:"DATEDIFF(?)",remark:"返回两个指定日期在datepart方面的不同之处，即前者超过后者的差距值，其结果值是一个带有正负号的整数值。"},{group:"sqlfunction",name:"datename",text:"DATENAME(?)",remark:"以字符串的形式返回日期的指定部分此部分。由datepart来指定。"},{group:"sqlfunction",name:"abs",text:"ABS(?)",remark:"返回指定数字的绝对值。"},{group:"sqlfunction",name:"mod",text:"MOD(?)",remark:"返回指定数字除以除数后的余数。"},{group:"sqlfunction",name:"sqrt",text:"SQRT(?)",remark:"返回指定表达式的平方根值。"},{group:"sqlfunction",name:"round",text:"ROUND(?)",remark:"返回指定表达式小数点后?位经过四舍五入后的值。"},{group:"sqlfunction",name:"floor",text:"FLOOR(?)",remark:"返回指定表达式截去小数位后的值。"},{group:"sqlfunction",name:"range",text:"RANGE(?)",remark:"返回指定列的最大值与最小值之差。"}],e=0;e<k.length;e++)n.menus.push({id:n.menus.length+1,text:k[e].text,group:"sqlfunction",name:k[e].name,remark:k[e].remark});for(p=["AppAuditLog","AppBusinessTable","AppBusinessTableColumn","AppBusinessTableColumnChangeHistory","AppEnterprise","AppEnterpriseLanguage","AppEnterpriseSetting","AppEnterpriseUser","AppLanguage","AppPage","AppUser","BpmBasicData","BpmEnum","BpmGroup","BpmInformTemplate","BpmInterfaceConfig","BpmInterfaceMappingConfig","BpmInterfaceServerConfig","BpmJob","BpmJobUser","BpmLanguage","BpmModule","BpmModuleFavourite","BpmModulePageRight","BpmModuleRight","BpmReport","BpmRole","BpmRoleJob","BpmViewTable","BpmViewTableColumn","InstAgent","InstAttachment","InstDraft","InstFile","InstLanguage","InstMail","InstProc","InstProcLink","InstSerial","InstShare","InstTask","InstTaskCopy","InstTaskHeader","InstTaskMark","InstVariable","pur_inst_processor","WfdCategory","WfdWorkflow","WfdWorkflowLink","WfdWorkflowLinkPoint","WfdWorkflowNode","WfdWorkflowNodeAction","WfdWorkflowNodeCopyConfig","WfdWorkflowNodeInformConfig","WfdWorkflowNodePreProcessorConfig","WfdWorkflowObject","WfdWorkflowProcessor","WfdWorkflowRight","WfdWorkflowVariable"],d=["SELECT","FROM","SET","UPDATE","DELETE","INSERT","INTO","INNER","IS","JOIN","ADD","OR","ORDER","BY","GROUP","HAVING","WHERE","ALL","ALTER","AND","ANY","APPLY","AS","ASC","AUTHORIZATION","BACKUP","BEGIN","BETWEEN","BREAK","BROWSE","BULK","CASCADE","CASE","CHECK","CHECKPOINT","CLOSE","CLUSTERED","COALESCE","COLLATE","COLUMN","COMMIT","COMPUTE","CONNECT","CONSTRAINT","CONTAINS","CONTAINSTABLE","CONTINUE","CONVERT","CREATE","CROSS","CURRENT","CURRENT_DATE","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","CURSOR","DATABASE","DBCC","DEALLOCATE","DECLARE","DEFAULT","DENY","DESC","DISK","DISTINCT","DISTRIBUTED","DOUBLE","DROP","DUMMY","DUMP","ELSE","END","ERRLVL","ESCAPE","EXCEPT","EXEC","EXECUTE","EXISTS","EXIT","FETCH","FILE","FILLFACTOR","FOLLOWING","FOR","FOREIGN","FREETEXT","FREETEXTTABLE","FULL","FUNCTION","GOTO","GRANT","HOLDLOCK","IDENTITY","IDENTITYCOL","IDENTITY_INSERT","IF","IN","INDEX","INTERSECT","KEY","KILL","LEFT","LIKE","LINENO","LOAD","MATCH","MATCHED","MERGE","NATURAL","NATIONAL","NOCHECK","NONCLUSTERED","NOCYCLE","NOT","NULL","NULLIF","OF","OFF","OFFSETS","ON","OPEN","OPENDATASOURCE","OPENQUERY","OPENROWSET","OPENXML","OPTION","OUTER","OVER","PARTITION","PERCENT","PIVOT","PLAN","PRECEDING","PRECISION","PRIMARY","PRINT","PROC","PROCEDURE","PUBLIC","RAISERROR","READ","READTEXT","RECONFIGURE","REFERENCES","REPLICATION","RESTORE","RESTRICT","RETURN","REVOKE","RIGHT","ROLLBACK","ROWCOUNT","ROWGUIDCOL","ROWS?","RULE","SAVE","SCHEMA","SESSION_USER","SETUSER","SHUTDOWN","SOME","START","STATISTICS","SYSTEM_USER","TABLE","TEXTSIZE","THEN","TO","TOP","TRAN","TRANSACTION","TRIGGER","TRUNCATE","TSEQUAL","UNBOUNDED","UNION","UNIQUE","UNPIVOT","UPDATETEXT","USE","USER","USING","VALUES","VARYING","VIEW","WAITFOR","WHEN","WHILE","WITH","WITHIN","WRITETEXT","XML"],e=0;e<d.length;e++)n.menus.push({id:n.menus.length+1,text:d[e],group:"keyword",name:d[e],remark:d[e].toLowerCase()});for(e=0;e<p.length;e++)n.menus.push({id:n.menus.length+1,name:p[e],group:"systablename",text:p[e],remark:p[e]});i.getAllTableName().then(function(i){for(var r=0;r<i.length;r++)p.push("(dbo.)?"+i[r].schemaName),n.menus.push({id:n.menus.length+1,name:i[r].schemaName.toLowerCase(),group:"tablename",text:i[r].schemaName,remark:i[r].name});PR.registerLangHandler(PR.createSimpleLexer([[PR.PR_PLAIN,/^[\t\n\r \xA0]+/,null,"\t\n\r  "],[PR.PR_STRING,/^(?:"(?:[^\"\\]|\\.)*"|'(?:[^\'\\]|\\.)*')/,null,"\"'"]],[[PR.PR_COMMENT,/^(?:--[^\r\n]*|\/\*[\s\S]*?(?:\*\/|$))/],[PR.PR_KEYWORD,/^(?:ADD|ALL|ALTER|AND|ANY|APPLY|AS|ASC|AUTHORIZATION|BACKUP|BEGIN|BETWEEN|BREAK|BROWSE|BULK|BY|CASCADE|CASE|CHECK|CHECKPOINT|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMN|COMMIT|COMPUTE|CONNECT|CONSTRAINT|CONTAINS|CONTAINSTABLE|CONTINUE|CONVERT|CREATE|CROSS|CURRENT|CURRENT_DATE|CURRENT_TIME|CURRENT_TIMESTAMP|CURRENT_USER|CURSOR|DATABASE|DBCC|DEALLOCATE|DECLARE|DEFAULT|DELETE|DENY|DESC|DISK|DISTINCT|DISTRIBUTED|DOUBLE|DROP|DUMMY|DUMP|ELSE|END|ERRLVL|ESCAPE|EXCEPT|EXEC|EXECUTE|EXISTS|EXIT|FETCH|FILE|FILLFACTOR|FOLLOWING|FOR|FOREIGN|FREETEXT|FREETEXTTABLE|FROM|FULL|FUNCTION|GOTO|GRANT|GROUP|HAVING|HOLDLOCK|IDENTITY|IDENTITYCOL|IDENTITY_INSERT|IF|IN|INDEX|INNER|INSERT|INTERSECT|INTO|IS|JOIN|KEY|KILL|LEFT|LIKE|LINENO|LOAD|MATCH|MATCHED|MERGE|NATURAL|NATIONAL|NOCHECK|NONCLUSTERED|NOCYCLE|NOT|NULL|NULLIF|OF|OFF|OFFSETS|ON|OPEN|OPENDATASOURCE|OPENQUERY|OPENROWSET|OPENXML|OPTION|OR|ORDER|OUTER|OVER|PARTITION|PERCENT|PIVOT|PLAN|PRECEDING|PRECISION|PRIMARY|PRINT|PROC|PROCEDURE|PUBLIC|RAISERROR|READ|READTEXT|RECONFIGURE|REFERENCES|REPLICATION|RESTORE|RESTRICT|RETURN|REVOKE|RIGHT|ROLLBACK|ROWCOUNT|ROWGUIDCOL|ROWS?|RULE|SAVE|SCHEMA|SELECT|SESSION_USER|SET|SETUSER|SHUTDOWN|SOME|START|STATISTICS|SYSTEM_USER|TABLE|TEXTSIZE|THEN|TO|TOP|TRAN|TRANSACTION|TRIGGER|TRUNCATE|TSEQUAL|UNBOUNDED|UNION|UNIQUE|UNPIVOT|UPDATE|UPDATETEXT|USE|USER|USING|VALUES|VARYING|VIEW|WAITFOR|WHEN|WHERE|WHILE|WITH|WITHIN|WRITETEXT|XML)(?=[^\w-]|$)/i,null],[PR.PR_TABLENAME,new RegExp("^(?:"+p.join("|")+")(?=[^\\w-]|$)","i")],[PR.PR_VARIABLE,/^(?:<%(?:[^\"\\%]|\\.)*%>)/,null],[PR.PR_LITERAL,/^[+-]?(?:0x[\da-f]+|(?:(?:\.\d+|\d+(?:\.\d*)?)(?:e[+\-]?\d+)?))/i],[PR.PR_PLAIN,/^[a-z_][\w-]*/i],[PR.PR_PUNCTUATION,/^[^\w\t\n\r \xA0\"\'][^\w\t\n\r \xA0+\-\"\']*/]]),["sql"]);t(function(){var t=n.textControl.val().replace(/\t/g,"    ");n.printDiv.html(t+"<br />");n.printDiv.removeClass("prettyprinted");prettyPrint()})});n.textControl.on("input",function(r){var b,it,k,p,e,d,tt;for(h++,a[h]={id:a.length+1,text:r.target.value,date:new Date,selectionStart:r.target.selectionStart,selectionEnd:r.target.selectionEnd},a.splice(h+2,a.length),b=nt.getInputPositon(r.target),t(function(){var h=n.textControl.val().replace(/\t/g,"    "),a,p,r,e;if(n.printDiv.html(h+"<br />"),n.printDiv.removeClass("prettyprinted"),prettyPrint(),r=-1,n.dotTableName="",n.optionItems.scrollTop(0),h[f-1]=="."){for(n.isDot=!0,r=f-2<0?0:f-2;r>=0;r--)if(g.test(h[r])){r++;break}for(l=h.substring(r,f-1),a=0;a<y.length;a++)if(y[a].name==l){l=y[a].tablename;break}n.dotTableName=l;s=f;c=f;o=n.getFindItems()}else{for(n.isDot=!1,r=f-1<0?0:f-1;r>=0;r--)if(g.test(h[r])){r++;break}l=h.substring(r,f);s=r;c=f;o=n.getFindItems()}for(o.length>0&&t(function(){n.selectKeyword=o[0]}),n.openOption=l.length>=1&&o.length>0,p=u.find(".sql_tablename"),r=0;r<p.length;r++)e=p.eq(r).text(),e.toLowerCase().indexOf("dbo.")==0&&(e=e.substring(4)),v.indexOf(e)==-1&&(v.push(e),i.getAllColumnName(e).then(function(i){t(function(){for(var t=0;t<i.length;t++)n.menus.push({id:n.menus.length+1,name:i[t].schemaName.toLowerCase(),group:"columnname",text:i[t].schemaName.toLowerCase(),tablename:i[t].viewTableId,type:i[t].type,remark:i[t].name}),w.push(n.menus[n.menus.length-1])})}))}),e=y.length-1;e>=0;e--)n.menus.splice(y[e].id-1,1);for(y=[],it=new RegExp("(("+v.join("|")+")[ ]+(as)?([ ]+)?[a-z0-9_.]+)|([a-z0-9_.]+?[ ]*=[ ]*\\(?[ ]*[a-z0-9_.]+([ ]*\\))?)","gi"),p=[];(k=it.exec(n.ngModel))!=null;)p.push({text:k[0],index:k.index,length:k.length,aliastype:!!k[5]});for(e=0;e<p.length;e++)p[e].aliastype||(d=new RegExp("("+v.join("|")+")(?=[ ]+(as)?([ ]+)?[a-z0-9_.]+)","gi").exec(p[e].text),!d||(tt=p[e].text.substr(p[e].text.lastIndexOf(" ")+1),n.menus.push({id:n.menus.length+1,aliastype:p[e].aliastype,text:tt,group:"alias",name:tt,remark:"业务表别名：",tablename:d[0]}),y.push(n.menus[n.menus.length-1])));t(function(){if(n.openOption){var t=u.offset().left,i=u.find(".pointDiv").position().left+10,r=n.optionDiv.width(),f=n.optionRemarkDiv.width();n.pX=$(document).width()<t+i+r?2:$(document).width()<t+i+r+f?1:0}});t(function(){var t=n.optionDiv.width()<=0?200:n.optionDiv.width();switch(n.pX){case 0:case 1:n.optionDiv.css({top:b.top+10,left:b.left+5});break;case 2:n.optionDiv.css({top:b.top+10,left:b.left-t})}})});n.optionItems.on("mousewheel",function(t){return t.originalEvent.deltaY>0?n.optionItems.scrollTop(n.optionItems.scrollTop()+69):n.optionItems.scrollTop(n.optionItems.scrollTop()-69),!1});t(function(){n.printDiv.html(n.ngModel);n.printDiv.removeClass("prettyprinted");prettyPrint()},200);nt={getInputPositon:function(n){var r,h;if(document.selection)return n.focus(),r=document.selection.createRange(),{left:r.boundingLeft,top:r.boundingTop,bottom:r.boundingTop+r.boundingHeight};var c=this,e="{$clone_div}",o="{$cloneLeft}",s="{$cloneFocus}",f=n[e]||document.createElement("div"),t=n[s]||document.createElement("span"),i=n[o]||document.createElement("span"),a=c._offset(n),l=this._getFocus(n);n[e]||(n[e]=f,n[s]=t,n[o]=i,f.appendChild(i),i.className="prettyprint linenums lang-sql fm-code-tooltext",i.style.position="static",i.style.cssText='font-family: "courier new","Microsoft YaHei";',f.appendChild(t),u.append(f),t.innerHTML="|",t.className="pointDiv",t.style.cssText="position:static;display:inline-block;width:0px;overflow:hidden;z-index:-100;word-wrap:break-word;word-break:break-all;",f.style.cssText="visibility:hidden;display:inline-block;position:absolute;z-index:-100;word-wrap:break-word;word-break:break-all;overflow:hidden;top:4px;left:47px;width:100%;height:100%;line-height:0 !important;");h="<span>"+n.value.substring(0,l).replace(/</g,"<").replace(/>/g,">").replace(/\n/g,"<\/span><br/><span>").replace(/\s/g,"&nbsp;")+"<\/span>";i.innerHTML=h;try{}catch(v){}return{left:t.offsetLeft+42,top:t.offsetTop}},_getFocus:function(n){var t=0,i,r;if(document.selection)if(n.focus(),i=document.selection.createRange(),n.nodeName==="TEXTAREA")for(r=i.duplicate(),r.moveToElementText(n),t=-1;r.inRange(i);)r.moveStart("character"),t++;else n.nodeName==="INPUT"&&(i.moveStart("character",-n.value.length),t=i.text.length);else(n.selectionStart||n.selectionStart=="0")&&(t=n.selectionStart);return t},_offset:function(n){return{left:$(n).position().left,top:$(n).position().top,right:$(n).width(),bottom:$(n).height()}}};n.event_selectItemMouseOver=function(t,i){n.selectKeyword=i};n.insertTxt=function(t,i){c+=i.length+1;s=c;f+=i.length+1;n.ngModel=n.ngModel.insert(i,c);n.printDiv.html(n.ngModel);n.printDiv.removeClass("prettyprinted");prettyPrint();n.selectKeyword={text:"",groupname:"",name:"",tablename:""}};n.selectItem=function(i,r,u){u||(u="");try{n.ngModel=r.text.indexOf("?")>=0?n.ngModel.insert(r?r.text.replace("?",""):"",c,c-s):n.ngModel.insert((r?r.text:"")+u,c,c-s)}catch(f){console.error(f)}n.printDiv.html(n.ngModel);n.printDiv.removeClass("prettyprinted");prettyPrint();n.selectKeyword={text:"",groupname:"",name:"",tablename:""};n.textControl[0].focus();t(function(){n.openOption=!1});t(function(){var t,i;s<0&&(s=0);t=r.text.indexOf("?")>=0?r.text.indexOf("?"):r.text.length+u.length;n.textControl[0].selectionStart?(n.textControl[0].selectionStart=s+(r?t:0),n.textControl[0].selectionEnd=s+(r?t:0)):(i=n.textControl[0].createTextRange(),i.move("character",s+(r?t:0)),i.select())},50)};n.event_Mouseclick=function(){var r,u,i;for(n.isDot=!1,r=nt.getInputPositon(event.target),t(function(){var t=n.optionDiv.width()<=0?200:n.optionDiv.width();switch(n.pX){case 0:case 1:n.optionDiv.css({top:r.top+10,left:r.left+5});break;case 2:n.openOption&&n.optionDiv.css({top:r.top+10,left:r.left+5-t})}}),f=event.target.selectionStart,u=n.ngModel,i=-1,i=f-1<0?0:f-1;i>=0;i--)if(g.test(u[i])){i++;break}s=i;c=f;l=u.substring(i,f);n.openOption=!1};n.textControl.on("keydown",function(u){var e,v,p,y;if(tt=u.keyCode,e=n.getIndex(n.selectKeyword),o=n.getFindItems(),e==-1&&t(function(){n.selectKeyword=o[0];e=0}),f=u.target.selectionStart+1,u.ctrlKey)switch(u.keyCode){case 74:return t(function(){n.optionItems.scrollTop(0);n.openOption=!n.openOption}),!1;case 89:return h<a.length-1&&(h++,t(function(){n.ngModel=a[h].text;n.printDiv.html(n.ngModel);n.printDiv.removeClass("prettyprinted");prettyPrint()}),t(function(){u.target.selectionStart=a[h].selectionStart;u.target.selectionEnd=a[h].selectionEnd})),u.returnValue=!1,!1;case 90:return h>0&&(h--,t(function(){n.ngModel=a[h].text;n.printDiv.html(n.ngModel);n.printDiv.removeClass("prettyprinted");prettyPrint()}),t(function(){u.target.selectionStart=a[h].selectionStart;u.target.selectionEnd=a[h].selectionEnd})),u.returnValue=!1,!1}if(u.keyCode==88&&u.altKey){v=n.textControl[0].selectionStart<n.textControl[0].selectionEnd?n.ngModel.substring(n.textControl[0].selectionStart,n.textControl[0].selectionEnd):n.ngModel;v=v.replace(/<%LanguageCulture%>/g,"zh-cn").replace(/<%UserId%>/g,r.userId);p=/<%.*?%>/m;y="";do y=p.exec(v),y&&(v=v.replace(new RegExp(y,"g"),prompt("变量"+y[0]+"的值为：")));while(y!=null);return console.info("SQL语句：\n"+v),i.getSql({sql:v}).then(function(n){console.table(n)}),!1}switch(u.keyCode){case 8:f-=2;return;case 9:return n.openOption?(n.selectItem(u,o[e]," "),!1):(n.insertTxt(u,"    "),!1);case 13:return n.openOption?(n.selectItem(u,o[e]),!1):void 0;case 37:f=u.target.selectionStart-1;break;case 39:f=u.target.selectionStart+1;break;case 38:return n.openOption?(t(function(){e>0?(e--,t(function(){n.selectKeyword=o[e]})):(e=o.length-1,t(function(){n.selectKeyword=o[o.length-1]}));t(function(){n.optionItems.scrollTop()/23>e?n.optionItems.scrollTop(e*23):n.optionItems.scrollTop()/23+7<e&&n.optionItems.scrollTop((e-8)*23)})}),!1):void 0;case 40:return n.openOption?(t(function(){e<o.length-1?(e++,t(function(){n.selectKeyword=o[e]})):(e=0,t(function(){n.selectKeyword=o[0]}));t(function(){n.optionItems.scrollTop()/23+7<e?n.optionItems.scrollTop((e-8)*23):n.optionItems.scrollTop()/23>e&&n.optionItems.scrollTop(e*23)})}),!1):void 0;default:return}t(function(){for(var i=n.ngModel,t=-1,t=f-1<0?0:f-1;t>=0;t--)if(g.test(i[t])){t++;break}s=t;c=f;l=i.substring(t,f);n.optionItems.scrollTop(0);n.openOption=l.length>=1&&o.length>0})});n.getIndex=function(t){var r,i;if(!t||t.id==""||(r=n.getFindItems(),!r))return-1;for(i=0;i<r.length;i++)if(t.id==r[i].id)return i;return-1};n.getFindItems=function(){var r=[],i,t;if(n.isDot)for(t=0;t<w.length;t++)n.dotTableName==w[t].tablename&&r.push(w[t]);else{if(i=n.ngModel.substring(s,c).toLowerCase(),!i)return[];if(!!n.menus&&n.menus.length>0)for(t=0;t<n.menus.length;t++)(v.indexOf(n.menus[t].tablename)>=0&&n.menus[t].group=="columnname"&&n.menus[t].name.toLowerCase().indexOf(i)==0||n.menus[t].group!="columnname"&&n.menus[t].name.toLowerCase().indexOf(i)==0)&&r.push(n.menus[t])}return r};n.$watch("ngModel",function(){for(var r,e=u.find(".sql_tablename"),f=0;f<e.length;f++)r=e.eq(f).text(),r.toLowerCase().indexOf("dbo.")==0&&(r=r.substring(4)),v.indexOf(r)==-1&&(v.push(r),i.getAllColumnName(r).then(function(i){t(function(){for(var t=0;t<i.length;t++)n.menus.push({id:n.menus.length+1,name:i[t].schemaName.toLowerCase(),group:"columnname",text:i[t].schemaName.toLowerCase(),tablename:i[t].viewTableId,type:i[t].type,remark:i[t].name}),w.push(n.menus[n.menus.length-1])})}))})}}}]);
/**** maCheckbox.js *****/
_shared.directive("maCheckbox",["$compile",function(){return{restrict:"E",replace:!0,template:function(){return'<div class="ma-checkbox" {{disabled}} ng-click="toggle()"><span class="dot"><\/span><\/div>'},scope:{ngModel:"=",disabled:"="},require:"ngModel",link:function(n,t,i,r){n.$watch("ngModel",function(){n.enable=n.newValue||!1;n.ngModel===!0?t.addClass("on"):t.removeClass("on")});n.toggle=function(){(i.disabled==undefined||i.disabled==="false")&&(t.hasClass("on")?(n.enable=!1,t.removeClass("on")):(n.enable=!0,t.addClass("on")),r.$setViewValue(n.enable))}}}}]);
/**** maSelect.js *****/
_shared.directive("maSelect",["dialog","$timeout","$compile","mabp.app.module",function(n,t,i,r){return{restrict:"E",replace:!0,require:"ngModel",template:function(){return"<div><\/div>"},scope:{items:"=",selectItem:"=",selectValue:"=",ngModel:"=",selectText:"=",isOpen:"=",findText:"=",datacode:"=",callbackFunc:"&"},compile:function(){return{pre:function(){},post:function(n,u,f,e){var h,c,o,s;if(f.displayMember||(f.displayMember="text"),f.valueMember||(f.valueMember="id"),n.ismulti=f.ismulti!=undefined&&f.ismulti!=="false"&&n.ismulti===undefined?!0:!1,isnull=f.isnull==undefined?!0:f.isnull!=undefined&&f.isnull!="false",f.pageState=$(".fm-content").attr("page-state"),h=null,!!f.pageState)switch(""+f.pageState){case"1":h="normal";break;case"2":h="disabled";break;case"3":h="readonly"}n.state=n.state===undefined||!!f.state?f.state:n.state;f.readonly!==undefined&&f.readonly!="false"?n.state="readonly":f.disabled!==undefined&&f.disabled!="false"?n.state="disabled":f.hidden!==undefined&&f.hidden!="false"?n.state="hidden":f.normal!==undefined&&f.normal!="false"?n.state="normal":n.state||(n.state=h||"normal");n.datatype=n.datatype===undefined&&!!f.datatype?f.datatype:n.datatype;n.datatype||(n.datatype="source");f.view!==undefined&&f.view!="false"?(n.datatype="view",!f.view||(n.datacode=f.view)):f.source!==undefined&&f.source!="false"?n.datatype="source":f.dataitem!==undefined&&f.dataitem!="false"&&(n.datatype="dataitem",!f.dataitem||(n.datacode=f.dataitem));n.$watch("datacode",function(t,i){t==i||!t||!i||(n.selectItem=null,n.ngModel=null,n.selectText="");var u=n.datacode;!f.datacodeFormat||(u=f.datacodeFormat.fill(n.datacode));switch(n.datatype){case"view":r.getViewTable({code:u}).then(function(t){var r,i;if(!!t){for(r={},i=0;i<t.displayColumList.length;i++)t.displayColumList[i].displayColumn=t.displayColumList[i].displayColumn.substring(0,1).toLowerCase()+t.displayColumList[i].displayColumn.substring(1),r[t.displayColumList[i].displayColumn]=t.displayColumList[i].name;n.items=t}});break;case"dataitem":r.getBasicData({code:u}).then(function(t){!t||(n.items=t.data)})}});switch(n.datatype){case"view":r.getViewTable({code:n.datacode}).then(function(t){var r,i;if(!!t){for(r={},i=0;i<t.displayColumList.length;i++)t.displayColumList[i].displayColumn=t.displayColumList[i].displayColumn.substring(0,1).toLowerCase()+t.displayColumList[i].displayColumn.substring(1),r[t.displayColumList[i].displayColumn]=t.displayColumList[i].name;n.items=t}});break;case"dataitem":r.getBasicData({code:n.datacode}).then(function(t){!t||(n.items=t.data)})}c=null;n.ismulti?c=i('<div tabindex="-1" class="ma-select multi '+f.class+'" '+n.state+' ng-class="{\'zeroitem\':!hasItem()}" ng-mousedown="openSelect($event)" ng-blur="blur()" ng-focus="focus()" title="{{selectText}}">'+(!f.placeholder?"":'<div class="placeholder" ng-class="{\'hide\':!!ngModel}">'+f.placeholder+"<\/div>")+'<div class="select-value"><div class="item" ng-repeat="item in selectItem" ng-mousedown="event_SelectItem(item, $event)">{{item.'+f.displayMember+'}}<\/div><\/div><div class="option" title=""><input ng-hide="!hasItem(15)" type="text" placeholder="Select" ng-model="findText" ng-mousedown="stopPropagation($event)" /><div class="option-item"><ul><li ng-mousedown="event_SelectItem(item, $event)" class="{{isCheck(item)?\'active\':\'\'}}" ng-repeat="item in selectFilter(items)">{{item.'+f.displayMember+"}}<\/li><\/ul><\/div><\/div><\/div>")(n):(isnull=f.isnull==undefined?!1:f.isnull!="false",c=i('<div tabindex="-1" class="ma-select single '+f.class+'" '+n.state+' ng-class="{\'zeroitem\':!hasItem()}" ng-mousedown="openSelect($event)" ng-blur="blur()" ng-focus="focus()" title="{{selectText}}">'+(!f.placeholder?"":'<div class="placeholder" ng-class="{\'hide\':!!selectItem}">'+f.placeholder+"<\/div>")+'<div class="select-value"><div class="item">{{selectItem.'+f.displayMember+"}}"+(isnull?'<i class="remove icon-times" ng-mousedown="clear($event)"><\/i>':"")+'<\/div><\/div><div class="option" title=""><input ng-hide="!hasItem(15)" type="text" placeholder="Select" ng-model="findText" ng-mousedown="stopPropagation($event)" /><div class="option-item"><ul><li ng-mousedown="event_SelectItem(item, $event)" class="{{isCheck(item)?\'active\':\'\'}}" ng-repeat="item in selectFilter(items)">{{item.'+f.displayMember+"}}<\/li><\/ul><\/div><\/div><\/div>")(n));u.after(c);u.remove();u=c;o=0;s=u.find(".option");n.selectValue=null;n.selectItem=n.ismulti?[]:null;n.isShow=!1;n.$watch("items",function(t){var i;if(o=0,!!t){switch(n.items.constructor){case Array:for(i=0;i<n.items.length;i++)!!n.items[i][f.displayMember]&&n.items[i][f.displayMember].length>o&&(o=n.items[i][f.displayMember].length);break;case Object:for(item in n.items)!!n.items[item][f.displayMember]&&n.items[item][f.displayMember].length>o&&(o=n.items[item][f.displayMember].length)}s.css("width",o+3+"em")}if(!!t&&(!!n.ngModel||n.ngModel===0)){var r=n.ngModel.toString().split(","),u=[],e=[],h=[],c=!0;switch(n.items.constructor){case Array:if(n.ismulti){for(i=0;i<n.items.length;i++)r.indexOf(n.items[i][f.valueMember])>=0&&(u.push(n.items[i]),e.push(n.items[i][f.displayMember]),h.push(n.items[i][f.valueMember]));n.selectItem=u;n.selectText=e.join(",");n.selectValue=h.join(",")}else for(i=0;i<n.items.length;i++)c&&r.indexOf(n.items[i][f.valueMember])>=0&&(n.selectItem=n.items[i],n.selectText=n.items[i][f.displayMember],n.selectValue=n.items[i][f.valueMember],c=!1);break;case Object:if(n.ismulti){for(item in n.items)r.indexOf(n.items[item][f.valueMember])>=0&&(u.push(n.items[item]),e.push(n.items[item][f.displayMember]),h.push(n.items[item][f.valueMember]));n.selectItem=u;n.selectText=e.join(",");n.selectValue=h.join(",")}else for(item in n.items)c&&r.indexOf(n.items[item][f.valueMember])>=0&&(n.selectItem=n.items[item],n.selectText=n.items[item][f.displayMember],n.selectValue=n.items[item][f.valueMember],c=!0)}}},!0);n.$watch("ngModel",function(t){var i,r;if(!n.items||!t&&t!==0)n.ismulti?(n.selectItem=[],n.selectText=""):(n.selectItem=null,n.selectText="");else if(n.ismulti){var o=t.split(","),u=[],e=[];switch(n.items.constructor){case Array:for(i=0;i<n.items.length;i++)o.indexOf(n.items[i][f.valueMember])>=0&&(u.push(n.items[i][f.displayMember]),e.push(n.items[i]));break;case Object:for(r in n.items)o.indexOf(n.items[r][f.valueMember])>=0&&(u.push(n.items[r][f.displayMember]),e.push(n.items[r]))}n.selectItem=e;n.selectText=u.join(",")}else switch(n.items.constructor){case Array:for(i=0;i<n.items.length;i++)if(n.items[i][f.valueMember]==t){n.selectText=n.items[i][f.displayMember];n.selectItem=n.items[i];break}break;case Object:for(r in n.items)if(n.items[r][f.valueMember]==t){n.selectText=n.items[r][f.displayMember];n.selectItem=n.items[r];break}}});n.hasItem=function(t){return t||(t=0),!!n.items&&(n.items.length>t||Object.keys(n.items).length>t)};n.documentClick=function(i){i==i&&(angular.element(document).off("mousedown",n.documentClick),n.isOpen&&t(function(){n.setOpen(!1)},0))};n.stopPropagation=function(n){n.stopPropagation()};n.openSelect=function(t){if(n.state=="normal"){if(n.setOpen(!n.isOpen),n.isOpen)angular.element(document).on("mousedown",n.documentClick);n.TopOrBottom()}t.stopPropagation()};n.setOpen=function(t){n.state=="normal"&&(n.isOpen=t,t?u.addClass("open"):u.removeClass("open"))};n.TopOrBottom=function(){s.offset().top+s.height()>$(document).height()?s.css({top:s.height()*-1-10+"px",boxShadow:"0 -3px 12px rgba(0,0,0,0.175)"}):s.css({top:"",boxShadow:""})};n.blur=function(){t(function(){u.is(":focus")||u.find("[type=text]").is(":focus")||n.setOpen(!1)},100)};n.focus=function(){t(function(){u.find("[type=text]").focus()},100)};n.isCheck=function(t){if(!n.selectItem)return!1;if(n.ismulti){for(var i=0;i<n.selectItem.length;i++)if(n.selectItem[i][f.valueMember]==t[f.valueMember])return!0}else if(!!n.selectItem)return t[f.valueMember]==n.selectItem[f.valueMember];return!1};n.clear=function(t){n.ismulti?(n.selectItem=[],n.selectText="",n.selectValue=null):(n.selectItem=null,n.selectText="",n.selectValue=null);e.$setViewValue(n.selectValue);t.stopPropagation()};n.event_SelectItem=function(i,r){var s="",o=null,h;if(n.state=="normal"){if(n.ismulti){if(!n.selectValue){n.selectValue=i[f.valueMember];r.stopPropagation();e.$setViewValue(n.selectValue);o={id:i[f.valueMember],text:i[f.displayMember]};t(function(){n.callbackFunc({selectItem:o,currentItem:o})},0);return}s=n.selectValue.split(",");h=s.indexOf(i[f.valueMember]);h>=0?s.splice(h,1):s.push(i[f.valueMember]);n.selectValue=s.join(",");r.stopPropagation();u.focus()}else o={id:i[f.valueMember],text:i[f.displayMember]},n.selectValue=i[f.valueMember],n.findText="";e.$setViewValue(n.selectValue);o={id:i[f.valueMember],text:i[f.displayMember]};t(function(){n.callbackFunc({selectItem:n.selectItem,currentItem:o})},0)}};n.selectFilter=function(){var i,t,r;if(n.findText){i=[];switch(n.items.constructor){case Array:for(t=0;t<n.items.length;t++)n.items[t][f.displayMember].toLowerCase().indexOf(n.findText.toLowerCase())>=0&&i.push(n.items[t]);break;case Object:for(r in n.items)n.items[r][f.displayMember].toLowerCase().indexOf(n.findText.toLowerCase())>=0&&i.push(n.items[r])}return i}return n.items}}}}}}]);
/**** maSelectUser.js *****/
_shared.directive("maSelectUser",["$compile","dialog","mabp.app.module","$timeout",function(n,t,i,r){return{restrict:"EA",scope:{ngModel:"=",users:"=",ismulti:"=",callbackFunc:"&"},require:"ngModel",compile:function(){return{pre:function(){},post:function(n,i,u){var f=null;f=u.ismulti!=undefined&&u.ismulti!=="false"?!0:!1;n.$watch("ngModel",function(){},!0);n.$watch("users",function(n,t,i){var u,f,r;if(!!i.users){for(u=[],f=[],r=0;r<i.users.length;r++)u.push(i.users[r].id),f.push(i.users[r].name);i.ngModel=f.join(",");i.ids=u}},!0);i.on("click",function(){t.open(_shared.dialogs.maUserSelectDialog,{ismulti:f,initSelectData:n.users}).then(function(t){t&&(n.users=t,r(function(){n.callbackFunc({selectItem:t})},0))})})}}}}}]);
/**** fm-attachment.js *****/
_shared.directive("fmAttachment",["fmTool","$compile","FileUploader","mabp.app.file","appSession",function(n,t,i,r,u){return{restrict:"E",replace:!0,template:function(t,i){var r=n.setValidate(i);return'<table field-name="{{fieldName}}" '+r.join(" ")+' class="input-sm fm-attachment table table-condensed" ng-class="state"><tbody><tr ng-repeat="item in files"><td><i class="fileIcon {{getFileIcon(item)}}"><\/i>&nbsp;<a target="_blank" ng-href="/File/Download?fileId={{item.id}}">{{item.fileName}}&nbsp;&nbsp;<\/a><i ng-if="state==\'normal\' && (nodeId == item.nodeId || item.isDraft) && userId == item.creatorUserId" class="fileRemoveIcon icon-times" ng-click="event_delete(item)"><\/i><i class="file-upload-date">{{item.creationTime | date:"yyyy-MM-dd hh:mm"}}<\/i><i class="file-upload-username">{{item.userName}}<\/i><\/td><\/tr><\/tbody><tfoot ng-if="state==\'normal\'"><tr><td colspan="1"><input type="file" class="picUpload" nv-file-select uploader="uploader" multiple="true" accept="{{accept}}"/><input type="button" class="btn btn-sm btn-info ng-scope" ng-click="event_upload()" value="{{btnname}}" /><\/td><\/tr><\/tfoot><\/table>'},scope:{files:"=",fmModel:"=",taskId:"=",uploader:"=",getFileIcon:"&",linkId:"=",bpmFiles:"=",userId:"=",nodeId:"=",draftId:"=",formFiles:"=",fmRequired:"=",fmDisabled:"=",fmNormal:"=",callbackFunc:"&",filters:"@"},compile:function(){return{pre:function(t,r,u){n.setDefaultWatch(u,t,r);t.fieldName=u.fieldName;t.uploader=new i({url:"/fileApi/File/UploadFiles"});t.getFileIcon=function(n){t.fileType=n.extensionName.toLowerCase().substring(1);switch(n.extensionName.toLowerCase().substring(1)){case"png":case"jpg":case"bmp":case"gif":case"jpeg":return"icon-file-image";case"txt":case"xml":case"json":case"config":return"icon-file-text-o";case"doc":case"docx":return"icon-file-word";case"xls":case"xlsx":return"icon-file-excel";case"ppt":case"pptx":return"icon-file-powerpoint";case"mp3":case"wav":case"mid":return"icon-file-audio";case"mp4":case"avi":case"wmv":case"flv":case"rmvb":return"icon-file-movie";case"js":case"cs":case"css":case"c":case"java":case"sql":return"icon-file-code";case"pdf":case"fdf":case"xdp":return"icon-file-pdf";case"zip":case"rar":case"cab":case"7z":return"icon-file-archive";default:return"icon-file-o"}}},post:function(t,i,f){if(t.btnname=f.buttonName||"上传附件",t.userId=u.userId,f.pageState=$(".fm-content").attr("page-state"),n.setScopeState(t,f),t.accept="*",t.filters){var o=t.filters.toLowerCase().replace(/\s/g,"").split("|"),e=[];angular.forEach(o,function(n){e.push("."+n)});t.accept=e.join(",")}t.files=[];t.fileIds=[];t.fileFiles=t.files;t.bpmFiles={linkId:t.linkId,FileId:t.fileIds,files:t.files};!t.taskId||r.getTaskLinkedFiles({taskId:t.taskId,linkId:t.linkId}).then(function(n){t.files=n;_.forEach(t.files,function(n){t.fileIds.push(n.id)});t.bpmFiles.files=t.files});!t.draftId||r.getDraftFile({draftId:t.draftId,linkId:t.linkId}).then(function(n){_.forEach(n,function(n){n.isDraft=!0});t.files=n;_.forEach(t.files,function(n){t.fileIds.push(n.id)});t.bpmFiles.files=t.files});t.event_upload=function(){$(i).find(".picUpload").click()};t.event_delete=function(n){var i={};i.taskId=t.taskId;i.fileId=n.id;r.deleteFile(i).then(function(){console.log("移除成功");var r=t.files.indexOf(n);t.files.splice(r,1);t.fileIds.splice(r,1);t.callbackFunc({selectItem:i})})};t.uploader.filters.push({name:"customFilter",fn:function(n){var i=n.size,t=i<52428800;return t||mabp.notify.warn("附件应小于50MB"),t}});t.uploader.filters.push({name:"controllerFilter",fn:function(n){if(t.filters){var i=(/(?:\.([^.]+))?$/.exec(n.name)[1]||"").toLowerCase(),r=t.filters.toLowerCase().replace(/\s/g,"").split("|"),u={};return(angular.forEach(r,function(n){u[n]=!0}),!u[i])?(mabp.notify.warn(L("Fileuploads")+"<b>"+i+"<\/b> "+L("Notsupported")+L("Onlysupport")+"<b>"+r.join(" , ")+"<\/b>"),!1):!0}return!0}});t.uploader.onAfterAddingFile=function(){t.uploader.getNotUploadedItems().length&&t.uploader.uploadAll()};t.uploader.onSuccessItem=function(n,i){var e=i.isSuccess,f,r;if(e)for(f=0;f<i.result.length;f++)r=i.result[f],r.creationTime=(new Date).format("yyyy-MM-dd hh:mm"),r.userName=u.userName,r.creatorUserId=u.userId,r.nodeId=t.nodeId,t.files.push(r),t.fileIds.push(r.id),t.state=="normal"&&t.callbackFunc({selectItem:r})};t.formFiles.push(t.bpmFiles);t.uploader.onErrorItem=function(){t.uploader.queue[t.uploader.queue.length-1].remove();console.log("附件上传失败");mabp.notify.warn("附件上传失败")};t.$watch("files",function(){var i,n;if(!!t.files){for(i=[],n=0;n<t.files.length;n++)i.push(t.files[n].id);t.fmModel=i.join(",");t.fmModel==""&&(t.fmModel=null)}},!0)}}}}}]);
/**** fm-checklist.js *****/
_shared.directive("fmChecklist",["fmTool","mabp.app.module","$timeout",function(n,t,i){return{restrict:"E",replace:!0,template:function(t,i){n.setDefaultMember(i);i.name||(i.name=(i.fmModel||"").toString().substring((i.fmModel||"").lastIndexOf(".")+1));var r=(100/i.columncount).getPrecision(1)-1;return'<div fm-model="'+i.fmModel+'" class="fm-checklist input-sm" ng-class="state" ids="{{fmModel}}" ng-blur="event_Blur()"><div style="width:'+r+'%;" class="fm-checklist-checkbox" ng-repeat="item in items"><label><input ng-disabled="state == \'disabled\' || state == \'readonly\' || item.'+i.disabledMember+' === true" ng-checked="isChecked(item)" name="'+i.name+'" type="checkbox" value="{{item.'+i.valueMember+'}}" ng-click="event_ChangeValue(item, $event)" />{{item.'+i.displayMember+"}}<\/label><\/div><\/div>"},scope:{fmModel:"=",fmCode:"=",items:"=",selectItem:"=",fmNormal:"=",fmRequired:"=",fmDisabled:"=",fmReadonly:"=",filter:"=",callbackFunc:"&"},require:"?^fmCache",compile:function(){return{pre:function(){},post:function(t,r,u,f){t.selectItem=[];t.isLoadBefore=!0;n.setScopeState(t,u);n.setDataSource(t,u,f);t.$watch("filter",function(i,r){!i||i==r||n.setDataSource(t,u)},!0);t.isChecked=function(n){return t.fmModel?(t.fmModel===0&&(t.fmModel="0"),(t.fmModel||"").toString().split(",").indexOf(n[u.valueMember]+"")>=0):!1};n.setDefaultWatch(u,t,r);n.LoadInitData(t,u);t.$watch("fmModel",function(){var r,i,n;if(!t.Init&&(t.selectItem=[],!!t.items)){for(r=t.fmModel?t.fmModel.split(","):[],n=0;n<t.items.length;n++)r.indexOf(t.items[n][u.valueMember])>=0&&t.selectItem.push(t.items[n]);if(u.codeMember&&!!t.selectItem){for(i=[],n=0;n<t.selectItem.length;n++)i.push(t.selectItem[n][u.codeMember]);t.fmCode=i.join(",")}}});t.$watch("items",function(){var i,n;if(!!t.items){for(i=!!t.fmModel||t.fmModel==0?t.fmModel.toString().split(","):[],t.selectItem=[],_tempCode=[],n=0;n<t.items.length;n++)i.indexOf(t.items[n][u.valueMember]+"")>=0&&(t.selectItem.push(t.items[n]),_tempCode.push(t.items[n][u.codeMember]));t.fmCode=_tempCode.join(",")}},!0);t.event_ChangeValue=function(n){t.fmModel===0&&(t.fmModel="0");var r=t.fmModel?(t.fmModel||"").split(","):[],f=r.indexOf(n[u.valueMember]);f>=0?r.splice(f,1):r.push(n[u.valueMember]);t.fmModel=r.join(",");console.info(n[u.displayMember],n[u.valueMember],n[u.codeMember]);t.state==="normal"&&i(function(){t.callbackFunc({selectItem:n,fmModel:t.fmModel,fmCode:t.fmCode})})};t.event_Blur=function(){$(r).removeClass("focus")}}}}}}]);
/**** fm-data-select-button.js *****/
_shared.directive("fmDataSelectButton",["fmTool","$timeout","dialog","mabp.app.module","mabp.app.bpm",function(n,t,i){return{restrict:"E",replace:!0,template:function(t,i){n.setDefaultMember(i);var r=n.setValidate(i);return i.ismulti=i.ismulti!==undefined&&i.ismulti!=="false"?!0:!1,'<button class="btn-sm btn btn-info select-data-button '+i.class+'" ng-class="state" type="button" ng-click="event_SelectData()" >'+(i.text?"{{text}}":"{{('Choose' | translate)}}")+"<\/button>"},scope:{text:"=",fmModel:"=",fmCode:"=",columns:"=",isOpen:"=",datacode:"=",fmNormal:"=",fmRequired:"=",fmDisabled:"=",fmReadonly:"=",filter:"=",defaultModel:"=",callbackFunc:"&"},compile:function(){return{pre:function(){},post:function(t,r,u){t.ismulti=!u.ismulti||u.ismulti==="false"||t.ismulti!==undefined?!1:!0;n.setScopeState(t,u);n.setDefaultWatch(u,t,r);t.event_SelectData=function(){if(t.state=="normal")switch(t.datatype){case"source":i.open(_shared.dialogs.formSelect,{data:[],datatype:"source",filter:t.filter,selectData:"",column:t.columns,title:u.placeholder,ismulti:t.ismulti,valueMember:u.valueMember,size:u.size}).then(function(n){var f,r,i;if(n!==null){for(f=(n.selectItem||"").split(","),r=[],i=0;i<n.items.length;i++)f.indexOf(n.items[i][u.valueMember])>=0&&r.push(n.items[i]);t.callbackFunc({selectItem:r})}});break;case"view":i.open(_shared.dialogs.formSelect,{datacode:t.datacode,datatype:"view",filter:t.filter,selectData:"",column:t.columns,title:u.formTitle,ismulti:t.ismulti,valueMember:u.valueMember,size:u.size}).then(function(n){var f,r,i;if(n!==null){for(f=(n.selectItem||"").split(","),r=[],i=0;i<n.items.length;i++)f.indexOf(n.items[i][u.valueMember])>=0&&r.push(n.items[i]);t.callbackFunc({selectItem:r})}});break;case"dataitem":i.open(_shared.dialogs.treeSelect,{datacode:t.datacode,datatype:"dataitem",filter:t.filter,selectData:"",column:t.columns,title:u.formTitle,ismulti:t.ismulti,mustleaf:u.mustleaf,size:u.size}).then(function(n){var r,i;if(n!==undefined){if(r=[],!!n.selectItem&&n.selectItem.length>0)for(i=0;i<n.selectItem.length;i++)r.push(n.selectItem[i][u.valueMember]);t.callbackFunc({selectItem:n.selectItem});t.IsSelectData=!0}});break;case"group":i.open(_shared.dialogs.treeSelect,{data:t.items,datatype:"group",selectData:angular.copy(t.selectItem),column:t.columns,title:u.formTitle,ismulti:t.ismulti,mustleaf:u.mustleaf}).then(function(n){var i,r;if(n!==null&&n!==undefined){if(i=[],!!n.selectItem&&n.selectItem.length>0)for(r=0;r<n.selectItem.length;r++)i.push(n.selectItem[r][u.valueMember]);t.fmModel=i.join(",");t.callbackFunc({selectItem:n.selectItem,fmModel:i.join(",")})}});break;case"joblevel":i.open(_shared.dialogs.jobLevelDialog,{value:t.fmModel}).then(function(n){var i,r;if(!!n){if(n.id=n.value,n.text=n.name,i=[],!!t.selectItem&&t.selectItem.length>0)for(r=0;r<t.selectItem.length;r++)i.push(t.selectItem[r][u.valueMember]);t.fmModel=i.join(",");t.callbackFunc({selectItem:[n],fmModel:i.join(",")})}})}}}}}}}]);
/**** fm-data-select.js *****/
_shared.directive("fmDataSelect",["fmTool","$timeout","dialog","mabp.app.module","mabp.app.bpm",function(n,t,i){return{restrict:"E",replace:!0,template:function(t,i){n.setDefaultMember(i);var r=n.setValidate(i);return i.ismulti=i.ismulti!==undefined&&i.ismulti!=="false"?!0:!1,i.name||(i.name=i.fmModel.toString().substring(i.fmModel.lastIndexOf(".")+1)),'<div fm-model="'+i.fmModel+'" class="input-sm ma-data-select '+(i.ismulti?"multi":"single")+" "+i.class+'" ng-class="state" ng-mousedown="openSelect($event)" ng-blur="event_Blur()" style="display: inline-block;vertical-align: middle;">'+(!i.placeholder?"":'<div class="placeholder" ng-class="{\'hide\':!!fmModel}">{{placeholder}}<\/div>')+'<div class="select-data-value"><div class="item '+(i.href?"href-item":"")+'" ng-repeat="item in selectItem" ng-mousedown="event_removeSelectItem(item, $event)"><span>{{::item.'+i.displayMember+"}}<\/span>"+(i.ismulti?"":'<i ng-hide="!iClear || state!=\'normal\'" class="icon-times remove" ng-mousedown="clear($event)"><\/i>')+'<\/div><div class="item '+(i.href?"href-item":"")+'" ng-if="(!selectItem || selectItem.length == 0) && !!defaultModel" ng-mousedown="event_clickSelectItem(defaultModel, $event)"><span>{{defaultModel}}<\/span>'+(i.ismulti?"":'<i ng-hide="!iClear || state!=\'normal\'" class="icon-times remove" ng-mousedown="clear($event)"><\/i>')+'<\/div><\/div><button class="btn btn-info btn-sm select-data-button" type="button" ng-click="event_SelectData()" >'+(i.btntext||"{{('Choose' | translate)}}")+'<\/button><input type="hidden" '+(!i.name?"":'name="'+i.name+'"')+" "+r.join(" ")+' ng-model="fmModel" /><\/div>'},scope:{fmModel:"=",fmCode:"=",items:"=",columns:"=",selectItem:"=",isOpen:"=",findText:"=",datacode:"=",fmNormal:"=",fmRequired:"=",fmDisabled:"=",fmReadonly:"=",filter:"=",defaultFilter:"=",parentId:"=",defaultModel:"=",callbackFunc:"&",fmBlur:"&"},require:"?^fmCache",link:function(r,u,f,e){f.size=f.size?(""+f.size).toLowerCase():"md";r.placeholder=f.placeholder;r.IsSelectData=!1;r.iClear=r.iClear&&r.iClear!==!1||f.iClear!=undefined&&f.iClear!="false"&&!0;r.ismulti=!f.ismulti||f.ismulti==="false"||r.ismulti!==undefined?!1:!0;isnull=f.isnull==undefined?!0:f.isnull!=undefined&&f.isnull!="false";r.selectItem=[];n.setScopeState(r,f);n.LoadInitData(r,f);var o=u.find(".option");r.isShow=!1;n.setDefaultWatch(f,r,u);r.$watch("items",function(){var i,e,t;if(!!r.items){if(i=0,r.items.length==0?u.addClass("zeroitem"):u.removeClass("zeroitem"),e=r.fmModel?r.fmModel.split(","):[],(f.mustleaf||r.datatype=="group"||r.datatype=="joblevel")&&r.fmModel!=null)r.selectItem=n.getTreeData(r.items,r.fmModel,f),!!r.selectItem&&r.selectItem.length>0&&(r.parentId=r.selectItem[0].parentId);else for(r.selectItem=[],t=0;t<r.items.length;t++)!!r.items[t][f.displayMember]&&r.items[t][f.displayMember].length>i&&(i=r.items[t][f.displayMember].length),e.indexOf(r.items[t][f.valueMember])>=0&&r.selectItem.push(r.items[t]);o.css("width",i+3+"em")}},!0);r.existFmModels=[];r.$watch("selectItem",function(t,i){var o,s,h,e;if((t==null||i==null||t.length!=0||i.length!=0)&&(t==null||t.length!=0)&&(o=[],_.forEach(t,function(n){o.push(n.id)}),s=JSON.stringify(o),!(_.findIndex(r.existFmModels,{id:s})>-1))){if(r.existFmModels=[],r.existFmModels.push({id:s}),f.codeMember&&!!r.selectItem){for(h=[],e=0;e<r.selectItem.length;e++)r.selectItem[e]!=null&&r.selectItem[e][f.codeMember]!=null&&h.push(r.selectItem[e][f.codeMember]);r.fmCode=h.join(",")}r.state=="normal"&&n.isInitialed(r,u,f)&&r.callbackFunc({selectItem:r.selectItem,fmModel:r.fmModel})}},!0);r.dataUpdate=function(){var u,o,i,t;if(r.state!="normal"||!r.items||r.fmModel===undefined)r.state!="normal"||r.items||!r.fmModel?r.state=="normal"||!r.fmModel?r.state!="normal"||r.fmModel||(r.selectItem=[]):n.getOne(r,f,null,e):n.getOne(r,f,null,e);else{if(r.datatype!="dataitem"&&r.datatype!="group")if(f.ismulti)for(u=(r.fmModel||"").split(","),o=[],r.selectItem=[],t=0;t<r.items.length;t++)u.indexOf(r.items[t][f.valueMember])>=0&&r.selectItem.push(r.items[t]);else{for(i=!0,t=0;t<r.items.length;t++)if(r.items[t][f.valueMember]==r.fmModel){r.selectItem=[r.items[t]];i=!1;break}i&&(r.selectItem=[])}else r.selectItem=n.getTreeData(r.items,r.fmModel,f),!!r.selectItem&&r.selectItem.length>0&&(r.parentId=r.selectItem[0].parentId);r.IsSelectData&&(r.IsSelectData=!1);r.fmBlur({item:r.$parent.item,selectItem:r.selectItem||[]})}};r.$watch("fmModel",function(t){var e,o,u,i;if(t==undefined&&(r.selectItem=[],r.existFmModels=[]),r.Init){if(r.state=="normal"&&!!r.items&&r.fmModel!==undefined){if(r.datatype!="dataitem"&&r.datatype!="group")if(f.ismulti)for(e=(r.fmModel||"").split(","),o=[],r.selectItem=[],i=0;i<r.items.length;i++)e.indexOf(r.items[i][f.valueMember])>=0&&r.selectItem.push(r.items[i]);else{for(u=!0,r.selectItem=[],i=0;i<r.items.length;i++)if(r.items[i][f.valueMember]==r.fmModel){r.selectItem=[r.items[i]];u=!1;break}u&&(r.selectItem=[])}else r.selectItem=n.getTreeData(r.items,r.fmModel,f),!!r.selectItem&&r.selectItem.length>0&&(r.parentId=r.selectItem[0].parentId);r.IsSelectData&&(r.IsSelectData=!1);r.fmBlur({item:r.$parent.item,selectItem:r.selectItem||[]})}}else r.dataUpdate()});r.hasItem=function(n){return n||(n=0),r.items&&(r.items.length>n||Object.keys(r.items).length>n)};r.focus=function(){t(function(){u.find("[type=text]").focus()},100)};r.clear=function(n){r.selectItem=[];r.fmModel="";n.stopPropagation()};r.event_removeSelectItem=function(n,t){!f.href||window.open(f.href.replace(/{.*?}/g,function(t){for(var i in n)if(i.toLowerCase()==t.substr(1,t.length-2).toLowerCase())return n[i];return""}));f.ismulti&&r.event_selectItem(n,t)};r.event_clickSelectItem=function(n,t){!f.href||window.open(f.href.replace(/{.*?}/g,function(){return r.defaultModel}));f.ismulti&&r.event_clickSelectItem(n,t)};r.event_selectItem=function(n,t){if(r.state=="normal"){if(f.ismulti){var i=r.fmModel?(r.fmModel||"").split(","):[],e=i.indexOf(n[f.valueMember]);e>=0?i.splice(e,1):i.push(n[f.valueMember]);r.fmModel=i.join(",");t.stopPropagation()}else r.fmModel=n[f.valueMember],r.findText="";console.info(n[f.displayMember],n[f.valueMember],n[f.codeMember]);u.focus()}};r.event_SelectData=function(){if(r.state=="normal")switch(r.datatype){case"source":i.open(_shared.dialogs.formSelect,{data:r.items,datatype:"source",filter:r.filter,defaultfilter:r.defaultFilter,selectData:r.fmModel,column:r.columns,title:f.placeholder,ismulti:r.ismulti,valueMember:f.valueMember,size:f.size}).then(function(n){n!==null&&n!==undefined?(r.items=n.items,r.fmModel=n.selectItem,r.IsSelectData=!0,r.defaultFilter=n.defaultFilter):n===null&&(r.fmModel="")});break;case"view":i.open(_shared.dialogs.formSelect,{datacode:r.datacode,datatype:"view",filter:r.filter,defaultfilter:r.defaultFilter,selectData:r.fmModel,column:r.columns,title:f.formTitle,ismulti:r.ismulti,valueMember:f.valueMember,size:f.size}).then(function(n){n!==null&&n!==undefined?(r.items=n.items,r.fmModel=n.selectItem,r.IsSelectData=!0,r.defaultFilter=n.defaultFilter):n===null&&(r.fmModel="")});break;case"dataitem":i.open(_shared.dialogs.treeSelect,{datacode:r.datacode,datatype:"dataitem",filter:r.filter,selectData:angular.copy(r.selectItem),column:r.columns,title:f.formTitle,ismulti:r.ismulti,mustleaf:f.mustleaf,size:f.size}).then(function(n){var i,t;if(n!==undefined&&n!=null){if(r.items=n.items,r.selectItem=n.selectItem,i=[],!!r.selectItem&&r.selectItem.length>0)for(t=0;t<r.selectItem.length;t++)i.push(r.selectItem[t][f.valueMember]);r.fmModel=i.join(",");r.IsSelectData=!0}else n===null&&(r.fmModel="")});break;case"group":i.open(_shared.dialogs.treeSelect,{data:r.items,datatype:"group",filter:r.filter,defaultfilter:r.defaultFilter,selectData:angular.copy(r.selectItem),column:r.columns,title:f.formTitle,ismulti:r.ismulti,mustleaf:f.mustleaf}).then(function(n){var i,t;if(n!==null&&n!==undefined){if(r.items=n.items,r.selectItem=n.selectItem,r.defaultFilter=n.defaultFilter,i=[],!!r.selectItem&&r.selectItem.length>0)for(t=0;t<r.selectItem.length;t++)i.push(r.selectItem[t][f.valueMember]);r.fmModel=i.join(",");r.IsSelectData=!0}else n===null&&(r.fmModel="")});break;case"joblevel":i.open(_shared.dialogs.jobLevelDialog,{value:r.fmModel,ismulti:r.ismulti}).then(function(n){var i,t;if(n!==null&&n!==undefined){if(r.items=n,r.selectItem=n,i=[],!!r.selectItem&&r.selectItem.length>0)for(t=0;t<r.selectItem.length;t++)i.push(r.selectItem[t][f.valueMember]);r.fmModel=i.join(",");r.IsSelectData=!0}else n===null&&(r.fmModel="")})}};r.event_Blur=function(){$(u).removeClass("focus")}}}}]);
/**** fm-datatext-select.js *****/
_shared.directive("fmDatatextSelect",["fmTool","$timeout","dialog","mabp.app.module","mabp.app.bpm",function(n,t,i){return{restrict:"E",replace:!0,template:function(t,i){n.setDefaultMember(i);var r=n.setValidate(i);return i.ismulti=i.ismulti!==undefined&&i.ismulti!=="false"?!0:!1,i.name||(i.name=i.fmModel.toString().substring(i.fmModel.lastIndexOf(".")+1)),'<div fm-model="'+i.fmModel+'" fm-text-model="'+i.fmTextModel+'" class="input-sm ma-datatext-select ma-data-select '+(i.ismulti?"multi":"single")+" "+i.class+'" ng-class="state" ng-mousedown="openSelect($event)" ng-blur="event_Blur()" style="display: inline-block;">'+(!i.placeholder?"":'<div class="placeholder" ng-class="{\'hide\':!!fmModel}">'+i.placeholder+"<\/div>")+'<div class="select-data-value"><input placeholder="'+i.placeholder+'" class="'+(i.href?"href-item":"")+'" type="" ng-readonly="state==\'readonly\'" ng-disabled="state==\'disabled\' || '+i.textDisabled+'" ng-model="fmTextModel" ng-change="changeTxt()" /><div class="item"><span> {{ fmTextModel }}<\/span><\/div><\/div><button class="btn btn-info btn-sm select-data-button" type="button" ng-click="event_SelectData()" >'+(i.btntext||"{{('Choose' | translate)}}")+'<\/button><input type="hidden" '+(!i.name?"":'name="'+i.name+'"')+" "+r.join(" ")+' ng-model="fmModel" /><\/div>'},scope:{fmModel:"=",fmTextModel:"=",fmCode:"=",items:"=",columns:"=",selectItem:"=",isOpen:"=",findText:"=",datacode:"=",fmNormal:"=",fmRequired:"=",fmDisabled:"=",fmReadonly:"=",filter:"=",defaultFilter:"=",parentId:"=",defaultModel:"=",callbackFunc:"&",fmBlur:"&"},require:"?^fmCache",compile:function(){return{pre:function(){},post:function(r,u,f,e){var s,o;f.size=f.size?(""+f.size).toLowerCase():"md";r.IsSelectData=!1;r.iClear=r.iClear&&r.iClear!==!1||f.iClear!=undefined&&f.iClear!="false"&&!0;r.ismulti=!1;isnull=f.isnull==undefined?!0:f.isnull!=undefined&&f.isnull!="false";r.selectItem=[];n.setScopeState(r,f);n.LoadInitData(r,f);s=u.find(".option");r.isShow=!1;n.setDefaultWatch(f,r,u);o={id:"",text:""};r.changeTxt=function(){r.fmModel=o.id?r.fmTextModel==o.text?o.id:null:null};r.$watch("items",function(){var i,e,t;if(!!r.items){if(i=0,r.items.length==0?u.addClass("zeroitem"):u.removeClass("zeroitem"),e=r.fmModel?r.fmModel.split(","):[],(f.mustleaf||r.datatype=="group"||r.datatype=="joblevel")&&r.fmModel!=null)r.selectItem=n.getTreeData(r.items,r.fmModel,f),!!r.selectItem&&r.selectItem.length>0&&(r.parentId=r.selectItem[0].parentId);else for(t=0;t<r.items.length;t++)!!r.items[t][f.displayMember]&&r.items[t][f.displayMember].length>i&&(i=r.items[t][f.displayMember].length),e.indexOf(r.items[t][f.valueMember])>=0&&r.selectItem.push(r.items[t]);s.css("width",i+3+"em")}},!0);r.$watch("selectItem",function(t,i){var o,e;if(t==null||i==null||t.length!=0||i.length!=0){if(f.codeMember&&!!r.selectItem){for(o=[],e=0;e<r.selectItem.length;e++)r.selectItem[e]!=null&&r.selectItem[e][f.codeMember]!=null&&o.push(r.selectItem[e][f.codeMember]);r.fmCode=o.join(",")}r.state=="normal"&&n.isInitialed(r,u,f)&&r.callbackFunc({selectItem:r.selectItem,fmModel:r.fmModel})}},!0);r.dataUpdate=function(){var u,o,i,t;if(r.state!="normal"||!r.items||r.fmModel===undefined)r.state!="normal"||r.items||!r.fmModel?r.state!="normal"&&r.fmModel!==undefined&&n.getOne(r,f,null,e):n.setDataSource(r,f,e);else{if(r.datatype!="dataitem"&&r.datatype!="group")if(f.ismulti)for(u=(r.fmModel||"").split(","),o=[],r.selectItem=[],t=0;t<r.items.length;t++)u.indexOf(r.items[t][f.valueMember])>=0&&r.selectItem.push(r.items[t]);else{for(i=!0,t=0;t<r.items.length;t++)if(r.items[t][f.valueMember]==r.fmModel){r.selectItem=[r.items[t]];i=!1;break}i&&(r.selectItem=[])}else r.selectItem=n.getTreeData(r.items,r.fmModel,f),!!r.selectItem&&r.selectItem.length>0&&(r.parentId=r.selectItem[0].parentId);r.IsSelectData&&(r.IsSelectData=!1);r.fmBlur({item:r.$parent.item,selectItem:r.selectItem||[]})}};r.$watch("fmModel",function(t){var e,o,u,i;if(t==undefined&&(r.selectItem=[]),r.Init){if(r.state=="normal"&&!!r.items&&r.fmModel!==undefined){if(r.datatype!="dataitem"&&r.datatype!="group")if(f.ismulti)for(e=(r.fmModel||"").split(","),o=[],r.selectItem=[],i=0;i<r.items.length;i++)e.indexOf(r.items[i][f.valueMember])>=0&&r.selectItem.push(r.items[i]);else{for(u=!0,i=0;i<r.items.length;i++)if(r.items[i][f.valueMember]==r.fmModel){r.selectItem=[r.items[i]];u=!1;break}u&&(r.selectItem=[])}else r.selectItem=n.getTreeData(r.items,r.fmModel,f),!!r.selectItem&&r.selectItem.length>0&&(r.parentId=r.selectItem[0].parentId);r.IsSelectData&&(r.IsSelectData=!1);r.fmBlur({item:r.$parent.item,selectItem:r.selectItem||[]})}}else r.dataUpdate()});r.hasItem=function(n){return n||(n=0),r.items&&(r.items.length>n||Object.keys(r.items).length>n)};r.focus=function(){t(function(){u.find("[type=text]").focus()},100)};r.clear=function(n){r.selectItem=[];r.fmModel="";n.stopPropagation()};r.event_removeSelectItem=function(n,t){!f.href||window.open(f.href.replace(/{.*?}/g,function(t){for(var i in n)if(i.toLowerCase()==t.substr(1,t.length-2).toLowerCase())return n[i];return""}));f.ismulti&&r.event_selectItem(n,t)};r.event_clickSelectItem=function(n,t){!f.href||window.open(f.href.replace(/{.*?}/g,function(){return r.defaultModel}));f.ismulti&&r.event_clickSelectItem(n,t)};r.event_selectItem=function(n,t){if(r.state=="normal"){if(f.ismulti){var i=r.fmModel?(r.fmModel||"").split(","):[],e=i.indexOf(n[f.valueMember]);e>=0?i.splice(e,1):i.push(n[f.valueMember]);r.fmModel=i.join(",");t.stopPropagation()}else r.fmModel=n[f.valueMember],r.findText="";console.info(n[f.displayMember],n[f.valueMember],n[f.codeMember]);u.focus()}};r.event_SelectData=function(){if(r.state=="normal")switch(r.datatype){case"source":i.open(_shared.dialogs.formSelect,{data:r.items,datatype:"source",filter:r.filter,defaultfilter:r.defaultFilter,selectData:r.fmModel,column:r.columns,title:f.placeholder,ismulti:r.ismulti,valueMember:f.valueMember,size:f.size}).then(function(n){n!==null&&n!==undefined?(r.items=n.items,r.fmModel=n.selectItem,r.IsSelectData=!0,r.defaultFilter=n.defaultFilter):n===null&&(r.fmModel="");t(function(){!!r.selectItem&&r.selectItem.length>0&&(r.fmTextModel=r.selectItem[0].text);o=r.selectItem[0]})});break;case"view":i.open(_shared.dialogs.formSelect,{datacode:r.datacode,datatype:"view",filter:r.filter,defaultfilter:r.defaultFilter,selectData:r.fmModel,column:r.columns,title:f.formTitle,ismulti:r.ismulti,valueMember:f.valueMember,size:f.size}).then(function(n){n!==null&&n!==undefined?(r.items=n.items,r.fmModel=n.selectItem,r.IsSelectData=!0,r.defaultFilter=n.defaultFilter):n===null&&(r.fmModel="");t(function(){!!r.selectItem&&r.selectItem.length>0&&(r.fmTextModel=r.selectItem[0].text);o=r.selectItem[0]})});break;case"dataitem":i.open(_shared.dialogs.treeSelect,{datacode:r.datacode,datatype:"dataitem",filter:r.filter,selectData:angular.copy(r.selectItem),column:r.columns,title:f.formTitle,ismulti:r.ismulti,mustleaf:f.mustleaf,size:f.size}).then(function(n){var u,i;if(n!==undefined){if(r.items=n.items,r.selectItem=n.selectItem,u=[],!!r.selectItem&&r.selectItem.length>0)for(i=0;i<r.selectItem.length;i++)u.push(r.selectItem[i][f.valueMember]);r.fmModel=u.join(",");r.IsSelectData=!0}else n===null&&(r.fmModel="");t(function(){!!r.selectItem&&r.selectItem.length>0&&(r.fmTextModel=r.selectItem[0].text);o=r.selectItem[0]})});break;case"group":i.open(_shared.dialogs.treeSelect,{data:r.items,datatype:"group",filter:r.filter,defaultfilter:r.defaultFilter,selectData:angular.copy(r.selectItem),column:r.columns,title:f.formTitle,ismulti:r.ismulti,mustleaf:f.mustleaf}).then(function(n){var u,i;if(n!==null&&n!==undefined){if(r.items=n.items,r.selectItem=n.selectItem,r.defaultFilter=n.defaultFilter,u=[],!!r.selectItem&&r.selectItem.length>0)for(i=0;i<r.selectItem.length;i++)u.push(r.selectItem[i][f.valueMember]);r.fmModel=u.join(",");r.IsSelectData=!0}else n===null&&(r.fmModel="");t(function(){!!r.selectItem&&r.selectItem.length>0&&(r.fmTextModel=r.selectItem[0].text);o=r.selectItem[0]})});break;case"joblevel":i.open(_shared.dialogs.jobLevelDialog,{value:r.fmModel,ismulti:r.ismulti}).then(function(n){var u,i;if(n!==null&&n!==undefined){if(r.items=n,r.selectItem=n,u=[],!!r.selectItem&&r.selectItem.length>0)for(i=0;i<r.selectItem.length;i++)u.push(r.selectItem[i][f.valueMember]);r.fmModel=u.join(",");r.IsSelectData=!0}else n===null&&(r.fmModel="");t(function(){!!r.selectItem&&r.selectItem.length>0&&(r.fmTextModel=r.selectItem[0].text);o=r.selectItem[0]})})}};r.event_Blur=function(){$(u).removeClass("focus")}}}}}}]);
/**** fm-datetime.js *****/
_shared.directive("fmDatetime",["fmTool","$timeout",function(n){return{restrict:"E",replace:!0,template:function(t,i){i.$ctrlType="fm-datetime";n.textInit(i);var r=n.setValidate(i);return i.name||(i.name=i.fmModel.toString().substring(i.fmModel.lastIndexOf(".")+1)),'<div fm-model="'+i.fmModel+'" title="{{getShadeText()}}" class="input-sm fm-text form-control" ng-class="state" ng-mousedown="event_textboxClick($event)"><input '+(!i.name?"":'name="'+i.name+'"')+" "+r.join(" ")+' class="fm-text-input validate"  type="text"/><label class="fm-text-shadetext">{{ shadeText }}<\/label><div class="fm-text-tool"><i class="textbox_unit" ng-hide="!unit">{{unit}}<\/i><i class="fm-text-tool-clear icon-times" ng-hide="!iClear || state!=\'normal\'" ng-mousedown="clearText($event)"><\/i><\/div><\/div>'},scope:{fmModel:"=",unit:"=",fmNormal:"=",fmRequired:"=",fmDisabled:"=",fmReadonly:"=",startDate:"=",endDate:"=",fmBlur:"&",fmChange:"&"},link:function(t,i,r){function e(n){var t,i;(n===null||n===undefined)&&(n="");t="";switch(r.view){case"hours":/^(20|21|22|23|[0-1]?\d):[0-5]?\d$/.test(n)&&(t=n);break;case"datetime":i=_$.newDate(n);i!="Invalid Date"&&(t=i.format("yyyy-MM-dd hh:mm"));break;case"month":t=n;break;default:i=_$.newDate(n);i!="Invalid Date"&&(t=i.format("yyyy-MM-dd"))}return t}var u=i.find("input"),f=window.$currentUser&&$currentUser.langugage||"zh-CN",o;r.view=="hours"?u.datetimepicker({language:f,weekStart:0,todayBtn:0,autoclose:1,todayHighlight:1,startView:1,minView:0,maxView:1,forceParse:0,format:"hh:ii"}):r.view=="month"?(u.datetimepicker({language:f,weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:3,minView:3,maxView:5,forceParse:0,format:"yyyy-mm"}),$(u).attr("readonly","readonly")):r.view=="datetime"?u.datetimepicker({language:f,weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:0,maxView:1,forceParse:0,format:"yyyy-mm-dd hh:ii"}):u.datetimepicker({language:f,weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0,format:"yyyy-mm-dd"});o=$(u).data("datetimepicker");t.fmPlaceholder=r.fmPlaceholder;t.format=r.format;t.fieldName=r.fieldName;t.unit=t.unit||r.unit;t.iClear=t.iClear||r.iClear!=undefined&&r.iClear!="false"&&!0;!r.iClear||r.iClear=="false"||(t.iClear=!0);n.setScopeState(t,r);t.findText=function(n){return!t.fmModel||n.indexOf(t.fmModel)>=0?!0:!1};n.setDefaultWatch(r,t,i);t.clearText=function(){t.fmModel=""};t.$watch("fmModel",function(n){var r=e(n);t.shadeText=r;$(i).find("input").val(r)});t.$watch("startDate",function(n){n&&$(i).find("input").datetimepicker("setStartDate",n)});t.$watch("endDate",function(n){n&&$(i).find("input").datetimepicker("setEndDate",n)});$(i).find("input").on("change blur",function(n){t.fmModel=$(this).val();t.$apply();switch(n.type){case"blur":t.fmBlur();break;case"change":t.fmChange()}t.$apply()}).val(e(t.fmModel)).datetimepicker("update")}}}]);
/**** fm-job-select.js *****/
_shared.directive("fmJobSelect",["fmTool","$timeout","dialog","mabp.app.module","mabp.app.bpm",function(n,t,i){return{restrict:"E",replace:!0,template:function(t,i){n.setDefaultMember(i);var r=n.setValidate(i);return i.ismulti=i.ismulti!==undefined&&i.ismulti!=="false"?!0:!1,i.name||(i.name=i.fmModel.toString().substring(i.fmModel.lastIndexOf(".")+1)),'<div fm-model="'+i.fmModel+'" class="ma-data-select '+(i.ismulti?"multi":"single")+" "+i.class+'" ng-class="state" ng-mousedown="openSelect($event)" ng-blur="event_Blur()">'+(!i.placeholder?"":'<div class="placeholder"  ng-class="{\'hide\':!!fmModel}">'+i.placeholder+"<\/div>")+'<div class="select-data-value"><div class="item" style="witdh:auto;" ng-repeat="item in selectItem" ng-mousedown="event_removeSelectItem(item, $event)">{{item.text}}'+(i.ismulti?"":'<i ng-hide="!iClear || state!=\'normal\'" class="icon-times remove" ng-mousedown="clear($event)"><\/i>')+'<\/div><div class="item" ng-if="(!selectItem || selectItem.length == 0) && !!defaultModel">{{defaultModel}}<\/div><\/div><button class="btn btn-info select-data-button" type="button" ng-click="event_SelectData()" >{{\'Choose\' | translate}}<\/button><input type="hidden" '+(!i.name?"":'name="'+i.name+'"')+" "+r.join(" ")+' ng-model="fmModel" /><\/div>'},scope:{fmModel:"=",fmCode:"=",columns:"=",selectItem:"=",isOpen:"=",datacode:"=",fmRequired:"=",fmNormal:"=",fmDisabled:"=",fmReadonly:"=",filter:"=",parentId:"=",defaultModel:"=",callbackFunc:"&",fmBlur:"&"},require:"?^fmCache",compile:function(){return{pre:function(){},post:function(r,u,f,e){r.datatype="job";r.iClear=r.iClear&&r.iClear!==!1||f.iClear!=undefined&&f.iClear!="false"&&!0;r.ismulti=!f.ismulti||f.ismulti==="false"||r.ismulti!==undefined?!1:!0;r.hideuser=r.hideuser&&r.hideuser!==!1||f.hideuser!=undefined&&f.hideuser!="false"&&!0;isnull=f.isnull==undefined?!0:f.isnull!=undefined&&f.isnull!="false";n.setScopeState(r,f,e);r.$watch("filter",function(){!r.filter||r.state!="normal"||n.setDataSource(r,f,e)},!0);var o=u.find(".option");r.selectItem=[];r.isShow=!1;n.setDefaultWatch(f,r,u);r.$watch("selectItem",function(t,i){(t==null||i==null||t.length!=0||i.length!=0)&&(r.fmBlur({item:r.$parent.item||null}),r.state=="normal"&&n.isInitialed(r,u,f)&&r.callbackFunc({selectItem:r.selectItem}))},!0);r.$watch("fmModel",function(){n.getOne(r,f,{hideUser:r.hideuser},e)});r.focus=function(){t(function(){u.find("[type=text]").focus()},100)};r.clear=function(n){r.selectItem=[];r.fmModel="";n.stopPropagation()};r.event_removeSelectItem=function(n,t){f.ismulti&&r.event_selectItem(n,t)};r.event_selectItem=function(n,t){if(r.state=="normal"){if(f.ismulti){var i=r.fmModel?(r.fmModel||"").split(","):[],e=i.indexOf(n[f.valueMember]);e>=0?i.splice(e,1):i.push(n[f.valueMember]);r.fmModel=i.join(",");t.stopPropagation()}else r.fmModel=n[f.valueMember];console.info(n[f.displayMember],n[f.valueMember],n[f.codeMember]);u.focus()}};r.event_SelectData=function(){r.state=="normal"&&i.open(_shared.dialogs.fmJobSelectDialog,{data:r.selectItem,datatype:"source",filter:r.filter,selectData:r.fmModel,column:r.columns,title:f.placeholder,ismulti:r.ismulti,valueMember:f.valueMember,hideUser:r.hideuser}).then(function(n){n!==null&&(r.fmModel=n)})};r.event_Blur=function(){$(u).removeClass("focus")}}}}}}]);
/**** fm-number.js *****/
_shared.directive("fmNumber",["fmTool","$timeout",function(n,t){return{restrict:"E",replace:!0,template:function(t,i){i.$ctrlType="fm-number";n.textInit(i);var r=n.setValidate(i);return i.name||(i.name=i.fmModel.toString().substring(i.fmModel.lastIndexOf(".")+1)),'<div fm-model="'+i.fmModel+'" title="{{ shadeText }}" class="input-sm fm-text form-control '+(i.cny!=undefined?"text-align-right":"")+'" ng-class="state" ng-mousedown="event_textboxClick($event)" ng-keydown="event_textBoxKeyDown($event)"><input string-to-number '+(!i.name?"":'name="'+i.name+'"')+" "+r.join(" ")+' placeholder="{{fmPlaceholder}}" class="fm-text-input validate" ng-readonly="state==\'readonly\'" ng-disabled="state==\'disabled\'" type="text" ng-model="fmModel" ng-change="event_changeTxt($event)" ng-focus="event_textFocus($event)" ng-blur="event_textBlur($event)" ng-keypress="event_textBoxKeyPress($event)" autocomplete="off" ma-dynamic-element /><label ng-hide="!hasShadeText()" class="fm-text-shadetext">{{ shadeText }}<\/label><div class="fm-text-tool"><i class="textbox_unit" ng-hide="{{getUnit()==\'\'}}">{{getUnit()}}<\/i><i class="fm-text-tool-clear icon-times" ng-hide="(!iClear) || (state!=\'normal\')" ng-mousedown="clearText($event)"><\/i><\/div><div class="option" title="" style=""><div class="option-item"><ul><li ng-class="{\'active\':item==itemText}" ng-repeat="item in items | filter: findText" style="" ng-click="selectItem($event, item)" ng-mouseover="event_selectItemMouseOver($event,item)">{{item}}<\/li><\/ul><\/div><\/div><\/div>'},scope:{fmModel:"=",toolHtml:"=",fmUnit:"=",items:"=",fmNormal:"=",fmRequired:"=",fmDisabled:"=",fmReadonly:"=",callbackFunc:"&",fmBlur:"&"},link:function(i,r,u){function f(){var n=i.textControl.val();new RegExp(u.fmPattern).test(n)?i.fmModel=i.historyValue=n:(i.fmModel=i.historyValue,i.textControl.val(i.historyValue))}i.textControl=r.find("input");i.fieldName=u.fieldName;i.fmPlaceholder=u.fmPlaceholder;i.historyValue="";i.iClear=i.iClear||u.iClear!=undefined&&u.iClear!="false"&&!0;n.setScopeState(i,u);i.textControl.on("input",function(){});i.setShadeText=function(){i.fmModel!=null?u.formatStr?i.shadeText=u.formatStr.fill(i.fmModel):!u.formatFunc||(i.shadeText=u.formatFunc(i.fmModel)):i.shadeText=""};i.hasShadeText=function(){return(!!u.formatStr||!!u.formatFunc)&&i.state!="readonly"&&i.state!="disabled"||i.state=="readonly"||i.state=="disabled"};i.getUnit=function(){return i.fmUnit||u.unit||""};i.findText=function(n){return!i.fmModel||n.indexOf(i.fmModel)>=0?!0:!1};n.setDefaultWatch(u,i,r);i.event_selectItemMouseOver=function(n,t){i.itemText=t};i.$watch("fmModel",function(){if(i.setShadeText(),i.fmModel&&u.scale){var n=(i.fmModel+"").split(".");n.length>1&&(i.fmModel=n[0]+"."+n[1].substring(0,u.scale))}});i.selectItem=function(n,t){i.fmModel=t;i.itemText="";r.removeClass("open");n.stopPropagation()};i.event_textBoxKeyPress=function(n){switch(n.charCode){case 45:(n.target.value.indexOf("-")>0||n.target.selectionStart!=0)&&(n.originalEvent.returnValue=!1);break;case 46:u.scale>0?(n.target.value.indexOf(".")>0||n.target.selectionStart==0)&&(n.originalEvent.returnValue=!1):n.originalEvent.returnValue=!1;break;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:var i=u.NumLength,t=n.target.value.indexOf(".");t>=0&&n.target.value.indexOf("-")>=0&&i++;t>0&&n.target.value.substring(t).length>6&&n.target.selectionStart>t&&n.target.selectionStart==n.target.selectionEnd?n.originalEvent.returnValue=!1:t==-1?n.target.value.substring(t).length>=i&&n.target.selectionStart==n.target.selectionEnd&&(n.originalEvent.returnValue=!1):n.target.value.substring(0,t).length>=i&&n.target.selectionStart<=t&&n.target.selectionStart==n.target.selectionEnd&&(n.originalEvent.returnValue=!1);break;default:n.originalEvent.returnValue=!1}};i.event_textBoxKeyDown=function(n){if(!!i.items&&i.items.length>0){var u=i.getIndex(i.itemText),t=i.getFindItems();if(r.hasClass("open"))switch(n.keyCode){case 38:u>0?(u--,i.itemText=t[u]):(u=t.length-1,i.itemText=t[t.length-1]);break;case 40:u<t.length-1?(u++,i.itemText=t[u]):(u=0,i.itemText=t[0]);break;case 13:i.fmModel=i.itemText;r.removeClass("open");break;case 8:if(!i.fmModel){r.removeClass("open");i.itemText="";return}default:t.length==0&&r.removeClass("open")}else switch(n.keyCode){case 8:if(!i.fmModel){r.removeClass("open");i.itemText="";return}case 40:case 13:t.length>0&&r.addClass("open");break;default:t.length>0&&(r.removeClass("open"),i.itemText="")}}};i.getIndex=function(n){var r=i.getFindItems(),t;if(!r)return-1;for(t=0;t<r.length;t++)if(n==r[t])return t;return-1};i.getFindItems=function(){var t=[],n;if(!!i.items&&i.items.length>0)for(n=0;n<i.items.length;n++)(!i.fmModel||i.items[n].indexOf(i.fmModel)>=0)&&t.push(i.items[n]);return t};i.event_textboxClick=function(n){n.stopPropagation()};i.event_changeTxt=function(){t(function(){i.callbackFunc()},0)};i.itemText="";i.documentClick=function(){angular.element(document).off("mousedown",i.documentClick);t(function(){r.removeClass("open")},0)};i.event_textFocus=function(){r.addClass("focus");angular.element(document).on("mousedown",i.documentClick)};i.event_textBlur=function(){f();i.fmBlur({item:i.$parent.item||null});r.removeClass("focus")};i.clearText=function(n){i.fmModel="";t(function(){r.children("input").focus()},0);n.stopPropagation()};$(r).find("input").on("keydown change",function(){var n=$(this).val().replace(/[^0-9.-]/g,"");$(this).val(n);i.$apply(function(){i.fmModel=n})})}}}]).directive("stringToNumber",function(){return{require:"ngModel",link:function(n,t,i,r){r.$parsers.push(function(n){return""+n});r.$formatters.push(function(n){return parseFloat(n,10)})}}});
/**** fm-radiolist.js *****/
_shared.directive("fmRadiolist",["fmTool","mabp.app.module","$timeout",function(n,t,i){return{restrict:"E",replace:!0,template:function(t,i){n.setDefaultMember(i);i.name||(i.name=(i.fmModel||"").toString().substring(i.fmModel.lastIndexOf(".")+1));var r=(100/i.columncount).getPrecision(1)-1;return'<div fm-model="'+i.fmModel+'" class="fm-checklist input-sm" ng-class="state" ids="{{fmModel}}{{random}}" ng-blur="event_Blur()"><div style="width:'+r+'%;" class="fm-checklist-checkbox" ng-repeat="r in items track by $index"><label><input ng-disabled="state == \'disabled\' || state == \'readonly\' || r.'+i.disabledMember+' === true" ng-checked="isChecked(r)" name="'+i.name+'{{random}}" type="radio" value="{{r.'+i.valueMember+'}}" ng-click="event_ChangeValue(r, $event)" />{{r.'+i.displayMember+"}}<\/label><\/div><\/div>"},scope:{fmModel:"=",fmCode:"=",items:"=",selectItem:"=",fmNormal:"=",fmRequired:"=",fmDisabled:"=",fmReadonly:"=",filter:"=",callbackFunc:"&",fmBlur:"="},require:"?^fmCache",compile:function(){return{pre:function(){},post:function(t,r,u,f){t.random=_$.getGUID().substr(0,4);u.fmModel=="form.pur01.expenseSource"&&console.log(t.fmModel+t.state);t.isLoadBefore=!0;n.setScopeState(t,u);n.setDataSource(t,u,f);t.$watch("filter",function(i,r){!i||i==r||n.setDataSource(t,u,f)},!0);t.isChecked=function(n){return t.fmModel===0&&(t.fmModel="0"),(t.fmModel||"").toString()===n[u.valueMember]+""};n.setDefaultWatch(u,t,r);n.LoadInitData(t,u);t.$watch("fmModel",function(){var i,r,n;if(!t.Init&&!!t.fmModel&&!!t.items){for(i=!0,n=0;n<t.items.length;n++)if(t.fmModel==t.items[n][u.valueMember]){t.selectItem=[t.items[n]];i=!1;break}if(i&&(t.selectItem=[]),u.codeMember&&!!t.selectItem){for(r=[],n=0;n<t.selectItem.length;n++)r.push(t.selectItem[n][u.codeMember]);t.fmCode=r.join(",")}}});t.$watch("items",function(){var i,n;if(!!t.items){for(t.fmModel===0&&(t.fmModel="0"),i=(t.fmModel||"").toString(),t.selectItem=[],_tempCode=[],n=0;n<t.items.length;n++)if(i==t.items[n][u.valueMember]+""){t.selectItem.push(t.items[n]);_tempCode.push(t.items[n][u.codeMember]);break}t.fmCode=_tempCode.join(",")}},!0);t.event_ChangeValue=function(n){t.fmModel=n[u.valueMember];console.info(n[u.displayMember],n[u.valueMember],n[u.codeMember]);t.state=="normal"&&i(function(){t.callbackFunc({selectItem:n,fmModel:t.fmModel})})};t.event_Blur=function(){$(r).removeClass("focus")}}}}}}]);
/**** fm-select.js *****/
_shared.directive("fmSelect",["fmTool","$timeout","mabp.app.module","mabp.app.bpm",function(n,t,i){return{restrict:"E",replace:!0,template:function(t,i){n.setDefaultMember(i);var r=n.setValidate(i);return i.ismulti=i.ismulti!==undefined&&i.ismulti!=="false"?!0:!1,i.name||(i.name=i.fmModel.toString().substring(i.fmModel.lastIndexOf(".")+1)),'<div fm-model="'+i.fmModel+'" field-text="{{getShadeText()}}" tabindex="-1" class="input-sm ma-select '+(i.ismulti?"multi":"single")+" "+i.class+'" ng-class="state" ng-mousedown="openSelect($event)" ng-blur="blur()" ng-focus="focus()"><div class="placeholder" ng-hide="!fmPlaceholder" ng-class="{\'hide\':!!fmModel}">{{fmPlaceholder}}<\/div><div class="select-value"><div class="item" ng-repeat="item in selectItem" ng-mousedown="event_removeSelectItem(item, $event)"><span> {{item.'+i.displayMember+"}}"+(i.ismulti?"":'<i ng-hide="!iClear" class="icon-times remove" ng-mousedown="event_ClearItem($event)"><\/i><\/span>')+'<\/div><\/div><div class="option" title=""><input ng-hide="!hasItem(15)" type="text" placeholder="Select" ng-model="findText" ng-mousedown="stopPropagation($event)" /><div class="option-item" ng-mousedown="stopPropagation($event)" ><ul><li ng-mousedown="event_selectItem(item, $event)" ng-class="{\'active\': isCheck(item)}" ng-repeat="item in items | filter: {'+i.displayMember+':findText} track by $index">{{item.'+i.displayMember+'}}<\/li><\/ul><\/div><\/div><input type="hidden" '+(!i.name?"":'name="'+i.name+'"')+" "+r.join(" ")+' ng-model="fmModel" ma-dynamic-element /><\/div>'},scope:{fmModel:"=",fmCode:"=",items:"=",selectItem:"=",isOpen:"=",findText:"=",datacode:"=",fmNormal:"=",fmRequired:"=",fmDisabled:"=",fmReadonly:"=",filter:"=",callbackFunc:"&",fmBlur:"&"},require:"?^fmCache",link:function(r,u,f,e){r.fmPlaceholder=f.fmPlaceholder;r.isLoadBefore=!0;r.iClear=r.iClear&&r.iClear!==!1||f.iClear!=undefined&&f.iClear!="false"&&!0;isnull=f.isnull==undefined?!0:f.isnull!=undefined&&f.isnull!="false";n.setScopeState(r,f);t(function(){r.state=="normal"},100);r.$watch("filter",function(t,i){!t||t==i||n.setDataSource(r,f,e)},!0);var o=u.find(".option");r.selectItem=[];r.isShow=!1;n.setDefaultWatch(f,r,u);n.LoadInitData(r,f);r.$watch("items",function(){var t,i,n;if(!!r.items){for(t=0,r.items.length==0?u.addClass("zeroitem"):u.removeClass("zeroitem"),i=!!r.fmModel||r.fmModel==0?r.fmModel.toString().split(","):[],r.selectItem=[],_tempCode=[],n=0;n<r.items.length;n++)r.items[n]!=null&&(!!r.items[n][f.displayMember]&&r.items[n][f.displayMember].length>t&&(t=r.items[n][f.displayMember].length),i.indexOf(r.items[n][f.valueMember]+"")>=0&&(r.selectItem.push(r.items[n]),_tempCode.push(r.items[n][f.codeMember])));r.fmCode=_tempCode.join(",");o.css("width",t+3+"em")}},!0);r.$watch("datacode",function(t,u){if(!!f.datacode){t==u||!t||!u||(r.selectItem=null,r.ngModel=null,r.selectText="");var o=r.datacode;if(!f.datacodeFormat||(o=f.datacodeFormat.fill(r.datacode)),r.state=="normal")switch(r.datatype){case"view":n.getView(r.datacode,r.filter,function(n){var i,t;if(!!n){for(i={},t=0;t<n.displayColumList.length;t++)n.displayColumList[t].displayColumn=n.displayColumList[t].displayColumn.substring(0,1).toLowerCase()+n.displayColumList[t].displayColumn.substring(1),i[n.displayColumList[t].displayColumn]=n.displayColumList[t].name;r.items=n}},null,e);break;case"dataitem":n.getBasicdata(o,r.filter,function(n){!n||(r.items=n.data)},e)}else n.getOne(r,f,i,e)}});r.$watch("selectItem",function(t,i){var o,e;if((t==null||i==null||t.length!=0||i.length!=0)&&(r.fmBlur({item:r.$parent.item||null}),r.state!="normal"||t==null&&i!=null&&i.length==0||i==null&&t!=null&&t.length==0||!n.isInitialed(r,u,f)||r.callbackFunc({selectItem:r.selectItem,fmModel:r.fmModel}),o=[],!!r.selectItem)){for(e=0;e<r.selectItem.length;e++)o.push(r.selectItem[e][f.codeMember]);r.fmCode=o.join(",")}},!0);r.dataUpdate=function(){var o,u,i,t;if(r.state!="normal"||!r.items||r.fmModel===undefined)r.state!="normal"||r.items?r.state!="normal"&&r.fmModel!==undefined?n.getOne(r,f,null,e):r.fmModel===undefined&&(r.selectItem={}):n.setDataSource(r,f,e);else{if(f.ismulti)for(o=(r.fmModel||"").split(","),i=[],r.selectItem=[],t=0;t<r.items.length;t++)o.indexOf(r.items[t][f.valueMember])>=0&&r.selectItem.push(r.items[t]);else{for(u=!0,t=0;t<r.items.length;t++)if(r.items[t][f.valueMember]==r.fmModel){r.selectItem=[r.items[t]];u=!1;break}u&&(r.selectItem=[])}if(f.codeMember&&!!r.selectItem){for(i=[],t=0;t<r.selectItem.length;t++)i.push(r.selectItem[t][f.codeMember]);r.fmCode=i.join(",")}}};r.$watch("fmModel",function(n,t){var o,e,u,i;if(n==undefined&&(r.selectItem=[]),t==null||n!=null)if(r.Init){if(r.state=="normal"&&!!r.items&&r.fmModel!==undefined){if(f.ismulti)for(o=(r.fmModel||"").split(","),u=[],r.selectItem=[],i=0;i<r.items.length;i++)o.indexOf(r.items[i][f.valueMember])>=0&&r.selectItem.push(r.items[i]);else{for(e=!0,i=0;i<r.items.length;i++)if(r.items[i][f.valueMember]==r.fmModel){r.selectItem=[r.items[i]];e=!1;break}e&&(r.selectItem=[])}if(f.codeMember&&!!r.selectItem){for(u=[],i=0;i<r.selectItem.length;i++)u.push(r.selectItem[i][f.codeMember]);r.fmCode=u.join(",")}}}else r.dataUpdate()});r.hasItem=function(n){return n||(n=0),r.items&&(r.items.length>n||Object.keys(r.items).length>n)};r.documentClick=function(n){n==n&&(angular.element(document).off("mousedown",r.documentClick),r.isOpen&&t(function(){r.setOpen(!1)},0))};r.stopPropagation=function(n){n.stopPropagation()};openSelectOfRoot=function(n){console.log(n)};r.openSelect=function(n){if(r.state=="normal"){if(r.setOpen(!r.isOpen),r.isOpen)angular.element(document).on("mousedown",r.documentClick);r.TopOrBottom()}n.stopPropagation()};r.setOpen=function(n){r.state=="normal"&&(r.isOpen=n,n?u.addClass("open"):u.removeClass("open"))};r.TopOrBottom=function(){o.offset().top+o.height()>$(document).height()?o.css({top:o.height()*-1-10+"px",boxShadow:"0 -3px 12px rgba(0,0,0,0.175)"}):o.css({top:"",boxShadow:""})};r.blur=function(){$(u).removeClass("focus");t(function(){u.is(":focus")||u.find("[type=text]").is(":focus")||r.setOpen(!1)},100)};r.focus=function(){t(function(){u.find("[type=text]").focus()},100)};r.isCheck=function(n){if(!n)return!1;try{return(r.fmModel?r.fmModel.toString().split(","):[]).indexOf(n[f.valueMember])>=0}catch(t){}};r.clear=function(n){r.selectItem=[];r.fmModel="";n.stopPropagation()};r.event_ClearItem=function(n){r.fmModel="";r.selectItem=[];n.stopPropagation()};r.event_removeSelectItem=function(n,t){f.ismulti&&r.event_selectItem(n,t)};r.event_selectItem=function(n,t){if(r.state=="normal"){if(f.ismulti){var i=r.fmModel?(r.fmModel||"").split(","):[],e=i.indexOf(n[f.valueMember]);e>=0?i.splice(e,1):i.push(n[f.valueMember]);r.fmModel=i.join(",")}else r.fmModel=n[f.valueMember],r.findText="";console.info(n[f.displayMember],n[f.valueMember],n[f.codeMember]);u.focus()}f.ismulti||r.setOpen(!1);t.stopPropagation()};r.isShowItem=function(n){return r.findText?(n[f.displayMember]||"").toLowerCase().indexOf((r.findText||"").toLowerCase())<0:!1};r.updateState=function(){if(r.state=="normal"&&!r.items)switch(r.datatype){case"view":n.getView(r.datacode,r.filter,function(n){!n||(r.items=n.viewTable)},null,e);break;case"dataitem":n.getBasicdata(r.datacode,r.filter,function(n){!n||(r.items=n.data)},e)}}}}}]);
/**** fm-text.js *****/
_shared.directive("fmText",["fmTool","$timeout",function(n,t){return{restrict:"E",replace:!0,template:function(t,i){i.$ctrlType="fm-text";n.textInit(i);var r=n.setValidate(i);return'<div field-text="{{getShadeText()}}" class="form-control input-sm fm-text" ng-class="state" ng-mousedown="event_textboxClick($event)" ng-keydown="event_textBoxKeyDown($event)"><input '+r.join(" ")+' placeholder="{{fmPlaceholder}}" class="fm-text-input validate" ng-readonly="state==\'readonly\'" ng-disabled="state==\'disabled\'" type="text" ng-model="fmModel" ng-change="event_changeTxt($event)" ng-focus="event_textFocus($event)" ng-blur="event_textBlur($event)" autocomplete="off" ma-dynamic-element /><label ng-show="('+(!!i.formatStr||!!i.formatFunc)+' && state!=\'readonly\' && state!=\'disabled\') || state==\'readonly\' || state==\'disabled\'" class="fm-text-shadetext">{{getShadeText()}}<\/label><div class="fm-text-tool"><i class="textbox_unit" ng-hide="{{getUnit()==\'\'}}">{{getUnit()}}<\/i><i class="fm-text-tool-clear icon-times" ng-hide="!iClear || state!=\'normal\'" ng-mousedown="clearText($event)"><\/i><\/div><div class="option" title="" style=""><div class="option-item"><ul><li ng-class="{\'active\':item==itemText}" ng-repeat="item in items | filter: findText" style="" ng-mousedown="selectItem($event, item)" ng-mouseover="event_selectItemMouseOver($event,item)">{{::item}}<\/li><\/ul><\/div><\/div>{{execount}}<\/div>'},scope:{fmModel:"=",toolHtml:"=",fmUnit:"=",items:"=",fmNormal:"=",fmRequired:"=",fmDisabled:"=",fmReadonly:"=",fmBlur:"&",nodecode:"=",jobcode:"="},link:function(i,r,u){i.textControl=r.find("input");i.textControl.on("input",function(){});i.historyValue="";i.fmPlaceholder=u.fmPlaceholder;i.fieldName=u.fieldName;i.unit=i.unit||u.unit;i.iClear=i.iClear||u.iClear!=undefined&&u.iClear!="false"&&!0;!u.iClear||u.iClear=="false"||(i.iClear=!0);i.keydown=i.keydown||u.keydown!=undefined&&u.keydown!="false"&&!0;n.setScopeState(i,u);i.getShadeText=function(){return i.fmModel!=null?u.formatStr?u.formatStr.fill(i.fmModel):u.formatFunc?u.formatFunc(i.fmModel):i.fmModel:""};i.hasShadeText=function(){return(!!u.formatStr||!!u.formatFunc)&&i.state!="readonly"&&i.state!="disabled"||i.state=="readonly"||i.state=="disabled"};i.getUnit=function(){return i.fmUnit||u.unit||""};i.findText=function(n){return!i.fmModel||n.indexOf(i.fmModel)>=0?!0:!1};n.setDefaultWatch(u,i,r);i.event_selectItemMouseOver=function(n,t){i.itemText=t};i.selectItem=function(n,t){i.fmModel=t;i.itemText="";r.removeClass("open");n.stopPropagation()};i.event_textBoxKeyDown=function(n){var e,o,f,t;if(!i.keydown||n.keyCode==13&&i.event_textBlur(),u.creditcard!=undefined&&u.creditcard!=="false"){e=!1;switch(n.key){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"Backspace":case"ArrowLeft":case"ArrowRight":case"Delete":break;default:e=!0}if(e)switch(n.keyCode){case 8:case 37:case 39:case 46:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:break;default:n.originalEvent.returnValue=!1}}if(u.qty!=undefined&&u.qty!=="false"){o=!1;switch(n.key){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case".":case"Backspace":case"ArrowLeft":case"ArrowRight":case"Delete":break;default:o=!0}if(o)switch(n.keyCode){case 8:case 37:case 39:case 46:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 190:break;default:n.originalEvent.returnValue=!1}}if(!!i.items&&i.items.length>0)if(f=i.getIndex(i.itemText),t=i.getFindItems(),r.hasClass("open"))switch(n.keyCode){case 38:f>0?(f--,i.itemText=t[f]):(f=t.length-1,i.itemText=t[t.length-1]);break;case 40:f<t.length-1?(f++,i.itemText=t[f]):(f=0,i.itemText=t[0]);break;case 13:i.fmModel=i.itemText;r.removeClass("open");break;case 8:if(!i.fmModel){r.removeClass("open");i.itemText="";return}default:t.length==0&&r.removeClass("open")}else switch(n.keyCode){case 8:if(!i.fmModel){r.removeClass("open");i.itemText="";return}case 40:case 13:t.length>0&&r.addClass("open");break;default:t.length>0&&(r.removeClass("open"),i.itemText="")}};i.getIndex=function(n){var r=i.getFindItems(),t;if(!r)return-1;for(t=0;t<r.length;t++)if(n==r[t])return t;return-1};i.getFindItems=function(){var t=[],n;if(!!i.items&&i.items.length>0)for(n=0;n<i.items.length;n++)(!i.fmModel||i.items[n].indexOf(i.fmModel)>=0)&&t.push(i.items[n]);return t};i.event_textboxClick=function(n){n.stopPropagation()};i.event_changeTxt=function(){u.qty!=undefined&&u.qty!=="false"&&(new RegExp("^(-?[0-9]{1,12}(\\.([0-9]{1,11})?)?)?$").test(i.textControl.val().replace(",",""))?(i.historyValue=i.fmModel.replace(",",""),i.fmModel=i.fmModel.replace(",","")):i.fmModel=i.historyValue);u.creditcard!=undefined&&u.creditcard!=="false"&&(new RegExp("^(-?[0-9]{1,})?$").test(i.textControl.val().replace(",",""))?(i.historyValue=i.fmModel.replace(",",""),i.fmModel=i.fmModel.replace(",","")):i.fmModel=i.historyValue)};i.itemText="";i.documentClick=function(){angular.element(document).off("mousedown",i.documentClick);t(function(){r.removeClass("open")},0)};i.event_textFocus=function(){r.addClass("focus");angular.element(document).on("mousedown",i.documentClick)};i.event_textBlur=function(){i.fmBlur({item:i.$parent.item||null});r.removeClass("focus")};i.clearText=function(){i.fmModel=""};i.$watch("fmModel",function(){u.creditcard!=undefined&&u.creditcard!=="false"&&(i.fmModel=i.trim(i.fmModel,"g"))});i.trim=function(n,t){if(!n)return n;var i;return i=n.replace(/(^\s+)|(\s+$)/g,""),t.toLowerCase()=="g"&&(i=i.replace(/\s/g,"")),i}}}}]);
/**** fm-textarea.js *****/
_shared.directive("fmTextarea",["fmTool","$timeout",function(n,t){return{restrict:"E",replace:!0,template:function(t,i){i.$ctrlType="fm-textarea";n.textInit(i);var r=n.setValidate(i);return i.name||(i.name=i.fmModel.toString().substring(i.fmModel.lastIndexOf(".")+1)),'<div fm-model="'+i.fmModel+'" field-text="{{fmModel}}" class="fm-text input-sm form-control multiline" ng-class="state" ng-mousedown="event_textboxClick($event)" ng-keydown="event_textBoxKeyDown($event)"><textarea style="height: '+i.fmHeight+'px" '+(!i.name?"":'name="'+i.name+'"')+" "+r.join(" ")+' ng-attr-placeholder="{{fmPlaceholder}}" class="fm-text-input validate" ng-readonly="state==\'readonly\'" ng-disabled="state==\'disabled\'" type="text" ng-model="fmModel" ng-change="event_changeTxt()" ng-focus="event_textFocus($event)" ng-blur="event_textBlur($event)" ma-dynamic-element ><\/textarea><pre class="fm-text-pre" ><span class="fm-text-shadetext">{{fmModel}}<\/span><\/pre><div class="fm-text-tool"><i class="fm-text-tool-clear icon-times" ng-hide="!iClear || state!=\'normal\'" ng-mousedown="clearText($event)"><\/i><\/div><div class="option" title="" style=""><div class="option-item"><ul><li ng-class="{\'active\':item==itemText}" ng-repeat="item in items | filter: findText" style="" ng-click="selectItem($event, item)" ng-mouseover="event_selectItemMouseOver($event,item)">{{item}}<\/li><\/ul><\/div><\/div><\/div>'},scope:{fmModel:"=",toolHtml:"=",items:"=",fmNormal:"=",fmDisabled:"=",fmReadonly:"=",fmRequired:"=",fmHeight:"="},link:function(i,r,u){i.fmPlaceholder=u.fmPlaceholder;i.iClear=i.iClear||u.iClear!=undefined&&u.iClear!="false"&&!0;!u.iClear||u.iClear=="false"||(i.iClear=!0);n.setScopeState(i,u);i.findText=function(n){return!i.fmModel||n.indexOf(i.fmModel)>=0?!0:!1};n.setDefaultWatch(u,i,r);i.event_selectItemMouseOver=function(n,t){i.itemText=t};i.selectItem=function(n,t){i.fmModel=t;i.itemText="";r.removeClass("open");n.stopPropagation()};i.event_textBoxKeyDown=function(n){if(!!i.items&&i.items.length>0){var u=i.getIndex(i.itemText),t=i.getFindItems();if(r.hasClass("open"))switch(n.keyCode){case 38:u>0?(u--,i.itemText=t[u]):(u=t.length-1,i.itemText=t[t.length-1]);break;case 40:u<t.length-1?(u++,i.itemText=t[u]):(u=0,i.itemText=t[0]);break;case 13:i.fmModel=i.itemText;r.removeClass("open");break;case 8:if(!i.fmModel){r.removeClass("open");i.itemText="";return}default:t.length==0&&r.removeClass("open")}else switch(n.keyCode){case 8:if(!i.fmModel){r.removeClass("open");i.itemText="";return}case 40:case 13:t.length>0&&r.addClass("open");break;default:t.length>0&&(r.removeClass("open"),i.itemText="")}}};i.getIndex=function(n){var r=i.getFindItems(),t;if(!r)return-1;for(t=0;t<r.length;t++)if(n==r[t])return t;return-1};i.getFindItems=function(){var t=[],n;if(!!i.items&&i.items.length>0)for(n=0;n<i.items.length;n++)(!i.fmModel||i.items[n].indexOf(i.fmModel)>=0)&&t.push(i.items[n]);return t};i.event_textboxClick=function(n){n.stopPropagation()};i.event_changeTxt=function(){};i.itemText="";i.documentClick=function(){angular.element(document).off("mousedown",i.documentClick);t(function(){r.removeClass("open")},0)};i.event_textFocus=function(){r.addClass("focus");angular.element(document).on("mousedown",i.documentClick)};i.event_textBlur=function(){r.removeClass("focus")};i.clearText=function(n){i.fmModel="";t(function(){r.children("textarea").focus()},0);n.stopPropagation()}}}}]);
/**** fm-applicant.js *****/
_shared.directive("fmApplicant",["$compile","dialog","mabp.app.taskRead",function(n,t,i){return{restrict:"E",replace:!0,template:function(){return'<div class="row"><div class="form-group"><div class="col-xs-12"><span class="col-xs-2 control-label">{{ "ApplicantName" | translate }}<\/span><div class="col-xs-4"><div class="input-group" style="width: 100%;"><span class="form-label">{{userinfo.userName}}<\/span><span class="input-group-btn" ng-if="!taskid"><button class="btn btn-default" type="button" ng-click="selectUser()">{{ "Choose" | translate }}<\/button><\/span><\/div><\/div><span class="col-xs-2 control-label">{{ "ApplicantEmployeeNumber" | translate }}<\/span><div class="col-xs-4"><span class="form-label">{{userinfo.employeeNumber}}<\/span><\/div><\/div><\/div><div class="form-group"><div class="col-xs-12"><span class="col-xs-2 control-label">{{ "ApplicantDepartment" | translate }}<\/span><div class="col-xs-10"><span class="form-label">{{userinfo.departmentName}}<\/span><\/div><\/div><\/div><div class="form-group" ng-if="!contactHide"><div class="col-xs-12"><span class="col-xs-2 control-label">{{ "ApplicantTelephone" | translate }}<\/span><div class="col-xs-4"><span class="form-label">{{userinfo.contactNumber}}<\/span><\/div><span class="col-xs-2 control-label">{{ "ApplicantEmail" | translate }}<\/span><div class="col-xs-4"><span class="form-label">{{userinfo.emailAddress}}<\/span><\/div><\/div><\/div><\/div>'},scope:{jobid:"=",userinfo:"=",taskid:"=",wfid:"=",areaCode:"="},link:function(n,r,u){u.contactHide==="true"&&(n.contactHide=!0);n.userinfo||(n.taskid?i.getFormHeaderInfo({taskId:n.taskid}).then(function(t){!t||(n.userinfo={jobId:t.applicantJobId,groupId:t.applicantGroupId,userId:t.applicantUserId,directManagerJobId:t.applicantDirectManagerJobId,department:t.applicantDepartment,userName:t.applicantUserName,employeeNumber:t.applicantEmployeeNumber,departmentName:t.applicantDepartmentName,contactNumber:t.applicantContactNumber,mobileNumber:t.applicantMobileNumber,emailAddress:t.applicantEmailAddress,directManagerName:t.applicantDirectManagerName,areaCode:t.areaCode})}):i.getUserInfo({jobId:n.jobid}).then(function(t){n.userinfo={jobId:t.jobId,groupId:t.groupId,userId:t.userId,directManagerJobId:t.directManagerJobId,department:t.department,userName:t.userName,employeeNumber:t.employeeNumber,departmentName:t.departmentName,contactNumber:t.telephone,mobileNumber:t.cellPhone,emailAddress:t.emailAddress,directManagerName:t.directManagerName,areaCode:t.areaCode}}));n.selectUser=function(){t.open(_shared.dialogs.formSelect,{datatype:"service",jobId:n.jobid,wfdWorkflowId:n.wfid,areaCode:n.areaCode}).then(function(t){var r=n.jobid,u=null;!t||!t.items[t.selectItem]||(r=t.items[t.selectItem].applicantJobId,u=t.items[t.selectItem].applicantUserId);i.getUserInfo({jobId:r,userId:u}).then(function(t){n.userinfo={jobId:t.jobId,groupId:t.groupId,userId:t.userId,directManagerJobId:t.directManagerJobId,department:t.department,userName:t.userName,employeeNumber:t.employeeNumber,departmentName:t.departmentName,contactNumber:t.telephone,mobileNumber:t.cellPhone,emailAddress:t.emailAddress,directManagerName:t.directManagerName,areaCode:t.areaCode}})})}}}}]);
/**** fm-approve-history.js *****/
_shared.directive("fmApproveHistory",["mabp.app.task","workflowModuleTransfer","$timeout","dialog","appSession",function(n,t,i,r,u){return{restrict:"AE",replace:!0,scope:{taskId:"=",taskInfos:"=",isall:"=",approveHistory:"=",expectApprover:"="},template:function(){return'<div class="row"><div class="form-group"><div class="col-xs-12" style="text-align: right; padding-right: 20px;margin-right: 10px;"><button class="btn btn-sm btn-default" style="margin-right: 5px;" ng-click="showSkip()"><span ng-if="!isSkip" class="ng-scope">{{ "ShowAllStep" | translate}}<\/span><span ng-if="isSkip" class="ng-scope">{{ "Hide" | translate}}<\/span><\/button><button class="btn btn-sm btn-default" ng-click="mailToAll()"><span class="ng-scope">Mail To All<\/span><\/button><\/div><\/div><div class="form-group"><div class="col-xs-12"><table class="table datatable table-bordered table-condensed table-hover table-approve-history"><thead><tr><th>{{ "ReceiveDate" | translate}}<\/th><th>{{ "CompletionTime" | translate}}<\/th><th>{{ "NodeName" | translate}}<\/th><th style="width:120px;">{{ "Handler" | translate}}<\/th><th style="width:80px;">{{ "Action" | translate}}<\/th><th>{{ "Memo" | translate}}<\/th><th style="width:110px;">{{ "Operation" | translate}}<\/th> <\/tr><\/thead><tbody><tr ng-repeat="i in taskInfos"><td ng-if="i.recvTime == null">{{ "UnReceived" | translate}}<\/td><td ng-if="i.recvTime != null"><div class="overflow-singleline">{{i.recvTime | date : "yyyy-MM-dd HH:mm:ss"}}<\/div><\/td><td><div class="overflow-singleline" ng-if="i.procTime!==\'0001-01-01T00:00:00\'">{{i.procTime | date : "yyyy-MM-dd HH:mm:ss"}}<\/div><\/td><td>{{i.wfdWorkflowNodeName}}<\/td><td>{{getProcer(i)}}<\/td><td style="width:80px;"><span ng-class="{true:\'text-success\',false:\'text-primary\'}[getAction(i.action)]">{{i.action}}<\/td><td class="align-left">{{i.note}}<\/td><td><i ng-if="$root.enableTest" class="icon icon-arrow-right cursor-pointer" ng-click="changeLogin(i)">切换账号<\/i><i ng-if="$root.enableTest && (i.type == 1 || i.type == 0) && (i.procStatus == 1 || i.procStatus == 2)" class="icon icon-history cursor-pointer" ng-click="backTask(i)"><\/i><i ng-if="i.procStatus != null && i.type != 6" class="icon icon-envelope cursor-pointer" ng-click="sendEmail(i)"><\/i><\/td><\/tr><\/tbody><\/table><\/div><\/div><\/div>'},link:function(f){f.$watch("isall",function(n){n!=undefined&&(f.isSkip=!n,i(function(){f.showSkip()},1e3))});f.isSkip=!1;f.$watch("approveHistory",function(){if(!!f.approveHistory&&!!f.approveHistory[0]){var n=f.approveHistory;f.allTaskInfos=n;f.hideSkipTaskInfos=_.filter(n,function(n){return n.procStatus!=="11"});f.taskInfos=f.hideSkipTaskInfos;f.expectTaskInfos=f.expectApprover}});f.showSkip=function(){f.isSkip=!f.isSkip;f.taskInfos=f.isSkip?f.allTaskInfos.concat(f.expectTaskInfos):f.hideSkipTaskInfos};f.pageOpen=function(n){t.hsitory(n.moduleId,n.appPageId,n.wfdWorkflowNodeId,n)};f.backTask=function(t){mabp.ui.setBusying(".fm-form-block",n.backToNode({taskId:f.taskId,nodeId:t.wfdWorkflowNodeId}).then(function(n){n?mabp.notify.success("回滚成功!"):mabp.notify.warn("未在测试环境，该功能不可使用!")}))};f.changeLogin=function(n){window.location.href="/Account/ChangeLoginInfo?newUserId="+n.procUserId};f.getProcer=function(n){return n.procUserName===n.procOwnerName?n.procUserName:n.procUserName+"("+L("ProxyFor")+n.procOwnerName+")"};f.getAction=function(n){switch(n){case"同意":return!0;case"提交":return!1;default:return!1}};f.sendEmail=function(n){n.mailToAll=!1;r.open(_shared.dialogs.emailDialog,{sendTo:n,currentUserInfo:u},function(){})};f.mailToAll=function(){var n={sendTos:[],mailToAll:!0};_.filter(f.taskInfos,function(t){n.sendTos.indexOf(t.procUserEmailAddress)<0&&n.sendTos.push(t.procUserEmailAddress);n.workflowName=t.workflowName;n.sn=t.sn;n.taskId=t.taskId});r.open(_shared.dialogs.emailDialog,{sendTo:n,currentUserInfo:u},function(){})}}}}]);
/**** fm-form-title.js *****/
_shared.directive("fmFormTitle",["fmTool","$filter","mabp.app.bpm","mabp.app.permission","appSession","$timeout",function(n,t,i,r,u,f){return{restrict:"E",replace:!0,template:function(n,t){return'<div class="row"><div class="col-xs-12" style="text-align:center;"><h1 class="form-large-title">{{title}}<\/h1><\/div><div class="col-xs-12" style="text-align:center;"><h2 class="form-small-title"><br ng-if="!!titleCompanyName" />{{subTitle}}<\/h2><\/div><div class="col-xs-12 control-label" style="margin-bottom: 3px; text-align: right;"><div id="div_comspan" style="float:left;display:none;"><span ng-if="selectCompany" class="required" >{{ "UsedInCompany" | translate }}<\/span><select fm-model="'+t.fmModel+'" ng-if="selectCompany" field-name="{{ \'UsedInCompany\' | translate }}" ng-model="fmModel" required ng-change="event_selectItem()" ng-options="item.areaCode as item.text for item in items" style="width: 235px; display:none; padding:0;line-height:auto; height:auto;margin: 0 0px 0 5px;margin: 0px 0px 0px 15px;border-radius: 0px;" class="form-control" ng-class="state"><option value=""><\/option><\/select><\/div><span fm-bind="$parent.base.$pageLang.ApplicationTime" style="display: -webkit-inline-box;"><\/span>：<span fm-bind="applyDate" ng-if="!date" style="display: -webkit-inline-box;"><\/span>&nbsp;&nbsp;&nbsp;<span fm-bind="$parent.base.$pageLang.Sn" style="display: -webkit-inline-box;"><\/span>：<span fm-bind="applySnNumber" ng-if="!attr.snNumber" style="display: -webkit-inline-box;"><\/span><\/div><\/div>'},scope:{fmModel:"=",subTitle:"=",title:"=",selectCompany:"=",callbackFunc:"&"},link:function(r,u,e){var o=r.$parent.base,h,s;r.selectCompany=o.areaEnable;r.applySnNumber=e.snNumber||o.$pageLang.AutomaticGenerationSystem;h=t("date")(e.applyDate,"yyyy-MM-dd");r.applyDate=h||o.$pageLang.AutomaticGenerationSystem;n.setScopeState(r,e);s=o.applicant.areaCode;!o.taskId&&!o.draftId||(s=o.areaCode);r.selectCompany&&!o.taskId?f(function(){if(r.items=o.areaCodeList,r.items.length!=1&&r.state!="readonly"&&r.state!="disabled"&&(u.find("select").css("display","inline"),u.find("#div_comspan").css("display","inline")),r.$watch("fmModel",function(n){var i,t;if(r.titleCompanyName="",i=[],n)for(t=0;t<r.items.length;t++)r.items[t].areaCode==n&&(r.titleCompanyName=r.items[t].text,i=r.items[t]);r.appendTitle();r.state=="normal"&&r.callbackFunc(i)}),r.items.length==1)o.areaCode=r.items[0].areaCode;else if(r.items.length>1){var n=_.filter(r.items,function(n){return n.areaCode===s});n!=null&&n.length===1&&(o.areaCode=s)}}):(o.taskId||(o.areaCode=s),!o.areaCode||i.getGroupExtensionByAreaCode({id:o.areaCode,displayLanguages:o.displayLanguages}).then(function(n){n&&(r.titleCompanyName=(_.find(n,{displayLanguages:$currentUser.language})||{}).name,r.appendTitle())}));r.appendTitle=function(){r.titleCompanyName?u.find("h2").html(r.titleCompanyName+"<br ng-if='!!titleCompanyName' />"+r.subTitle):u.find("h2").html(r.subTitle)};r.event_selectItem=function(){r.fmModel=u.find("option:selected").val().split(":")[1];u.focus()}}}}]);
/**** fm-group-head.js *****/
_shared.directive("fmGroupHead",["$compile",function(){return{restrict:"E",replace:!0,template:function(n,t){return'<div class="row fm-group-head "><div class="col-xs-12"><span class="fm-group-head-ltitle">{{lTitle}}<\/span>&nbsp;&nbsp;'+(!t.subTitle?"":'<span class="fm-group-head-stitle" style="color:red;">{{sTitle}}<\/span>')+'<label class="ico-open"><\/label><\/div><hr /><\/div>'},scope:{lTitle:"=",sTitle:"=",fmTitle:"=",side:"="},link:function(n,t,i){t.find("span>.fm-group-head-ltitle").html(i.title);n.$watch("fmTitle",function(n){t.find("span>.fm-group-head-ltitle").html(n)});n.lTitle=i.title;n.sTitle=i.subTitle;n.side=i.side;n.$watch("lTitle",function(t){!t||(n.lTitle=t)});n.$watch("sTitle",function(t){!t||(n.sTitle=t)});var r=$(t).parents(".dl-slide");if(!!r)$(t).on("click",function(){r.hasClass("slide-up")?(r.removeClass("slide-up"),r.find("dd").slideDown()):(r.addClass("slide-up"),r.find("dd").slideUp())})}}}]);
/**** fm-initiator.js *****/
_shared.directive("fmInitiator",["$compile","mabp.app.taskRead",function(n,t){return{restrict:"E",replace:!0,template:function(){return'<div class="row"><div class="form-group"><div class="col-xs-12"><span class="col-xs-2 control-label">{{ "PostByName" | translate }}<\/span><div class="col-xs-4"><span class="form-label">{{userinfo.userName}}<\/span><\/div><span class="col-xs-2 control-label">{{ "PostByEmployeeNumber" | translate }}<\/span><div class="col-xs-4"><span class="form-label">{{userinfo.employeeNumber}}<\/span><\/div><\/div><\/div><div class="form-group"><div class="col-xs-12"><span class="col-xs-2 control-label">{{ "PostByDepartment" | translate }}<\/span><div class="col-xs-10"><span class="form-label">{{userinfo.departmentName}}<\/span><\/div><\/div><\/div><div class="form-group" ng-if="!contactHide"><div class="col-xs-12"><span class="col-xs-2 control-label">{{ "PostByTelephone" | translate }}<\/span><div class="col-xs-4"><span class="form-label">{{userinfo.contactNumber}}<\/span><\/div><span class="col-xs-2 control-label">{{ "PostByEmail" | translate }}<\/span><div class="col-xs-4"><span class="form-label">{{userinfo.emailAddress}}<\/span><\/div><\/div><\/div><\/div>'},scope:{jobid:"=",userinfo:"=",taskid:"="},link:function(n,i,r){r.contactHide==="true"&&(n.contactHide=!0);n.userinfo||(n.taskid?t.getFormHeaderInfo({taskId:n.taskid}).then(function(t){!t||(n.userinfo={jobId:t.initiatorJobId,groupId:t.initiatorGroupId,userId:t.initiatorUserId,directManagerJobId:t.initiatorDirectManagerJobId,department:t.initiatorDepartment,userName:t.initiatorUserName,employeeNumber:t.initiatorEmployeeNumber,departmentName:t.initiatorDepartmentName,contactNumber:t.initiatorContactNumber,mobileNumber:t.initiatorMobileNumber,emailAddress:t.initiatorEmailAddress,directManagerName:t.initiatorDirectManagerName})}):t.getUserInfo({jobId:n.jobid}).then(function(t){n.userinfo={jobId:t.jobId,groupId:t.groupId,userId:t.userId,directManagerJobId:t.directManagerJobId,department:t.department,userName:t.userName,employeeNumber:t.employeeNumber,departmentName:t.departmentName,contactNumber:t.telephone,mobileNumber:t.cellPhone,emailAddress:t.emailAddress,directManagerName:t.directManagerName}}))}}}]);
