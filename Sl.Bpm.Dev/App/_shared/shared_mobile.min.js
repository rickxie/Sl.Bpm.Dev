/**** shared.js *****/
function L(n){function r(n,t){return typeof n=="string"?n.replace(/[{](\d+)[}]/g,function(n,i){return typeof t[i]!="undefined"?t[i]:n}):n}for(var i=[],t=1;t<arguments.length;t++)i.push(arguments[t]);return r(mabp.localization["Bpm."+$currentUser.language][n],i)}function CheckPermission(){}function MultiL(n){if(!mabp.localization["Bpm."+n]){mabp.localization["Bpm."+n]={};var t=n.split(",");_.forEach(t,function(t){var u,r,i;for(u in mabp.localization)if(mabp.localization.hasOwnProperty(u)){if(u.toLowerCase()!==("Bpm."+t).toLowerCase())continue;r=mabp.localization[u];for(i in r)r.hasOwnProperty(i)&&(mabp.localization["Bpm."+n][i]?mabp.localization["Bpm."+n][i].indexOf(r[i])<0&&(mabp.localization["Bpm."+n][i]=mabp.localization["Bpm."+n][i]+"<br/>"+r[i]):mabp.localization["Bpm."+n][i]=r[i])}})}return mabp.localization["Bpm."+n]}function _LT(n){function t(n,t){return n.replace(/[$](\d+)/g,function(n,i){return typeof t[i]!="undefined"?t[i]:n})}var i=(window.$currentUser||{language:"zh-CN"}).language,r=window.$CnToEnDic||{"这是一个[$1]测试":"This is a [$1] test."},u=n;return i==="en"?r[n]?u=r[n]:console.warn(t("[ $1 ]没有对应的翻译模板",[0,n])):i!=="zh-CN"&&console.warn(t("不支持语言:$1",[0,i])),t(u,arguments)}var debugCode=!0,_shared={};(function(){function t(n){var t=n.target,i;t&&t.classList.value&&t.classList.value.includes("fm-text-shadetext")?(i=$(t).parent(".readonly").width()||$(t).parent(".disabled").width(),i&&t.textContent&&t.textContent.length*14>=i?(console.log("弹窗文本",t.textContent),t.classList.add("toastElipsisText"),$(".popover").remove(),$(t).popover({placement:"top",content:t.textContent,tipClass:"primary",delay:200,trigger:"manual"}).popover("show")):($(".popover").remove(),console.log("未满足弹窗条件"),console.dir(i),console.log(t.textContent.length*14))):$(".popover").remove()}function n(){$(".tempResizeDiv").height(0).fadeOut()}function i(n){var i,t,e;if("textarea,input".includes(n.target.nodeName.toLowerCase())&&navigator.platform!="iPhone"){if(document.querySelector(".tempResizeDiv")||(t=document.createElement("div"),t.style.height="270px",t.style.display="none",t.style.width=window.innerWidth,t.classList.add("tempResizeDiv"),document.querySelector("body").appendChild(t)),n.target.type&&!"text,textarea".includes(n.target.type.toLowerCase()))return;var r=window.innerHeight,u=270,o=$(n.target),l=o.parent(),s=n.target.getBoundingClientRect(),h=s.top,c=n.target.clientHeight,f=h+c;f>r/2&&(i=Math.abs(f-r/2),i=Math.min(r/2,i),i=Math.floor(i),t=$(".tempResizeDiv"),t.height(i>u?i:u),t.fadeIn("fast",function(){window.scrollBy(0,i)}))}(n.target.classList.contains("disabled")||n.target.classList.contains("readonly"))&&(e=$("textarea",n.target),e.parents(".fm-textarea").height(n.target.firstChild.scrollHeight))}function r(n){var t,r;if(i(n),t=n.target,r=["button","button-clear","ripple"],t.className.length&&t.className.split(" ").filter(n=>!n||n.length).some(function(n){return r.indexOf(n)!=-1})){t.className.includes("ripple")||t.classList.add("ripple");var u=t.getBoundingClientRect(),f=u.left,e=u.top,o='<div class="ripple-effect"style = "'+("height:"+t.clientHeight+"px;")+("width:"+t.clientHeight+"px;")+("left:"+(n.clientX-f-t.clientHeight/2)+"px;")+("top:"+(n.clientY-e-t.clientHeight/2)+"px;")+'"><\/div>';t.insertAdjacentHTML("beforeend",o);window.setTimeout(function(){$(".ripple-effect").remove()},1e3)}}function u(n,t){for(var f,e,u=$("table tr"),r=1,i=u.length;i>0;i--)!t[i]||(t[i].end=i),f=$($(u[i]).find("td")[n]).text(),e=$($(u[i-1]).find("td")[n]).text(),f===e?r++:(r>1?!t[i+r-2]||(t[i+r-2].start=i-1,t[i+r-2].rows=r):!t[i]||(t[i].start=i-1,t[i].rows=1),r=1)}function f(n,t){var i,u,e,f,o,s,r;for(t.sort(function(n,t){return t-n}),i=n.length;i>=0;i--)if(!!n[i]&&(!!n[i].start||n[i].start===0)&&!!n[i].end&&!n[i].yet&&n[i].rows>1)for(u=n[i].start,e=n[i].end,f=0;f<t.length;f++){for(o=t[f],s=$("table tr"),r=e+1;r>u+1;r--)n[r-1].yet=!0,$($(s[r]).find("td")[o]).remove();$($(s[u+1]).find("td")[o]).attr("rowspan",e-u+1)}}_shared=angular.module("app.shared",["mabp","angularFileUpload","angular-timeline","mabp.orgChart"]);_shared.debugCode=!0;_shared.dialogs={};_shared.factory("appSession",["mabp.app.system","mabp.app.permission",function(){var i=$(window).height(),t;return $(window).resize(function(){var t=$(this).height();i-t>140||n()}),t={userId:null,nickName:null,userName:null,language:null,emailAddress:null,permissions:window.$currentUserPermissions,endLoad:function(){}},window.$currentUser!=null&&(t.userName=window.$currentUser.name,t.userId=window.$currentUser.id,t.nickName=window.$currentUser.nickName,t.language=window.$currentUser.language,t.isSuperAdmin=window.$currentUser.isSuperAdmin,t.telephone=window.$currentUser.telephone,t.emailAddress=window.$currentUser.emailAddress,app.language=t.language=window.$currentUser.language,app.enterpriseName=t.enterpriseName=window.$currentUser.enterpriseName),t}]);window.addEventListener("onscroll",function(){var n=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop;console.log(n)},{passive:!0,capture:!0});window.addEventListener("mousewheel",function(){},{passive:!0,capture:!0});window.addEventListener("touchstart",function(){},{passive:!0,capture:!1});window.addEventListener("click",r,{passive:!0,capture:!0});window.addEventListener("click",t,{passive:!0,capture:!1});window.addEventListener("blur",n,{passive:!0,capture:!0});_shared.config(["w5cValidatorProvider",function(n){n.config({blurTrig:!0,showError:function(n,t){$(n).maTips({type:"error",content:t[0],isalways:!0})},removeError:function(n){$(n).maTips_close()}});n.setDefaultRules({required:"该选项不能为空",maxlength:"该选项输入值长度不能大于{maxlength}",minlength:"该选项输入值长度不能小于{minlength}",email:"输入邮件的格式不正确",repeat:"两次输入不一致",pattern:"该选项输入格式不正确",number:"必须输入数字",w5cuniquecheck:"该输入值已经存在，请重新输入",url:"输入URL格式不正确",max:"该选项输入值不能大于{max}",min:"该选项输入值不能小于{min}",customizer:"自定义验证不通过"});n.setRules({nickname:{pattern:"必须输入字母、数字、下划线,以字母开头"},password:{required:"密码不能为空",minlength:"密码长度不能小于{minlength}",pattern:"密码必须且只能包含字母和数字,长度不能小于6位"}})}]);_shared.initialPage=function(n,t,i,r,u){var f={currentPage:t||1,pageSize:i||8,orderByProperty:r||"Id",Ascending:u||!1,totalPage:1,pushFilter:function(n){this.filters||(this.filters=[]);var t=_.find(this.filters,{name:n.name});t?t.value=n.value:this.filters.push({name:n.name,value:n.value})}};return n.paging!=null&&(f=angular.extend({},n.paging,f)),n.paging=f,f};_shared.directive("maNodeSelect",["mabp.app.system","$stateParams","dialog",function(){return{restrict:"E",replace:!0,template:function(n,t){return'<div class="input-group ma-node-select"><span class="input-group-addon">'+t.title+'<\/span><div class="input-group-btn fix-border"><button type="button" class="btn btn-default dropdown-toggle {{disabled?\'\':\'dropdown-disabled\'}}" data-toggle="{{disabled?\'dropdown\':\'\'}}" tabindex="-1"><span style="vertical-align:middle;margin-right:10px;line-height:14px;">{{typeText||"请选择"}}<\/span><\/button><ul class="dropdown-menu pull-right" role="menu"><li ng-repeat="item in items" ng-mousedown="itemClick(item)"><a>{{item.text}}<\/a><\/li><\/ul><\/div><input type="hidden" ng-model="value" /><input ng-disabled="!disabled" ng-readonly="readonly" type="text" class="form-control" ng-model="valuetext" placeholder="{{placeholder}}"><\/div>'},scope:{type:"=",value:"=",valuetext:"=",items:"=",readonly:"=",placeholder:"="},link:function(n){n.readonly=!0;n.disabled=!0;n.$watch("valuetext",function(){n.readonly||(n.value=n.valuetext)});n.$watch("items",function(){if(!!n.items&&n.items.length>0){n.disabled=!0;for(var t=0;t<n.items.length;t++)if(n.type==n.items[t].value){n.typeText=n.items[t].text;break}}else n.disabled=!1},!0);n.$watch("type",function(t){if(!!n.items&&n.items.length>0&&t!=null)for(var i=0;i<n.items.length;i++)if(t==n.items[i].value){n.typeText=n.items[i].text;break}t==null&&(n.typeText="")});n.text="";n.itemClick=function(t){n.type!=t.value&&(n.readonly=!0,n.placeholder="",n.value=null,n.valuetext="");n.type=t.value;n.typeText=t.text;t.fun(n)}}}}]);_shared.directive("maTree",function(){return{restrict:"EA",transclude:!0,template:"<div><\/div>",scope:{ngModel:"=",selectedId:"="},link:function(n,t,i){n.$watch("ngModel",function(){var r=n.ngModel,u;if(r!=null&&r.id!=null){u=i.icon;$(t).jstree({plugins:["types"],core:{themes:{responsive:!1},data:r},types:{"default":{icon:u},file:{icon:u}}});$(t).on("select_node.jstree",function(i,r){$(t).parent().parent().find(".jstree-clicked").removeClass("jstree-clicked");$(t).parent().parent().find("#"+r.selected[0]+">a").addClass("jstree-clicked");n.selectedId=r.selected[0];n.$apply()})}},!0)}}});_shared.filter("processortype",function(){return function(n){switch(n+""){case"0":return"发起人";case"1":return"业务相关人";case"2":return"岗位";case"3":return"角色";case"4":return"部门";case"5":return"与某一步处理人相同";case"6":return"岗位代码按人过滤";case"7":return"岗位级别按人过滤";case"8":return"角色按部门过滤";case"9":return"部门领导";case"10":return"直属主管";case"11":return"前置步骤的直属主管";case"12":return"前置步骤的部门领导";case"13":return"某组织某岗位级别的人员";case"14":return"指定步骤的直属主管";case"15":return"指定步骤的部门领导";case"16":return"从某岗位级别到某岗位级别";case"17":return"岗位代码按部门过滤";case"18":return"岗位级别按部门过滤";case"19":return"申请人";case"20":return"下一步处理人";case"21":return"当前处理人";default:return""}}});_shared.filter("processordatatype",function(){return function(n){switch(n+""){case"0":return"数据源";case"1":return"数据字段";case"2":return"变量";default:return""}}});_shared.filter("enumfilter",function(){return function(n,t){var r=enums.get(t),i=_.find(r,{id:n});return i?i.text:""}});_shared.filter("procstatus",function(){return function(n){switch(n+""){case"1":return L("TaskFinishStatus");case"7":return L("Refused");default:return n}}});_shared.buildDialog=function(){return{define:function(n,t){if(this[n]==null){var i="shared.dialogs.{0}".fill(n);return this[n]={templateUrl:_turl(t),controller:i},i}return console.error("{0} duplicate defined.".fill(n)),"errorCtrl"}}};_shared.dialogs=_shared.buildDialog();_shared.mergeTable=function(n,t,i){u(n,t);f(t,i)};_shared.filter("trustHtml",function(n){return function(t){return n.trustAsHtml(t)}});_shared.directive("fmBind",function(){return{restrict:"A",scope:{fmBind:"="},link:function(n,t){t.html(n.fmBind)}}});_shared.escape2Html=function(n){var t={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};return n.replace(/&(lt|gt|nbsp|amp|quot);/ig,function(n,i){return t[i]})};_shared.directive("ngEnter",function(){return function(n,t,i){t.bind("keydown keypress",function(t){t.which===13&&(n.$apply(function(){n.$eval(i.ngEnter)}),t.preventDefault())})}})})();_turl=function(n){return n+"?"+ +new Date};
/**** ma-sidebar.js *****/
_shared.directive("maSiderbar",["$rootScope","$compile",function(n,t){return{restrict:"E",scope:{ngModel:"=",activeMenu:"="},replace:!0,template:'<nav class="menu" data-toggle="menu" style="width: 200px"><span class="toggler" ma-toggler="{{target}}"><\/span><\/nav>',link:function(n,i,r){function e(n){var i,o,s,r,t,y,p;if(n instanceof Array){for(i=0;i<u.length;i++)u[i].isDispaly&&(f+=e(u[i]));return f}if(o="",n.children!=null)for(s=n.children,r=0;r<s.length;r++)s[r].isDispaly&&(o+=e(s[r]));return t=n.defaultState||n.menu||"",t!==""&&(t=a.fill(t)),y=o===""?"":v.fill(o),p="",h&&y!==""?l.fill(n.icon,t,L(n.displayName),y):c.fill(n.icon,t,L(n.displayName),y,n.menu)}var o,s;n.target=r.target;var h=r.expend==="true",c='<li ng-class="{ active : activeMenu.name == \'{4}\' }" ><a {1}><i class="{0}"><\/i>{2}<\/a>{3}<\/li>',l='<li class="show" ><a {1}><i class="{0}"><\/i>{2}<\/a>{3}<\/li>',a='ui-sref="{0}"',v='<ul class="nav">{0}<\/ul>',u=n.ngModel,f="";e(u);o='<ul class="nav nav-primary">{0}<\/ul>'.fill(f);s=t(o)(n);i.append(s);$(i).menu(i,{auto:!0})}}}]);
/**** sys-enums.js *****/
var enums={get:function(n){var t=[],i=$.extend(!0,{},this[n]);return _.forEach(i,function(n){t.push({id:n.id,text:L(n.text)||n.text})}),t},mainIcons:[{icon:"icon-stack",color:"#FB9678"},{icon:"icon-usecase",color:"#01C0C8"},{icon:"icon-hdd",color:"#AB8CE4"},{icon:"icon-newspaper-o",color:"#00C292"},{icon:"icon-folder-close-alt",color:"#03A9F3"},{icon:"icon-newspaper-o",color:"#FEC107"}],tableColumnType:[{text:"Int",id:1},{text:"Nvarchar",id:2},{text:"Real",id:3},{text:"Bit",id:4},{text:"Decimal",id:5},{text:"DateTime",id:6}],actionButtons:{event_Waiting:{type:"event_Waiting",nodeRestrict:0,style:"btn-primary",isEnable:!1,displayText:"挂起"},event_FormWaiting:{type:"event_Waiting",nodeRestrict:1,style:"btn-primary",isEnable:!1,displayText:"挂起"},event_Submit:{type:"event_Submit",nodeRestrict:0,style:"btn-primary",isEnable:!1,displayText:"提交"},event_SaveToDraft:{type:"event_SaveToDraft",nodeRestrict:0,style:"btn-success",isEnable:!1,displayText:"保存草稿"},event_SaveToDraftOne:{type:"event_SaveToDraft",nodeRestrict:1,style:"btn-success",isEnable:!1,displayText:"保存草稿"},event_SaveForm:{type:"event_SaveForm",nodeRestrict:1,style:"btn-success",isEnable:!1,displayText:"保存"},event_SaveToTemplate:{type:"event_SaveToTemplate",nodeRestrict:0,style:"btn-default",isEnable:!1,displayText:"保存模板"},event_Delete:{type:"event_Delete",nodeRestrict:0,style:"btn-danger",isEnable:!1,displayText:"删除"},event_Agree:{type:"event_Agree",nodeRestrict:1,style:"btn-primary",isEnable:!1,displayText:"同意"},event_Reject:{type:"event_Reject",nodeRestrict:1,style:"btn-danger",isEnable:!1,displayText:"拒绝"},event_TurnOverStart:{type:"event_TurnOver",nodeRestrict:0,style:"btn-default",isEnable:!1,displayText:"转发"},event_TurnOver:{type:"event_TurnOver",nodeRestrict:1,style:"btn-default",isEnable:!1,displayText:"转发"},event_Copy:{type:"event_Copy",nodeRestrict:1,style:"btn-default",isEnable:!1,displayText:"抄送"},event_AdditionalSigner:{type:"event_AdditionalSigner",nodeRestrict:1,style:"btn-default",isEnable:!1,displayText:"加签"},event_RecedeToProposer:{type:"event_RecedeToProposer",nodeRestrict:1,style:"btn-primary",isEnable:!1,displayText:"退回发起人"},event_RecedeToPreviousStep:{type:"event_RecedeToPreviousStep",nodeRestrict:1,style:"btn-primary",isEnable:!1,displayText:"退回上一步"},event_RecedeToAnyStep:{type:"event_RecedeToAnyStep",nodeRestrict:1,style:"btn-primary",isEnable:!1,displayText:"退回任意节点"},event_RecedeToSepcificStep:{type:"event_RecedeToSepcificStep",nodeRestrict:1,style:"btn-primary",isEnable:!1,displayText:"退回指定节点"},event_AutoHandle:{type:"event_AutoHandle",nodeRestrict:2,style:"btn-primary",isEnable:!1,displayText:"自动处理完成"},event_And:{type:"event_And",nodeRestrict:3,style:"btn-primary",isEnable:!1,displayText:"与节点处理完成"},event_Connect:{type:"event_Connect",nodeRestrict:4,style:"btn-primary",isEnable:!1,displayText:"连接节点处理完成"},event_Judge:{type:"event_Judge",nodeRestrict:5,style:"btn-primary",isEnable:!1,displayText:"判断节点处理完成"},event_Finish:{type:"event_Finish",nodeRestrict:6,style:"btn-primary",isEnable:!1,displayText:"流程结束"},event_FinishPrint:{type:"event_Print",nodeRestrict:6,style:"btn-primary",isEnable:!1,displayText:"打印"},event_Print:{type:"event_Print",nodeRestrict:1,style:"btn-primary",isEnable:!1,displayText:"打印"}},informType:{email:{text:"邮件",id:1},sms:{text:"短信",id:2}},noticeType:{Handle:{text:"处理",id:1},notice:{text:"通知",id:2}},moduleType:[{text:"BasicData",id:1,count:0},{text:"Report",id:2,count:0},{text:"Workflow",id:3,count:0},{text:"Undefined",id:0,count:0}],formDesignType:[{id:1,text:"BasicData"},{id:2,text:"Report"},{id:3,text:"Workflow"}],businessTableType:[{id:2,text:"BusinessDatatable"},{id:3,text:"BasicDatatable"},{id:1,text:"SysDatatable"}],modulePageStatus:[{id:1,text:"Launch"},{id:2,text:"Approval"},{id:3,text:"Check"}],controlStatus:[{id:"normal",text:"Editable"},{id:"disabled",text:"Disabled"},{id:"readonly",text:"Readonly"},{id:"hidden",text:"Hidden"}],interfaceConfigProcessType:[{text:"TotalQuantity",id:1},{text:"Increment",id:2}],interfaceConfigLoopType:[{text:"FixedTimePerDay",id:1},{text:"FixedTimeInterval",id:2},{text:"FixedTimeOfWorkingDay",id:3},{text:"FixedTimeIntervalOfWorkingDay",id:4}],moduleRightType:[{text:"All",id:1},{text:"Group",id:2},{text:"Job",id:3},{text:"Role",id:4},{text:"JobLevel>=",id:5},{text:"JobLevel<=",id:6}],globalModuleOpenType:[{id:"1",text:"Embedded"},{id:"2",text:"NewWindow"}],moduleOpenType:[{id:0,text:"Inherit"},{id:1,text:"Embedded"},{id:2,text:"NewWindow"}],moduleRightControl:[{text:"Allow",id:1},{text:"Disabled",id:2}],taskStatus:[{id:"",text:"全部"},{id:"0",text:"等待审批"},{id:"1",text:"审批完成"},{id:"7",text:"已拒绝"},{id:"9",text:"已取消"}],taskStatus2:[{id:"",text:"全部"},{id:0,text:"等待审批"},{id:0,text:"审批完成"},{id:7,text:"已拒绝"},{id:9,text:"已取消"}],fileStatus:[{id:0,text:"制作中"},{id:1,text:"制作完成请下载"}],procStatus:[{id:"",text:""},{id:"1",text:"TaskFinishStatus"},{id:"0",text:"Approving"},{id:"7",text:"Refused"}],purchaseStatus:[{id:"",text:"全部"},{id:"2",text:"已订购"},{id:"0",text:"待处理"},{id:"1",text:"已处理"},{id:"7",text:"已拒绝"}],cashierWorkflow:[{id:"",text:"全部"},{id:"9ef84c0d-5c5b-40d9-9044-887b3f6e3687",text:"出差报销流程"},{id:"eb7995e7-7fed-4fa8-bf20-fb711988f9e4",text:"业务招待报销流程"},{id:"30250859-e917-4776-bcce-ee4b5abedb9f",text:"礼品报销流程"},{id:"ff09cfc1-6206-453c-b69f-1ba4a83eb264",text:"其他费用报销申请流程"}],sourceType:[{id:"",text:""},{id:"1",text:"BasicData"},{id:"2",text:"DataView"}],cashierStatus:[{id:"",text:"全部"},{id:"0",text:"待审批"},{id:"1",text:"已审批"}],popcStatus:[{id:"",text:"全部"},{id:"1",text:"未做合同"},{id:"2",text:"已做合同"}],expenseType:[{id:"",text:""},{id:"1",text:"住宿费"},{id:"2",text:"伙食费"},{id:"3",text:"其他杂费"},{id:"4",text:"手续费/保险费"},{id:"5",text:"出租车/市内交通费"},{id:"6",text:"车船费"}],viewType:[{id:1,text:"系统视图"},{id:2,text:"数据源视图"},{id:3,text:"报表视图"},{id:4,text:"匹配视图"}]};
/**** action.edit.js *****/
(function(){var n=_shared.dialogs.define("actionEditDialog","/App/_shared_mobile/component/action/action.edit.html");angular.module("app.shared").controller(n,["$scope","dialog","mabp.app.workflow","$stateParams","params",function(n,t,i,r,u){var f=this,e;f.node=u.data;f.model={isEnable:!0,displayOrder:0,actionLinkId:f.node.actionLinkId};!u.model||(f.model=u.model,e=!f.model.variableValue?"".split("="):f.model.variableValue.split("="),f.variableName=e[0],f.variableValue=e[1]);f.actorList=_.filter(enums.actionButtons,function(n){return n.nodeRestrict==f.node.type});i.getOtherStepNodes({id:f.node.id,selectedId:f.node.wfdWorkflowId}).then(function(n){f.model.workflowNodes=n});f.save=function(){f.model.type!="event_RecedeToSepcificStep"&&(f.model.returnToNodes="");f.model.variableValue=!f.variableValue?"":(f.variableName||"")+"="+f.variableValue;i.editNodeAction(f.model).then(function(){n.$close()})};f.cancel=function(){n.$close()};f.selectVariable=function(){t.open(_shared.dialogs.variableEdit,f.variableName).then(function(n){!n||(f.variableName="<%"+n+"%>")})}}])})();
/**** businesstablecolumn.dialog.js *****/
(function(){var n=_shared.dialogs.define("businessTableColumn","/App/_shared_mobile/component/businesstablecolumn/businesstablecolumn.dialog.html");angular.module("app.shared").controller(n,["params","$scope","mabp.app.table",function(n,t,i){var r=this;r.wfBusinessTable=[];r.data=t||{};r.model=[];r.beforeShow=function(){i.getWfBusinessTableAndColumns(n.workflowId).then(function(n){for(var i,u=",",t=0;t<n.length;t++)u.indexOf(n[t].id)==-1&&(u+=n[t].id+",",r.wfBusinessTable.push(n[t]),r.wfBusinessTable[r.wfBusinessTable.length-1].Columns=[]);for(t=0;t<n.length;t++)for(i=0;i<r.wfBusinessTable.length;i++)n[t].id==r.wfBusinessTable[i].id&&r.wfBusinessTable[i].Columns.push(n[t]);(n==null||n.length===0)&&mabp.notify.info("还没有数据表")})};r.afterShow=function(){};r.save=function(n){r.afterShow();t.$close(n)};r.cancel=function(){t.$close()};r.beforeShow()}])})();
/**** data.import.js *****/
(function(){var n=_shared.dialogs.define("dataImport","/App/_shared_mobile/component/data/data.import.html");angular.module("app.shared").controller(n,["params","$scope","FileUploader","mabp.app.file",function(n,t,i,r){var u=this,f;u.data={};u.baseData={};f=n.base;u.config={};u.config.base={type:f.type||2,name:f.name,beginRow:f.beginRow||1,allowRowHeader:f.allowRowHeader===!1?!1:!0,allowDuplication:f.allowDuplication||!1,displayAttachment:f.displayAttachment||!1,template:"/AppPages/File/Template/"+f.template,allowPaged:f.allowPaged===!1?!1:!0,pageSize:f.pageSize||10,validateAll:f.validateAll===!1?!1:!0,buttonName:f.buttonName,templateType:f.templateType,validateFunc:function(n,t){f.validateFunc&&f.validateFunc(n,t)},width:{width:!f.width?"100%":f.width}};u.config.columns=n.columns;u.paging=_shared.initialPage(u,1,u.config.base.pageSize,"Id",!1);u.paging.totalCount=1;u.load=function(){r.checkBaseConfig({ConfigBase:u.config.base,ConfigColumns:u.config.columns}).then(function(n){if(!!n){u.config.columns=n.configColumns;var t=_.find(u.config.columns,function(n){return n.validate.checked===!1});!t||(u.validateArrs=_.filter(u.config.columns,function(n){return!n.validate.message==!1}),u.validateMsg=_.map(u.validateArrs,function(n){if(n.validate.message)return n.columnName+"列对应的字段名"+n.columnSource+"出错："+n.validate.message}))}})};u.load();u.uploadBefore=function(){angular.element("#fileinput").click()};u.validate=function(){u.baseChecked&&r.checkColumnConfig({ConfigBase:u.config.base,ConfigColumns:u.config.columns,Data:u.baseData,FileModel:u.data.fileModel}).then(function(n){var i,t;if(!!n){for(u.data=n,u.validateFunc(),i=0;i<u.data.data.length;i++)t=u.data.data[i],t._ValidateError=JSON.parse(t._ValidateError),t._ValidateWarning=JSON.parse(t._ValidateWarning),t._ValidateError.Message=u.data.dataReturn[i]._ValidateError,t._ValidateWarning.Message=u.data.dataReturn[i]._ValidateWarning;u.paging.currentPage=1;u.isValid=u.config.base.validateAll?_.every(u.data.data,function(n){return!n._ValidateError.Message==!0}):!0;u.pageData()}})};u.validateFunc=function(){u.config.base.validateFunc(u.data.dataReturn,u.data.data)};u.pre=function(n){r.prepareAdvanceImportData({ConfigBase:u.config.base,ConfigColumns:u.config.columns,FilePath:n.FilePath,FileModel:n.FileModel}).then(function(n){!n||(u.baseData=n.data,u.data=n,u.paging.currentPage=1,u.isValid=!1,u.baseChecked=!0,u.pageData(),u.validate())})};u.pageData=function(){var n,t;if(u.config.base.allowPaged){n=u.data.data;u.paging.totalCount=n.length;var r=[],f=(u.paging.currentPage-1)*u.paging.pageSize,i=u.paging.currentPage*u.paging.pageSize;for(i>n.length&&(i=n.length),t=f;t<i;t++)r.push(n[t]);u.currentData=r}else u.currentData=u.baseData};u.save=function(){t.$close(u.data)};u.uploader=new i({url:"/File/AdvanceFileUpload"});u.uploader.filters.push({name:"customFilter",fn:function(n){return n.name.indexOf(".xls")>0||n.name.indexOf(".xlsx")>0?!0:(mabp.notify.warn("不支持的文件类型，请上传xls或者xlsx文件。"),!1)}});u.uploader.onAfterAddingFile=function(){u.uploader.getNotUploadedItems().length&&u.uploader.uploadAll()};u.uploader.onSuccessItem=function(n,t){u.uploader.clearQueue();var i=t.IsSuccess;i&&u.pre(t)};u.uploader.onErrorItem=function(){u.uploader.queue[u.uploader.queue.length-1].remove();console.log("Excel导入失败");mabp.notify.warn("Excel导入失败")}}])})();
/**** data.select.js *****/
(function(){var n=_shared.dialogs.define("dataSelect","/App/_shared_mobile/component/data/data.select.html");angular.module("app.shared").controller(n,["params","$scope","dialog",function(n,t){var i=this,e,o,s,r,u,f;if(i.params=n,i.model={},i.pageSizeList=[10,20,50,100],i.data=n.data,i.ismulti=n.ismulti!="false"&&n.ismulti?!0:!1,i.table=[],i.column=[],i.columnText=[],i.row=[],i.showPages=[],i.currentPageIndex=0,i.currentPageData=[],i.pageNum=0,i.pageSize=10,n.data){e=eval("("+n.column+")");for(o in e)i.column.push(o),i.columnText.push(e[o])}else for(s in i.data[0])i.column.push(s),i.columnText.push(s);for(r=0;r<i.data.length;r++){for(u={},f=0;f<i.column.length;f++)u[i.column[f]]=i.data[r][i.column[f]];i.data[r].id?u.id=i.data[r].id:(u.id=r+1,i.data[r].id=r+1);u.isCheck=i.data[r].isCheck;i.table.push(u)}i.save=function(){for(var r=[],n=0;n<i.table.length;n++)i.table[n].isCheck&&r.push(i.table[n].id);for(n=0;n<i.data.length;n++)i.data[n].isCheck=r.indexOf(i.data[n].id)==-1?!1:!0,i.data[n].isInit=!0;t.$close(i.data)};i.cancel=function(){t.$close(null)};i.trCheck=function(n){if(i.ismulti)n.isCheck=!n.isCheck;else{for(var t=0;t<i.table.length;t++)if(i.table[t].isCheck){i.table[t].isCheck=!1;break}n.isCheck=!0}};t.$watch("vm.table",function(){i.pageNum=parseInt(i.table.length/i.pageSize);(i.table.length%i.pageSize!=0&&i.table.length>i.pageSize||i.pageNum==0)&&i.pageNum++});t.$watch("vm.pageNum",function(){var n;for(i.showPages=[],n=0;n<=i.pageNum-1;n++)n>=i.currentPageIndex-2&&n<=i.currentPageIndex+2&&i.showPages.push({index:n});var r=[],u=i.currentPageIndex*i.pageSize,t=i.currentPageIndex*i.pageSize+i.pageSize;for(t>i.table.length&&(t=i.table.length),n=u;n<t;n++)r.push(i.table[n]);i.currentPageData=r;i.currentPageIndex=0});t.$watch("vm.pageSize",function(){var n;for(i.pageNum=parseInt(i.table.length/i.pageSize),(i.table.length%i.pageSize!=0&&i.table.length>i.pageSize||i.pageNum==0)&&i.pageNum++,i.showPages=[],n=0;n<=i.pageNum-1;n++)n>=i.currentPageIndex-2&&n<=i.currentPageIndex+2&&i.showPages.push({index:n});var r=[],u=i.currentPageIndex*i.pageSize,t=i.currentPageIndex*i.pageSize+i.pageSize;for(t>i.table.length&&(t=i.table.length),n=u;n<t;n++)r.push(i.table[n]);i.currentPageData=r});t.$watch("vm.currentPageIndex",function(){var n;for(i.showPages=[],n=0;n<=i.pageNum-1;n++)n>=i.currentPageIndex-2&&n<=i.currentPageIndex+2&&i.showPages.push({index:n});var r=[],u=i.currentPageIndex*i.pageSize,t=i.currentPageIndex*i.pageSize+i.pageSize;for(t>i.table.length&&(t=i.table.length),n=u;n<t;n++)r.push(i.table[n]);i.currentPageData=r});i.changePage=function(n){i.currentPageIndex=n};i.currentPageIndex=0}])})();
/**** form.select.js *****/
(function(){var n=_shared.dialogs.define("formSelect","/App/_shared_mobile/component/data/form.select.html");angular.module("app.shared").controller(n,["fmTool","params","$scope","dialog","mabp.app.module","$timeout","formHelper","$q",function(n,t,i,r,u,f,e,o){var s=this,c,h;s.isShowMobileTitle=function(n){console.log("isShowMobileTitle",n);e.postMessage.call(parent,"isShowMobileTitle",n)};s.backAction=function(n){console.log(n.data);switch(n.data.message){case"mobileHardwareBackBtnClick":s.save().then(function(){window.removeEventListener("message",s.backAction)})}};window.addEventListener("message",s.backAction);s.isShowMobileTitle(!1);s.tableGuid=_$.getGUID();s.formGuid=_$.getGUID();s.params=t;s.size=t.size;s.model={};s.selectedData=[];s.valueMember=t.valueMember;s.fmModel=t.selectData||"";s.pageSizeList=[10,20,50,100];s.paging=_shared.initialPage(s,1,10,"",!1);s.paging.orderByProperty="";s.hasSearch=!1;s.ismulti=t.ismulti!="false"&&t.ismulti?!0:!1;s.data=[];s.pagedData=[];s.loaded=!1;s.selectId="";c=function(n,t){var o=new mcGrid,a={checkable:s.ismulti,sortable:!1,isSingleRowSelected:!s.ismulti,isCheckedByRow:!0,orderBy:s.paging.orderByProperty,ascending:s.paging.ascending},f,r,e,h,c,l;if(!!s.fmModel){for(f=s.fmModel.split(","),r=0;r<f.length;r++)e=_.find(t,{id:f[r]}),e?(e.$$checked=!0,h=_.findIndex(s.selectedData,{id:f[r]})>-1,h?(_.remove(s.selectedData,{id:f[r]}),s.selectedData.push(e)):s.selectedData.push(e)):(c=_.findIndex(s.selectedData,{id:f[r]})>-1,c||(s.selectId+=f[r]+","));!s.selectId||u.getChooseTable({code:s.params.datacode,filters:mabp.toArray(s.params.filter),allColumnFilter:!0,tableFilters:mabp.toArray(s.tableFilters),pageInput:s.paging,multiId:s.selectId}).then(function(n){_.forEach(n.viewTable,function(n){_.findIndex(s.selectedData,{id:n.id})==-1&&s.selectedData.push(n)})})}o.InitGrid(s.tableGuid,a,n,t);l=/^\d{4}-\d{2}-\d{2}[T]([01]?\d|2[0-3]):[0-5]?\d:[0-5]?\d.\d?\d?\d?$/;o.on("TdInitialize",function(n){n.dom.addClass(n.col.name);n.dom.id=n.row.id;l.test(n.dom.innerHTML)&&(n.dom.innerHTML=moment(n.dom.innerHTML).format("YYYY-MM-DD"))});o.on("RowChecked",function(n,t){s.ismulti&&!!n?(t instanceof Array?_.forEach(t,function(n){n.$$checked==!1&&_.remove(s.selectedData,{id:n.id})}):t.$$checked==!1&&_.remove(s.selectedData,{id:t.id}),_.forEach(n,function(n){var t=_.findIndex(s.selectedData,{id:n.id})>-1;t||s.selectedData.push(n)})):s.selectedData=n;var r=_.map(s.selectedData,"id");s.fmModel=r!=null&&r.join(",");i.$apply()})};h=function(n,t,i){var r=_.filter(n,function(n){return t(n)});s.paging.totalPage=Math.ceil(r.length/s.paging.pageSize);s.paging.totalCount=r.length;s.pagedData=_$.pagingTake(r,s.paging.currentPage,s.paging.pageSize);c(i,s.pagedData)};s.load=function(n){var o,r,i,e;if(t.data){if(t.datatype==="source"){i=[];for(e in t.column)i.push({name:e,text:t.column[e]});s.loaded?h(s.data,function(n){var r=s.selectTxt||"",i=!1;for(var u in t.column)n[u].indexOf(r)>-1&&(i=!0);return i},i):(s.data=t.data,s.title=s.params.title,_.forEach(s.data,function(n){n.id||(n.id=_$.getGUID())}),h(s.data,function(n){var r=s.selectTxt||"",i=!1;for(var u in t.column)n[u].indexOf(r)>-1&&(i=!0);return i},i),s.loaded=!0)}}else t.datatype==="view"?(n!=undefined?s.collectCondition():s.tableFilters=t.defaultfilter,o=mabp.toArray(s.params.filter),s.hasSearch||(s.paging.filters=[{name:"filterText",value:s.selectTxt},{name:"viewTable",value:t.datacode}]),mabp.ui.setLoading("#"+s.formGuid,u.getViewTable({code:s.params.datacode,filters:o,allColumnFilter:!0,tableFilters:mabp.toArray(s.tableFilters),pageInput:s.paging}).then(function(t){var r=_.map(t.displayColumList,function(n){return{name:n.displayColumn.lowerFirst(),text:n.name,visible:n.isDisplayEnable}}),i;s.data=t.viewTable;n||(s.displayColumList=t.displayColumList,i=mabp.toArray(s.tableFilters),_.forEach(t.displayColumListAll,function(n){_.forEach(i,function(t){n.value=n.displayColumn==t.name?t.value:""})}),s.displayColumListAll=t.displayColumListAll);s.title=t.viewName;c(r,s.data);s.hasSearch=_.some(t.displayColumListAll,{isWhereEnable:!0});f(function(){s.paging.totalPage=Math.ceil(t.totalCount/s.paging.pageSize);s.paging.totalCount=t.totalCount})}))):t.datatype==="service"&&(s.collectCondition(),r=[{name:"groupJobName",text:"岗位",visible:!0},{name:"name",text:"人员",visible:!0}],s.loaded?h(s.data,function(n){var t=s.selectTxt||"";return n.name.indexOf(t)>-1||n.groupJobName.indexOf(t)>-1},r):mabp.ui.setLoading("#"+s.formGuid,u.getMySubbmitterAgent(s.params).then(function(n){s.title="选择申请人";s.valueMember="id";_.forEach(n,function(n){n.id||(n.id=_$.getGUID())});s.data=n;h(s.data,function(n){var t=s.selectTxt||"";return n.name.indexOf(t)>-1||n.groupJobName.indexOf(t)>-1},r);s.loaded=!0})))};f(function(){s.load()});s.changePage=function(n){return s.paging.currentPage=n,document.getElementById("txt_changePage").value=n,s.load(!0),!1};s.changePages=function(){return s.paging.currentPage=Number(document.getElementById("txt_changePage").value),s.load(!0),!1};s.event_Keyup=function(n){document.getElementById("txt_changePage").value=s.NumberOnly(document.getElementById("txt_changePage"));n.keyCode==13&&s.changePages()};s.NumberOnly=function(n){var t=n.value.replace(/,/g,"");return""!=t.replace(/\d/g,"")&&(t=t.replace(/\D/g,"")),t};i.$watch("vm.paging.pageSize",function(n,t){s.paging.currentPage=1;s.loaded=!1;n!=null&&n!=t&&s.load(!0)});s.remove=function(n){_.remove(s.selectedData,{id:n.id});var t=s.fmModel.split(",");return _.remove(t,function(t){return t==n.id}),s.fmModel=t.join(","),s.load(),!1};s.save=function(){var n=o.defer();return s.isShowMobileTitle(!0),s.selectedData==null||s.selectedData.length==0?mabp.message.confirm("您没有选中数据, 确认关闭","提示",function(t){t&&(i.$close(),n.resolve())}):(n.resolve(),console.log("selectedData",s.selectedData),i.$close({items:s.selectedData,selectItem:s.fmModel,defaultFilter:s.tableFilters})),n.promise};s.event_Keydown=function(n){n.keyCode==13&&s.searchData()};s.searchData=function(){s.paging.currentPage=1;s.load(!0)};s.searchCondition=function(){s.paging.currentPage=1;s.load(!0)};s.clearCondition=function(){for(var t=document.querySelectorAll(".search-condition [name]"),n=0;n<t.length;n++)t[n].value=""};s.collectCondition=function(){for(var i={},t=document.querySelectorAll(".search-condition [name]"),n=0;n<t.length;n++)!t[n].value||(i[t[n].getAttribute("name")]=t[n].value);s.tableFilters=i}}])})();
/**** tree.menu.js *****/
(function(){var n=_shared.dialogs.define("treeSelectMenu","/App/_shared_mobile/component/data/tree.menu.html");angular.module("app.shared").controller(n,["fmTool","params","$scope","dialog","$http","mabp.app.module","mabp.app.bpm",function(n,t){var i=this;i.params=t;i.tree=i.params}])})();
/**** tree.select.js *****/
(function(){var n=_shared.dialogs.define("treeSelect","/App/_shared_mobile/component/data/tree.select.html");angular.module("app.shared").controller(n,["fmTool","params","$scope","dialog","$http","mabp.app.module",function(n,t,i){var r=this;r.params=t;r.model={};r.size=t.size;r.ismulti=t.ismulti;switch(r.params.datatype){case"group":n.getGroupTree(r.params.filter,function(n){r.title=n[0].text;r.tree=n;for(var t=0;t<r.tree.length;t++)r.tree[t].$$isExpend=!0});break;case"dataitem":n.getBasicdata(r.params.datacode,r.params.filter,function(n){r.title=n.name;r.tree=n.data})}r.mustleaf=r.params.mustleaf!==undefined?Boolean(r.params.mustleaf):!0;r.selectNodes=r.params.selectData||[];r.save=function(){i.$close({items:r.tree,selectItem:r.selectNodes})};r.itemClicked=function(n){i.$close({items:r.tree,selectItem:[n]})};i.saveData=function(){i.$close({items:r.tree,selectItem:r.selectNodes})};r.cancel=function(){i.$close(null)}}])})();
/**** enum.js *****/
var controllerId=_shared.dialogs.define("enum","/App/_shared_mobile/component/enum/enum.html");_shared.controller(controllerId,["$scope","params","mabp.app.system","$stateParams",function(n,t,i,r){var u=this,f;u.enterpriseId=r.enterpriseId;f=t||{};u.enum=f.enum;u.models=[];u.newItem={};u.load=function(){var n={filters:[{name:"EnterpriseId",value:r.enterpriseId},{name:"Enum",value:u.enum}]};i.getAllEnumsByName(n).then(function(n){u.models=n})};u.cancel=function(n,t){n.id==null?u.models.splice(t,1):n.$edit=!1};u.choose=function(t){n.$close(t)};u.load()}]);
/**** ma-enum.js *****/
_shared.directive("maEnum",["mabp.app.system","$stateParams","dialog",function(n,t,i){return{restrict:"E",replace:!0,template:'<div class="input-group"> <input type="text" class="form-control" disabled placeholder="{{placeholder}}" aria-describedby="basic-addon2" ng-model="display"> <span class="input-group-addon btn" id="basic-addon2" ng-click="open()">选择<\/span> <\/div>',scope:{ngModel:"="},link:function(r,u,f){r.placeholder=f.placeholder;var e=f.enum;r.$watch("ngModel",function(i){if(i!=null){var u={filters:[{name:"EnterpriseId",value:t.enterpriseId},{name:"Enum",value:e},{name:"Value",value:i}]};n.getEnumName(u).then(function(n){r.display=n.data})}});r.open=function(){i.open(_shared.dialogs.enum,{"enum":e}).then(function(n){n!=null&&(r.ngModel=n.value,r.display=n.name)})}}}}]);
/**** fm.group.select.js *****/
(function(){var n=_shared.dialogs.define("fmGroupSelectDialog","/App/_shared_mobile/component/group/group.dialog.html");angular.module("app.shared").controller(n,["$modalInstance","$scope",function(n,t){var i=this;t.remove=function(n){n.remove()};t.toggle=function(n){n.toggle()};i.model=t.selectedModel||{};i.people=[];i.selectedCode="";i.selectedGroup={};i.organizeClick=function(n){i.selectedCode=n.code;i.selectedGroup=n};i.save=function(){n.close(i.selectedGroup)};i.cancel=function(){n.dismiss("cancel")}}])})();
/**** group.dialog.js *****/
(function(){var n=_shared.dialogs.define("groupDialog","/App/_shared/component_mobile/group/group.dialog.html");angular.module("app.shared").controller(n,["$modalInstance","$scope",function(n,t){var i=this;t.remove=function(n){n.remove()};t.toggle=function(n){n.toggle()};i.model=t.selectedModel||{};i.people=[];i.selectedCode="";i.selectedGroup={};i.organizeClick=function(n){i.selectedCode=n.code;i.selectedGroup=n};i.save=function(){n.close(i.selectedGroup)};i.cancel=function(){n.dismiss("cancel")}}])})();
/**** organization.dialog.js *****/
(function(){var n=_shared.dialogs.define("organizationDialog","/App/_shared_mobile/component/group/organization.dialog.html");angular.module("app.shared").controller(n,["mabp.app.bpm","params","$scope","treeTool",function(n,t,i,r){var u=this;u.selectedGroupId="";n.getGroupTree().then(function(n){u.groupArray=n;var t=r.toFormatTreeJson(_.filter(n,{isRoot:!0}),u.selectedGroupId)[0];u.allGroups=r.toFormatTreeJson(_.filter(n,{isRoot:!1}),u.selectedGroupId);u.allGroups.push(t)});i.$watch("vm.selectedGroupId",function(n){if(!!n){var t=r.GetValueOfId(u.groupArray,n);i.$close(t)}})}])})();
/**** formcolumn.dialog.js *****/
(function(){var n=_shared.dialogs.define("formColumn","/App/_shared_mobile/component/inform/formcolumn/formcolumn.dialog.html");angular.module("app.shared").controller(n,["params","$scope","mabp.app.table",function(n,t,i){var r=this;r.params=n;r.wfBusinessTable=[];r.data=t||{};r.model=[];r.beforeShow=function(){i.getInformColums({workflowId:n.workflowId,nodeId:n.nodeId,informLevel:n.informLevel,informLinkId:n.informLinkId,columnLinkId:n.columnLinkId}).then(function(n){for(var i,u=",",t=0;t<n.length;t++)u.indexOf(n[t].id)==-1&&(u+=n[t].id+",",r.wfBusinessTable.push(n[t]),r.wfBusinessTable[r.wfBusinessTable.length-1].Columns=[]);for(t=0;t<n.length;t++)for(i=0;i<r.wfBusinessTable.length;i++)n[t].id==r.wfBusinessTable[i].id&&r.wfBusinessTable[i].Columns.push(n[t]);(n==null||n.length===0)&&mabp.notify.info("还没有数据表")})};r.afterShow=function(){};r.save=function(n){r.afterShow();t.$close(n)};r.cancel=function(){t.$close()};n.informLevel!==1&&r.beforeShow()}])})();
/**** informConfig.js *****/
(function(){angular.module("app.shared").controller("shared.component.inform.config",["$scope","dialog","mabp.app.workflow","$stateParams",function(n,t,i){var r=this;r.model=n.informConfig;r.informType=enums.informType;r.noticeList=enums.noticeType;r.load=function(){r.model.informLevel===3?i.getNodeActions({id:r.model.actionLinkId}).then(function(n){r.actorList=[];!n||_.forEach(n,function(n){r.actorList.push({type:n.type,displayText:n.name,id:n.id})});r.model.nodeType===6&&r.actorList.push({type:"event_TaskCompleted",displayText:L("EndNode_EventCompleted"),id:"9999"});i.getAllByInformConfigLinkId({informLinkId:r.model.informLinkId,informLevel:r.model.informLevel}).then(function(n){r.informs=n})}):(r.actorList=[],r.actorList={event_Submit:{type:"event_Submit",nodeRestrict:0,style:"btn-primary",isEnable:!1,displayText:"提交"},event_Delete:{type:"event_Delete",nodeRestrict:0,style:"btn-danger",isEnable:!1,displayText:"删除"},event_Agree:{type:"event_Agree",nodeRestrict:1,style:"btn-primary",isEnable:!1,displayText:"同意"},event_Reject:{type:"event_Reject",nodeRestrict:1,style:"btn-danger",isEnable:!1,displayText:"拒绝"},event_RecedeToProposer:{type:"event_RecedeToProposer",nodeRestrict:1,style:"btn-primary",isEnable:!1,displayText:"退回发起人"},event_Print:{type:"event_Print",nodeRestrict:1,style:"btn-primary",isEnable:!1,displayText:"打印"},event_Skip:{type:"event_Skip",nodeRestrict:1,style:"btn-primary",isEnable:!1,displayText:"跳过"}},r.model!=null&&r.model.workflowId!=null&&i.chargeInformAndColumnLinkId({id:r.model.workflowId}).then(function(n){!n||(r.model.informLinkId=n.informLinkId,r.model.columnLinkId=n.columnLinkId)}),i.getAllByInformConfigLinkId(r.model).then(function(n){r.informs=n}))};r.load();r.add=function(){i.editNodeInformConfig({informLinkId:r.model.informLinkId,informLevel:r.model.informLevel}).then(function(){r.load()})};r.changeType=function(n){i.editNodeInformConfig(n).then(function(){})};r.changeActor=function(n){n.actionId=_.find(r.actorList,{type:n.eventType}).id;r.changeType(n)};r.edit=function(n){t.open(_shared.dialogs.actionEditDialog,{data:r.model,model:n}).then(function(){})};r.remove=function(n){i.deleteNodeInformConfig(n).then(function(){r.load()})};r.setInformTemplate=function(n){t.open(_shared.dialogs.informFormatSelect,{data:r.model,model:n}).then(function(t){!t||(n.langTemplateList=t.langTemplateList,n.langTextSubjectList=t.langTextSubjectList,r.changeType(n))})}}])})();
/**** informFormat.select.js *****/
(function(){var n=_shared.dialogs.define("informFormatSelect","/App/_shared_mobile/component/inform/informFormat/informFormat.select.html");angular.module("app.shared").controller(n,["params","$scope","dialog","$stateParams","mabp.app.workflow",function(n,t,i){var r=this;r.model=n.model||{};r.column=n.data||{};r.cancel=function(){t.$close()};r.save=function(){t.$close(r.model)};r.openColumn=function(){i.open(_shared.dialogs.formColumn,n.data).then(function(n){var t,i;if(!!n)for(t=0;t<r.model.langTemplateList.length;t++)i=r.model.langTemplateList[t],r.model.langTemplateList[t].value=(i.value||"")+"<%"+n.schemaName+"."+n.c_SchemaName+"%>"})};r.watch=function(){}}])})();
/**** fm.job.select.js *****/
(function(){var n=_shared.dialogs.define("fmJobSelectDialog","/App/_shared_mobile/component/job/fm.job.select.html");angular.module("app.shared").controller(n,["mabp.app.bpm","params","$scope","treeTool",function(n,t,i,r){var u=this,e,f;for(console.log("controllerId",t),u.selectedGroupId="",u.jobs=[],u.selectTxt="",u.ismulti=t.ismulti,u.hideUser=t.hideUser,u.data=[],e=[],f=0;f<t.data.length;f++)u.data.push({id:t.data[f].id,text:t.data[f].text}),e.push(t.data[f].id);u.fmModel=e.join(",");u.myKeyup=function(){window.event.keyCode==13&&u.loadJobList()};u.trCheck=function(n){var r,f;if(t.ismulti){if(r=u.fmModel?u.fmModel.split(","):[],u.isCheck(n)){for(f=0;f<u.data.length;f++)if(u.data[f].id==n.id){u.data.splice(f,1);break}r.splice(r.indexOf(n.id),1)}else r.push(n.id),u.data.push({id:n.id,text:n.jobName+"("+n.jobUsers+")"});u.fmModel=r.join(",")}else i.$close(n.id)};u.save=function(){i.$close(u.fmModel)};u.isCheck=function(n){return!n?!1:(u.fmModel||"").split(",").indexOf(n.id)>=0};n.getGroupTree().then(function(n){u.groupArray=n;console.log("groupService.getGroupTree()",n);var t=r.toFormatTreeJson(_.filter(n,{isRoot:!0}),u.selectedGroupId)[0];u.allGroups=r.toFormatTreeJson(_.filter(n,{isRoot:!1}),u.selectedGroupId);u.allGroups.push(t)});i.$watch("vm.selectedGroupId",function(i){u.selectTxt="";!i||n.getJobs({GroupId:u.selectedGroupId,EnterpriseId:t.enterpriseId}).then(function(n){u.jobList=n})});u.loadJobList=function(){n.getAllJobs({GroupId:u.selectedGroupId,EnterpriseId:t.enterpriseId,Filter:{name:"filter",value:u.selectTxt}}).then(function(n){u.jobList=n})}}])})();
/**** job.dialog.js *****/
(function(){var n=_shared.dialogs.define("jobDialog","/App/_shared_mobile/component/job/job.dialog.html");angular.module("app.shared").controller(n,["mabp.app.bpm","params","$scope",function(n,t,i){var r=this;r.selectedGroupId="";r.jobs=[];r.selectTxt="";r.myKeyup=function(){window.event.keyCode==13&&r.loadJobList()};r.save=function(n){i.$close(n)};n.getGroupTree().then(function(n){r.groupArray=n;console.log("groupService.getGroupTree()",n);r.allGroups.push([])});i.$watch("vm.selectedGroupId",function(i){r.selectTxt="";!i||n.getJobs({GroupId:r.selectedGroupId,EnterpriseId:t.enterpriseId}).then(function(n){r.jobList=n})});r.loadJobList=function(){n.getAllJobs({GroupId:r.selectedGroupId,EnterpriseId:t.enterpriseId,Filter:{name:"filter",value:r.selectTxt}}).then(function(n){r.jobList=n})}}])})();
/**** groupjoblevel.dialog.js *****/
(function(){var n=_shared.dialogs.define("groupJobLevelDialog","/App/_shared_mobile/component/joblevel/groupjoblevel.dialog.html");angular.module("app.shared").controller(n,["mabp.app.bpm","params","$scope","mabp.app.system","$stateParams","treeTool",function(n,t,i,r,u,f){var e=this;e.data=i||{};e.model=[];e.selectData={groupId:"",groupName:"",jobLevelId:"",jobLevelName:""};e.beforeShow=function(){r.getEnums({id:"JobLevel"}).then(function(n){e.model=n})};n.getGroupTree().then(function(n){e.groupArray=n;var t=f.toFormatTreeJson(_.filter(n,{isRoot:!0}),e.selectedGroupId)[0];e.allGroups=f.toFormatTreeJson(_.filter(n,{isRoot:!1}),e.selectedGroupId);e.allGroups.push(t)});i.$watch("vm.selectedGroupId",function(n){if(!!n){var t=f.GetValueOfId(e.groupArray,n);e.selectData.groupId=t.id;e.selectData.groupName=t.text}});e.selectJobLevel=function(n){e.selectData.jobLevelId=n.value;e.selectData.jobLevelName=n.name};e.save=function(){i.$close(e.selectData)};e.cancel=function(){i.$close()};e.beforeShow()}])})();
/**** joblevel.dialog.js *****/
(function(){var n=_shared.dialogs.define("jobLevelDialog","/App/_shared_mobile/component/joblevel/joblevel.dialog.html");angular.module("app.shared").controller(n,["params","$scope","mabp.app.system","$stateParams",function(n,t,i,r){var u=this;u.data=t||{};u.model=[];u.ismulti=n.ismulti;u.beforeShow=function(){var t={filters:[{name:"EnterpriseId",value:r.enterpriseId},{name:"Enum",value:"JobLevel"}]};i.getAllEnumsByName(t).then(function(t){if(u.model=t,n.value)for(var i=0;i<u.model.length;i++)n.value.split(",").indexOf(u.model[i].value)>-1&&(u.model[i].selected=!0)})};u.selectItem=function(n){if(u.ismulti)n.selected=!n.selected;else{for(var t=0;t<u.model.length;t++)u.model[t].selected=!1;n.selected=!n.selected;u.save()}};u.save=function(){for(var i=[],n=0;n<u.model.length;n++)u.model[n].selected&&i.push({id:u.model[n].value,text:u.model[n].name});t.$close(i)};u.cancel=function(){t.$close()};u.beforeShow()}])})();
/**** joblevelarea.dialog.js *****/
(function(){var n=_shared.dialogs.define("jobLevelAreaDialog","/App/_shared_mobile/component/joblevel/joblevelarea.dialog.html");angular.module("app.shared").controller(n,["mabp.app.bpm","params","$scope","mabp.app.system","$stateParams","treeTool",function(n,t,i,r,u,f){var e=this;e.data=i||{};e.model=[];e.selectData={startJobLevelId:"",startJobLevelName:"",endJobLevelId:"",endJobLevelName:""};e.beforeShow=function(){r.getEnums({id:"JobLevel"}).then(function(n){e.model=n})};n.getGroupTree().then(function(n){e.groupArray=n;var t=f.toFormatTreeJson(_.filter(n,{isRoot:!0}),e.selectedGroupId)[0];e.allGroups=f.toFormatTreeJson(_.filter(n,{isRoot:!1}),e.selectedGroupId);e.allGroups.push(t)});i.$watch("vm.selectedGroupId",function(n){if(!!n){var t=f.GetValueOfId(e.groupArray,n);e.selectData.groupId=t.id;e.selectData.groupName=t.text}});e.selectStartJobLevel=function(n){e.selectData.startJobLevelId=n.value;e.selectData.startJobLevelName=n.name};e.selectEndJobLevel=function(n){e.selectData.endJobLevelId=n.value;e.selectData.endJobLevelName=n.name};e.save=function(){i.$close(e.selectData)};e.cancel=function(){i.$close()};e.beforeShow()}])})();
/**** preprocessor.dialog.js *****/
(function(){var n=_shared.dialogs.define("preProcessorDialog","/App/_shared_mobile/component/preProcessor/preprocessor.dialog.html");angular.module("app.shared").controller(n,["params","$scope","mabp.app.taskRead","dialog",function(n,t,i,r){var u=this;u.data=t||{};u.models=n||[];u.currentStep=0;u.model=u.models[0];t.$watch("vm.currentStep",function(n){u.model=u.models[n];u.refreshSelectedUser()});u.selectGroupUser=function(n){r.open(_shared.dialogs.jobUserDialog,{value:"",enterpriseId:u.enterpriseId,ismulti:!n.singleSelected}).then(function(n){var t,i,r;if(!!n)if(Array.isArray(n))for(t=0;t<n.length;t++)i={id:n[t].jobUserId,userName:n[t].userName,$checked:!0,jobName:n[t].jobName},u.pushUserInGroup(i);else r={id:n.jobUserId,userName:n.userName,$checked:!0,jobName:n.jobName},u.pushUserInGroup(r)})};u.pushUserInGroup=function(n){u.model.singleSelected&&(u.model.$checkedId=n.id);var i=u.model.processors,t=_.filter(i,{id:n.id});t!=null&&t.length!==0?t.$checked=!0:(i.push(n),u.refreshSelectedUser())};u.finish=function(){var n=[];_.forEach(u.models,function(t){if(t.variableName!=null&&t.variableName!=""){var i={name:t.variableName,value:_.join(_.map(_.filter(t.processors,function(n){return n.$checked}),"id"),",")};n.push(i)}});t.$close(n)};u.checked=function(n){var i=n.$checked,t;u.model.singleSelected?(_.forEach(u.model.processors,function(n){n.$checked=!1}),t=_.filter(u.model.processors,{id:n.id}),t[0].$checked=!i,u.model.$checkedId=t[0].$checked?t[0].id:""):n.$checked=!i;u.refreshSelectedUser()};u.removeSelectedUser=function(n){u.checked(n)};u.refreshSelectedUser=function(){u.selected=_.filter(u.model.processors,{$checked:!0})};u.currentDisabled=function(){return _.findIndex(u.model.processors,{$checked:!0})==-1};u.cancel=function(){t.$close()}}])})();
/**** role.dialog.js *****/
(function(){var n=_shared.dialogs.define("roleDialog","/App/_shared_mobile/component/role/role.dialog.html");angular.module("app.shared").controller(n,["mabp.app.bpm","params","$scope","treeTool",function(n,t,i,r){var u=this;u.selectedRoleId="";n.getRoleTree().then(function(n){u.allRoles=n});i.$watch("vm.selectedRoleId",function(n){if(!!n){var t=r.GetValueOfId(u.allRoles,n);i.$close(t)}})}])})();
/**** jobuser.dialog.js *****/
(function(){var n=_shared.dialogs.define("jobUserDialog","/App/_shared_mobile/component/user/jobuser.dialog.html");angular.module("app.shared").controller(n,["mabp.app.bpm","params","$scope","mabp.app.user",function(n,t,i){var r=this,u;r.selectedGroupId="";r.jobs=[];r.users=[];r.pageSize=10;r.currentPage=0;r.selectTxt="";r.selectData=[{id:"",text:"",userId:"",userName:"",jobId:"",jobName:"",groupName:""}];r.allEnterpriseUser=[];r.selectDatas=[];u=[];r.jobUserIds=u.join(",");r.ismulti=t.ismulti||!1;r.selectJob=function(){for(var t=[],n=0;n<r.jobs.length;n++)r.selectTxt==""?t.push(r.jobs[n]):r.jobs[n].jobName.indexOf(r.selectTxt)>=0&&t.push(r.jobs[n]);return t};r.selectUser=function(){var t=[],n;if(r.selectTxt=="")t=r.users;else for(n=0;n<r.allUsers.length;n++)(r.allUsers[n].jobName.indexOf(r.selectTxt)>=0||r.allUsers[n].jobUsers.indexOf(r.selectTxt)>=0)&&t.push(r.allUsers[n]);return t};r.event_Keydown=function(n){n.keyCode==13&&r.selectUser()};r.searchData=function(){r.selectUser()};r.isCheck=function(n){return!n?!1:(r.jobUserIds||"").split(",").indexOf(n.id)>=0};r.trCheck=function(n){var t,i;if(r.checkUser(n),r.ismulti){if(t=r.jobUserIds?r.jobUserIds.split(","):[],r.isCheck(n)){for(i=0;i<r.selectDatas.length;i++)if(r.selectDatas[i].id==r.selectData[0].jobUserId){r.selectDatas.splice(i,1);break}t.splice(t.indexOf(r.selectData[0].jobUserId),1)}else t.push(n.id),r.selectDatas.push({id:n.id,text:n.groupName+">"+n.jobName+">"+n.jobUsers+"",groupName:n.groupName,userId:n.id,jobName:n.jobName,userName:n.jobUsers,jobUserId:n.id});r.jobUserIds=t.join(",")}else r.jobUserIds=n.id,console.log("选择的用户",n,"组织结构",r.groupArray),r.selectDatas=[n],console.log(r.selectData)};r.search=function(n){if(r.allUsers&&r.allUsers.length==0){r.allEnterpriseUser=[];return}r.allEnterpriseUser=r.loadMoreUser(_.filter(r.allUsers,function(n){return _.isEmpty(r.selectTxt)?!0:n.jobUsers&&n.jobUsers.indexOf(r.selectTxt)!=-1}),n||0);console.log(r.allEnterpriseUser)};r.loadMoreUser=function(n,t){return t=t||0,n=n||r.allUsers,_.slice(n,t*r.pageSize,(t+1)*r.pageSize)};r.next=function(){r.allEnterpriseUser.length<r.pageSize||(r.currentPage++,r.search(r.currentPage))};r.previous=function(){r.currentPage--;r.currentPage<=0&&(r.currentPage=0);r.search(r.currentPage)};r.checkUser=function(n){r.selectData=[{id:n.id,text:n.groupName+">"+n.jobName+">"+n.jobUsers+"",groupName:n.groupName,userId:n.userId,jobName:n.jobName,userName:n.jobUsers,jobUserId:n.id,jobId:n.jobId}]};r.save=function(){if(!r.selectData[0].userId)return mabp.notify.info("请选择人员"),!1;r.ismulti?i.$close(r.selectDatas):i.$close(r.selectData)};r.cancel=function(){i.$close(!1)};r.totalUserNumber=0;r.pageInfo={Ascending:!1,currentPage:1,filters:[{name:"filterText",value:r.selectTxt||""}],orderByProperty:"Id",pageSize:10};n.getGroupTree().then(function(n){return r.groupArray=n,console.log("service.getGroupTree()",n),n[0].id}).then(function(i){return n.getAllJobToUser({GroupId:i,EnterpriseId:t.enterpriseId})}).then(function(n){console.log("service.getAllJobToUser",n);r.allUsers=n;r.search(0)});i.$watch("vm.selectedGroupId",function(i){!i||(n.getJobToUser({GroupId:r.selectedGroupId,EnterpriseId:t.enterpriseId}).then(function(n){console.log("service.getJobToUser",n);r.users=n}),n.getAllJobToUser({GroupId:r.selectedGroupId,EnterpriseId:t.enterpriseId}).then(function(n){console.log("service.getAllJobToUser",n);r.allUsers=n;r.search(0)}))})}])})();
/**** ma.user.select.dialog.js *****/
(function(){var n=_shared.dialogs.define("maUserSelectDialog","/App/_shared_mobile/component/user/ma.user.select.dialog.html");angular.module("app.shared").controller(n,["mabp.app.bpm","params","$scope","mabp.app.user","$http",function(n,t,i){var r=this;r.selectedGroupId="";r.users=[];r.selectTxt="";r.selectData=t.initSelectData||[];r.paging=_shared.initialPage(r,1,8);r.load=function(){r.paging.filters=[{name:"filterText",value:r.selectTxt}];n.getAllEnterpriseUser(r.paging).then(function(n){r.users=n.model;r.paging.totalCount=n.totalCount})};r.selectUser=function(){for(var t=[],n=0;n<r.users.length;n++)r.selectTxt==""?t.push(r.users[n]):r.users[n].name.indexOf(r.selectTxt)>=0&&t.push(r.users[n]);return t};r.isCheck=function(n){if(!!r.selectData&&r.selectData.length>0)for(var t=0;t<r.selectData.length;t++)if(r.selectData[t].id==n.id)return!0;return!1};r.checkUser=function(n,i){if(!t.ismulti)r.selectData=[i];else{if(!!r.selectData&&r.selectData.length>0)for(var u=0;u<r.selectData.length;u++)if(i.id==r.selectData[u].id){r.selectData.splice(u,1);return}r.selectData.push(i)}!n||n.stopPropagation()};r.removeUser=function(n){if(!!r.selectData&&r.selectData.length>0)for(var t=0;t<r.selectData.length;t++)if(n.id==r.selectData[t].id){r.selectData.splice(t,1);return}};r.event_Keydown=function(n){n.keyCode==13&&r.load()};r.checkAll=function(){};r.save=function(){i.$close(r.selectData)};r.cancel=function(){i.$close(!1)};r.load()}])})();
/**** variable.edit.js *****/
(function(){var n=_shared.dialogs.define("variableEdit","/App/_shared_mobile/component/variable/variable.edit.html");angular.module("app.shared").controller(n,["params","$scope","mabp.app.workflow","$stateParams",function(n,t,i,r){var u=this;u.data=t||{};u.model=[];u.beforeShow=function(){u.data="<%sysCurrentTime,Date%><%sysInitiator,String%><%sysTaskID,String%><%sysToday,Date%><%sysApplicant,String%><%sysApprovers,String%><%sysInitiatorGroupCode,String%><%sysApplicantGroupCode,String%><%sysInitiatorJobLevel,String%><%sysApplicantJobLevel,String%><%sysCurrentJobLevel,String%><%sysLocation,String%>";var n=u.data.match(/([^%>|^<%])+/g);u.model=[];n.map(function(n){var t=n.split(",");u.model.push({name:t[0],type:t[1]})});i.getAllWorkflowVariable({id:r.workflowId}).then(function(n){for(var i=[L("Text"),L("Number")],t=0;t<n.length;t++)u.model.push({name:n[t].name,type:i[n[t].type]})})};u.afterShow=function(){};u.save=function(n){u.afterShow();t.$close(n.name)};u.cancel=function(){t.$close()};u.beforeShow()}])})();
/**** workflownode.dialog.js *****/
(function(){var n=_shared.dialogs.define("workflowNodeDialog","/App/_shared_mobile/component/workflownode/workflownode.dialog.html");angular.module("app.shared").controller(n,["params","$scope","mabp.app.workflow",function(n,t,i){var r=this;r.data=t||{};r.model=[];r.loadData=n.noLoadData||!1;r.beforeShow=function(){i.getOtherStepNodes({id:n.node.id,selectedId:n.node.wfdWorkflowId}).then(function(n){r.model=n})};r.save=function(n){t.$close(n)};r.cancel=function(){t.$close()};r.loadData?r.model=n.data:r.beforeShow()}])})();
/**** email.dialog.js *****/
(function(){var n=_shared.dialogs.define("emailDialog","/App/_shared_mobile/email/email.dialog.html");_shared.controller(n,["params","$scope","mabp.app.email",function(n,t,i){var r=this;r.model={};r.model.sendTos=[];r.model.ccTos=[];r.model.bccTos=[];r.model.mailToAll=n.sendTo.mailToAll;r.model.toAll="To All";n.sendTo.mailToAll?r.model.sendTos=n.sendTo.sendTos:n.sendTo.procOwnerId!=n.sendTo.procUserId?(r.model.emailTo=n.sendTo.procUserName+"<"+n.sendTo.procUserEmailAddress+">;"+n.sendTo.procOwnerName+"<"+n.sendTo.procOwnerEmailAddress+">",r.model.toEmail="<"+n.sendTo.procUserEmailAddress+">;<"+n.sendTo.procOwnerEmailAddress+">",r.model.sendTos.push(n.sendTo.procUserEmailAddress),r.model.sendTos.push(n.sendTo.procOwnerEmailAddress)):(r.model.emailTo=n.sendTo.procUserName+"<"+n.sendTo.procUserEmailAddress+">",r.model.toEmail=n.sendTo.procUserEmailAddress,r.model.sendTos.push(n.sendTo.procUserEmailAddress));r.model.ccTos.push(n.currentUserInfo.emailAddress);r.model.fileName=n.sendTo.sn;r.model.sn=n.sendTo.sn;r.model.taskId=n.sendTo.taskId;r.model.formEmailAddress=n.currentUserInfo.emailAddress;r.model.formUserName=n.currentUserInfo.userName;r.save=function(){i.mailTo(r.model).then(function(){t.$close(r.model)})};r.cancel=function(){t.$close(!1)}}])})();
/**** actoruser.select.inform.js *****/
(function(){var n=_shared.dialogs.define("actoruserSelectInform","/App/_shared_mobile/inform/actoruser.select.inform.html");angular.module("app.shared").controller(n,["params","$scope","dialog","$stateParams","mabp.app.workflow",function(n,t,i,r,u){var f=this;f.model={type:0,dataType:0,dataValue:null,baseType:0,baseValue:null,isActiveConditionEnable:0,baseDataType:1,activeCondition:"",processorLinkId:n.processorLinkedId};f.isInit=!1;!n.processor||!n.processor.id||(f.isInit=!0);f.param=t.selectedModel;f.dataTypes=[];f.baseTypes=[];f.cancel=function(){t.$close()};f.save=function(){u.editWorkflowProcessor(f.model).then(function(n){t.$close(n)})};f.actorList={NextProcessor:{text:L("NextProcessor"),value:20},Initiator:{text:L("Initiator"),value:0},Applicant:{text:L("Applicant"),value:19},Job:{text:L("Job"),value:2}};f.changeType=function(){f.isInit?f.model.type==6&&(f.dataValueReadOnly=!1):(f.model.dataType=null,f.model.baseType=null,f.dataTypes=[],f.baseTypes=[],f.dataTypePlaceholder="",f.baseTypePlaceholder="",f.model.dataValueName="",f.model.baseValueName="");f.dataArr=[];switch(parseInt(f.model.type)){case 2:case 4:case 14:case 15:case 16:case 17:case 18:f.dataArr.push(1);case 3:case 6:case 7:case 8:f.dataArr.push(2);case 5:case 13:f.dataArr.push(0);break;case 1:f.dataArr.push(1,2)}f.dataArr.indexOf(0)>-1&&f.dataTypes.push({text:L("ChooseSource"),value:0,fun:function(t){switch(f.model.type){case 2:i.open(_shared.dialogs.jobDialog,{value:f.model.dataValue,enterpriseId:f.enterpriseId}).then(function(n){!n||(t.value=n.id,t.valuetext=n.jobName)});break;case 3:case 8:i.open(_shared.dialogs.roleDialog,{value:f.model.dataValue,enterpriseId:f.enterpriseId}).then(function(n){!n||(t.value=n.id,t.valuetext=n.text)});break;case 4:i.open(_shared.dialogs.organizationDialog,{value:f.model.dataValue,enterpriseId:f.enterpriseId}).then(function(n){!n||(t.value=n.id,t.valuetext=n.text)});break;case 6:t.readonly=!1;t.placeholder=L("PleaseInputJobCodeManually");break;case 7:i.open(_shared.dialogs.jobLevelDialog,{value:f.model.dataValue,enterpriseId:f.enterpriseId}).then(function(n){!!n&&n.length>0&&(t.value=n[0].id,t.valuetext=n[0].text)});break;case 13:i.open(_shared.dialogs.groupJobLevelDialog,{value:f.model.dataValue,enterpriseId:f.enterpriseId}).then(function(n){!n||(t.value=n.groupId+","+n.jobLevelId,t.valuetext=n.groupName+","+n.jobLevelName)});break;case 5:case 14:case 15:i.open(_shared.dialogs.workflowNodeDialog,{value:f.model.dataValue,node:n.processorNode,enterpriseId:f.enterpriseId}).then(function(n){!n||(t.value=n.id,t.valuetext=n.displayName)});break;case 16:i.open(_shared.dialogs.jobLevelAreaDialog,{value:f.model.dataValue,enterpriseId:f.enterpriseId}).then(function(n){!n||(t.value=n.startJobLevelId+","+n.endJobLevelId,t.valuetext=n.startJobLevelName+"—"+n.endJobLevelName)});break;case 17:t.readonly=!1;t.placeholder=L("PleaseInputJobCodeManually");break;case 18:i.open(_shared.dialogs.jobLevelDialog,{value:f.model.dataValue,enterpriseId:f.enterpriseId}).then(function(n){!!n&&n.length>0&&(t.value=n[0].id,t.valuetext=n[0].text)})}}});f.dataArr.indexOf(1)>-1&&f.dataTypes.push({text:L("DataField"),value:1,fun:function(n){i.open(_shared.dialogs.businessTableColumn,{workflowId:r.workflowId}).then(function(t){!t||(n.value="<%"+t.schemaName+"."+t.c_SchemaName+"%>",n.valuetext="<%"+t.schemaName+"."+t.c_SchemaName+"%>")})}});f.dataArr.indexOf(2)>-1&&f.dataTypes.push({text:L("Variable"),value:2,fun:function(n){i.open(_shared.dialogs.variableEdit,n.value).then(function(t){!t||(n.value="<%"+t+"%>",n.valuetext="<%"+t+"%>")})}});[6,7,8,9,10,17,18].indexOf(parseInt(f.model.type))>-1&&(f.baseTypes=[{text:L("AccordingToTheApplicant"),value:0,fun:function(){}},{text:L("AccordingToTheField"),value:1,fun:function(n){i.open(_shared.dialogs.businessTableColumn,{workflowId:r.workflowId}).then(function(t){!t||(n.value="<%"+t.schemaName+"."+t.c_SchemaName+"%>",n.valuetext="<%"+t.schemaName+"."+t.c_SchemaName+"%>")})}},{text:L("AccordingToTheVariable"),value:2,fun:function(n){i.open(_shared.dialogs.variableEdit,n.value).then(function(t){n.value="<%"+t+"%>";n.valuetext="<%"+t+"%>"})}}]);f.isInit=!1};f.setVariable=function(){i.open(_shared.dialogs.variableEdit,f.model.activeCondition).then(function(n){!n||(f.model.activeCondition=(f.model.activeCondition||"")+"<%"+n+"%>")})};f.openColumn=function(){i.open(_shared.dialogs.businessTableColumn,{workflowId:r.workflowId}).then(function(n){!n||(f.model.activeCondition=(f.model.activeCondition||"")+"<%"+n.schemaName+"."+n.c_SchemaName+"%>")})};f.watch=function(){u.getFormattedResult({data:f.model.activeCondition}).then(function(n){f.formatedData=n.data})};!n.processor||!n.processor.id||(f.model={id:n.processor.id,type:n.processor.type,dataType:n.processor.dataType,dataValue:n.processor.dataValue,dataValueName:n.processor.dataValueName,baseType:n.processor.baseType,baseValue:n.processor.baseValue,baseValueName:n.processor.baseValue,isActiveConditionEnable:n.processor.isActiveConditionEnable,activeCondition:n.processor.activeCondition,processorLinkId:n.processor.processorLinkId},f.changeType())}])})();
/**** actoruser.select.js *****/
(function(){var n=_shared.dialogs.define("actoruserSelect","/App/_shared_mobile/inform/actoruser.select.html");angular.module("app.shared").controller(n,["params","$scope","dialog","$stateParams","mabp.app.workflow",function(n,t,i,r,u){var f=this;f.model={type:0,dataType:0,dataValue:null,baseType:0,baseValue:null,isActiveConditionEnable:0,baseDataType:1,activeCondition:"",processorLinkId:n.processorLinkedId};f.isInit=!1;!n.processor||!n.processor.id||(f.isInit=!0);f.param=t.selectedModel;f.dataTypes=[];f.baseTypes=[];f.cancel=function(){t.$close()};f.save=function(){u.editWorkflowProcessor(f.model).then(function(n){t.$close(n)})};f.actorList={Initiator:{text:L("Initiator"),value:0},Applicant:{text:L("Applicant"),value:19},BusinessMan:{text:L("BusinessRelatedPerson"),value:1},Job:{text:L("Job"),value:2},JobUser:{text:L("JobToUser"),value:22},Role:{text:L("Role"),value:3},Department:{text:L("Department"),value:4},JobLevel:{text:L("SameWithCertainStepHandler"),value:5},JobCodeFilterByPerson:{text:L("JobCodeFilterByPerson"),value:6},JobLevelFilterByPerson:{text:L("JobLevelFilterByPerson"),value:7},JobCodeFilterByDept:{text:L("JobCodeFilterByDept"),value:17},JobLevelFilterByDept:{text:L("JobLevelFilterByDept"),value:18},RoleFilterByDepartment:{text:L("RoleFilterByDepartment"),value:8},RoleFilterByArea:{text:L("RoleFilterByArea"),value:21},DepartmentLeader:{text:L("DepartmentLeader"),value:9},SupervisorOfProposer:{text:L("DirectSupervisor"),value:10},SupervisorOfPre:{text:L("DirectSupervisorOfPreviousStep"),value:11},DepartmentOfPre:{text:L("DepartmentLeaderOfPreviousStep"),value:12},PersonOfSepecificOrganizationJobLevel:{text:L("PersonOfSpecificOrganizationJobLevel"),value:13},SupervisorOfSpe:{text:L("DirectSupervisorOfSpecificStep"),value:14},DepartmentHeadOfSpe:{text:L("DepartmentLeaderOfSpecificStep"),value:15},FromOneJobLevelToAnotherJobLevel:{text:L("FromOneJobLevelToAnotherJobLevel"),value:16}};f.changeType=function(){f.isInit?f.model.type==6&&(f.dataValueReadOnly=!1):(f.model.dataType=null,f.model.baseType=null,f.dataTypes=[],f.baseTypes=[],f.dataTypePlaceholder="",f.baseTypePlaceholder="",f.model.dataValueName="",f.model.baseValueName="");f.dataArr=[];switch(parseInt(f.model.type)){case 2:case 4:case 14:case 15:case 16:case 17:case 18:case 22:f.dataArr.push(1);case 3:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 21:f.dataArr.push(2);case 5:case 13:f.dataArr.push(0);break;case 1:f.dataArr.push(1,2)}f.dataArr.indexOf(0)>-1&&f.dataTypes.push({text:L("ChooseSource"),value:0,fun:function(t){switch(f.model.type){case 2:i.open(_shared.dialogs.jobDialog,{value:f.model.dataValue,enterpriseId:f.enterpriseId}).then(function(n){!n||(t.value=n.id,t.valuetext=n.jobName+"("+n.jobUsers+")")});break;case 3:case 8:case 21:i.open(_shared.dialogs.roleDialog,{value:f.model.dataValue,enterpriseId:f.enterpriseId}).then(function(n){!n||(t.value=n.id,t.valuetext=n.text)});break;case 4:i.open(_shared.dialogs.organizationDialog,{value:f.model.dataValue,enterpriseId:f.enterpriseId}).then(function(n){!n||(t.value=n.id,t.valuetext=n.text)});break;case 6:t.readonly=!1;t.placeholder=L("PleaseInputJobCodeManually");break;case 7:case 9:case 10:case 11:case 12:i.open(_shared.dialogs.jobLevelDialog,{value:f.model.dataValue,enterpriseId:f.enterpriseId}).then(function(n){!!n&&n.length>0&&(t.value=n[0].id,t.valuetext=n[0].text)});break;case 13:i.open(_shared.dialogs.groupJobLevelDialog,{value:f.model.dataValue,enterpriseId:f.enterpriseId}).then(function(n){!n||(t.value=n.groupId+","+n.jobLevelId,t.valuetext=n.groupName+","+n.jobLevelName)});break;case 5:case 14:case 15:i.open(_shared.dialogs.workflowNodeDialog,{value:f.model.dataValue,node:n.processorNode,enterpriseId:f.enterpriseId}).then(function(n){!n||(t.value=n.id,t.valuetext=n.displayName)});break;case 16:i.open(_shared.dialogs.jobLevelAreaDialog,{value:f.model.dataValue,enterpriseId:f.enterpriseId}).then(function(n){!n||(t.value=n.startJobLevelId+","+n.endJobLevelId,t.valuetext=n.startJobLevelName+"—"+n.endJobLevelName)});break;case 17:t.readonly=!1;t.placeholder=L("PleaseInputJobCodeManually");break;case 18:i.open(_shared.dialogs.jobLevelDialog,{value:f.model.dataValue,enterpriseId:f.enterpriseId}).then(function(n){!!n&&n.length>0&&(t.value=n[0].id,t.valuetext=n[0].text)});break;case 22:i.open(_shared.dialogs.jobUserDialog,{value:f.model.dataValue,enterpriseId:f.enterpriseId}).then(function(n){!!n&&n.length>0&&(t.value=n[0].id,t.valuetext=n[0].text)})}}});f.dataArr.indexOf(1)>-1&&f.dataTypes.push({text:L("DataField"),value:1,fun:function(n){i.open(_shared.dialogs.businessTableColumn,{workflowId:r.workflowId}).then(function(t){!t||(n.value="<%"+t.schemaName+"."+t.c_SchemaName+"%>",n.valuetext="<%"+t.schemaName+"."+t.c_SchemaName+"%>")})}});f.dataArr.indexOf(2)>-1&&f.dataTypes.push({text:L("Variable"),value:2,fun:function(n){i.open(_shared.dialogs.variableEdit,n.value).then(function(t){!t||(n.value="<%"+t+"%>",n.valuetext="<%"+t+"%>")})}});[6,7,8,9,10,16,17,18,21,11].indexOf(parseInt(f.model.type))>-1&&(f.baseTypes=[{text:L("AccordingToTheApplicant"),value:0,fun:function(){}},{text:L("AccordingToTheField"),value:1,fun:function(n){i.open(_shared.dialogs.businessTableColumn,{workflowId:r.workflowId}).then(function(t){!t||(n.value="<%"+t.schemaName+"."+t.c_SchemaName+"%>",n.valuetext="<%"+t.schemaName+"."+t.c_SchemaName+"%>")})}},{text:L("AccordingToTheVariable"),value:2,fun:function(n){i.open(_shared.dialogs.variableEdit,n.value).then(function(t){n.value="<%"+t+"%>";n.valuetext="<%"+t+"%>"})}}]);f.isInit=!1};f.setVariable=function(){i.open(_shared.dialogs.variableEdit,f.model.activeCondition).then(function(n){!n||(f.model.activeCondition=(f.model.activeCondition||"")+"<%"+n+"%>")})};f.openColumn=function(){i.open(_shared.dialogs.businessTableColumn,{workflowId:r.workflowId}).then(function(n){!n||(f.model.activeCondition=(f.model.activeCondition||"")+"<%"+n.schemaName+"."+n.c_SchemaName+"%>")})};f.watch=function(){u.getFormattedResult({data:f.model.activeCondition}).then(function(n){f.formatedData=n.data})};!n.processor||!n.processor.id||(f.model={id:n.processor.id,type:n.processor.type,dataType:n.processor.dataType,dataValue:n.processor.dataValue,dataValueName:n.processor.dataValueName,baseType:n.processor.baseType,baseValue:n.processor.baseValue,baseValueName:n.processor.baseValue,isActiveConditionEnable:n.processor.isActiveConditionEnable,activeCondition:n.processor.activeCondition,processorLinkId:n.processor.processorLinkId},f.changeType())}])})();
/**** ma-informprocessor.directive.js *****/
(function(){angular.module("app.shared").directive("maInformprocessor",["dialog","mabp.app.workflow","$stateParams",function(n,t){return{restrict:"E",templateUrl:_turl("/App/_shared_mobile/inform/ma-informprocessor.directive.html"),replace:!0,scope:{processorLinkedId:"=",processorNode:"="},link:function(i){var r=i.vm={};r.node=i.model;r.actorList=[];r.load=function(){t.getProcessor({id:i.processorLinkedId}).then(function(n){r.actorList=n})};r.editActor=function(t){n.open(_shared.dialogs.actoruserSelectInform,{processorLinkedId:i.processorLinkedId,processorNode:i.processorNode,processor:t}).then(function(n){!n||(model!=null?r.actorList.map(function(t){t.$$hashKey===model.$$hashKey&&$.extend(t,n)}):r.actorList.push(n));r.load()})};r.removeActor=function(n){t.deleteWorkflowProcessor(n).then(function(n){n>0&&(r.load(),mabp.notify.success(L("DeleteSuccessfully")))})};r.newProcessor=function(t){n.open(_shared.dialogs.actoruserSelectInform,{processorLinkedId:i.processorLinkedId,processorNode:i.processorNode}).then(function(n){!n||(t!=null?r.actorList.map(function(i){i.$$hashKey===t.$$hashKey&&$.extend(i,n)}):r.actorList.push(n));r.load()})};r.barConfig={animation:150,ghostClass:"selectitem",handle:".handle",onSort:function(n){if(n.oldIndex!=n.newIndex){var i=r.actorList;t.updateWorkflowOrder(n.models)}},orderMember:"displayOrder"};r.load()}}}])})();
/**** ma-preprocessor.directive.js *****/
(function(){angular.module("app.shared").directive("maPreprocessor",["dialog","mabp.app.workflow","$stateParams",function(n,t,i){return{restrict:"E",templateUrl:_turl("/App/_shared_mobile/inform/ma-preprocessor.directive.html"),replace:!0,scope:{processorLinkedId:"=",processorNode:"="},link:function(r){var u=r.vm={};u.node=r.model;u.actorList=[];u.load=function(){t.getProcessor({id:r.processorLinkedId}).then(function(n){u.actorList=n})};u.baseTypes=[{text:L("All"),value:0,fun:function(){}},{text:L("ApplicantOrganization"),value:1,fun:function(){}},{text:L("ApplicantOrganizationAndSubordinateOrganization"),value:2,fun:function(){}},{text:L("CurrentApproverOrganization"),value:3,fun:function(){}},{text:L("CurrentApproverOrganizationAndSubordinateOrganization"),value:4,fun:function(){}},{text:L("SpecificOrganization"),value:5,fun:function(t){n.open(_shared.dialogs.organizationDialog,{workflowId:i.workflowId}).then(function(n){!n||(t.value=n.id,t.valuetext=n.text)})}},{text:L("SpecificOrganizationVariable"),value:6,fun:function(t){n.open(_shared.dialogs.variableEdit,t.value).then(function(n){!n||(t.value="<%"+n+"%>",t.valuetext="<%"+n+"%>")})}},{text:L("SpecificOrganizationDataField"),value:7,fun:function(t){n.open(_shared.dialogs.businessTableColumn,{workflowId:i.workflowId}).then(function(n){!n||(t.value="<%"+n.schemaName+"."+n.c_SchemaName+"%>",t.valuetext="<%"+n.schemaName+"."+n.c_SchemaName+"%>")})}},{text:L("SpecificOrganizationAndSubordinateOrganization"),value:8,fun:function(t){n.open(_shared.dialogs.organizationDialog,{workflowId:i.workflowId}).then(function(n){!n||(t.value=n.id,t.valuetext=n.text)})}},{text:L("SpecificOrganizationAndSubordinateOrganizationVariable"),value:9,fun:function(t){n.open(_shared.dialogs.variableEdit,t.value).then(function(n){!n||(t.value="<%"+n+"%>",t.valuetext="<%"+n+"%>")})}},{text:L("SpecificOrganizationAndSubordinateOrganizationDataField"),value:10,fun:function(t){n.open(_shared.dialogs.businessTableColumn,{workflowId:i.workflowId}).then(function(n){!n||(t.value="<%"+n.schemaName+"."+n.c_SchemaName+"%>",t.valuetext="<%"+n.schemaName+"."+n.c_SchemaName+"%>")})}}];u.getBaseType=function(n){for(var t=0;t<u.baseTypes.length;t++)if(u.baseTypes[t].value==n)return u.baseTypes[t].text};u.editActor=function(t){n.open(app.dialogs.actoruserSelect2,{processorLinkedId:r.processorLinkedId,processorNode:r.processorNode,processor:t}).then(function(n){!n||(model!=null?u.actorList.map(function(t){t.$$hashKey===model.$$hashKey&&$.extend(t,n)}):u.actorList.push(n));u.load()})};u.removeActor=function(n){t.deleteWorkflowProcessor(n).then(function(n){n>0&&(u.load(),mabp.notify.success(L("DeleteSuccessfully")))})};u.open=function(t){n.open(app.dialogs.actoruserSelect2,{processorLinkedId:r.processorLinkedId,processorNode:r.processorNode}).then(function(n){!n||(t!=null?u.actorList.map(function(i){i.$$hashKey===t.$$hashKey&&$.extend(i,n)}):u.actorList.push(n));u.load()})};u.barConfig={animation:150,ghostClass:"selectitem",handle:".handle",onSort:function(n){n.oldIndex!=n.newIndex&&t.updateWorkflowOrder(n.models)},orderMember:"displayOrder"};u.load()}}}])})();
/**** ma-processor.directive.js *****/
(function(){angular.module("app.shared").directive("maProcessor",["dialog","mabp.app.workflow","$stateParams",function(n,t){return{restrict:"E",templateUrl:"/App/_shared_mobile/inform/ma-processor.directive.html",replace:!0,scope:{processorLinkedId:"=",processorNode:"="},link:function(i){var r=i.vm={};r.node=i.model;r.actorList=[];r.load=function(){t.getProcessor({id:i.processorLinkedId}).then(function(n){r.actorList=n})};r.editActor=function(t){n.open(_shared.dialogs.actoruserSelect,{processorLinkedId:i.processorLinkedId,processorNode:i.processorNode,processor:t}).then(function(n){!n||(model!=null?r.actorList.map(function(t){t.$$hashKey===model.$$hashKey&&$.extend(t,n)}):r.actorList.push(n));r.load()})};r.removeActor=function(n){t.deleteWorkflowProcessor(n).then(function(n){n>0&&(r.load(),mabp.notify.success(L("DeleteSuccessfully")))})};r.open=function(t){n.open(_shared.dialogs.actoruserSelect,{processorLinkedId:i.processorLinkedId,processorNode:i.processorNode}).then(function(n){!n||(t!=null?r.actorList.map(function(i){i.$$hashKey===t.$$hashKey&&$.extend(i,n)}):r.actorList.push(n));r.load()})};r.barConfig={animation:150,ghostClass:"selectitem",handle:".handle",onSort:function(n){if(n.oldIndex!=n.newIndex){var i=r.actorList;t.updateWorkflowOrder(n.models)}},orderMember:"displayOrder"};r.load()}}}])})();
/**** languageSetting.js *****/
_shared.languageSetting={};_shared.languageSetting.rules={en:{nickname:{pattern:"nickname should start with latter, can contain numbers and letters"},schemaName:{pattern:"code should start with letter, only can contain numbers and letter"},password:{required:"password can't be empty",minlength:"length must larger than {minlength}",pattern:"length must larger than 6, and can contain numbers and letters"}},"zh-CN":{nickname:{pattern:"昵称必须输入数字或下划线,以字母开头"},schemaName:{pattern:"代码必须输入数字或下划线,以字母开头"},password:{required:"密码不能为空",minlength:"密码长度不能小于{minlength}",pattern:"密码必须且只能包含字母和数字,长度不能小于6位"}}};_shared.languageSetting.defaultRules={en:{required:"this is required",maxlength:"max-length can't be larger than {maxlength}",minlength:"max-length can't be less than {minlength}",email:"email format is wrong",repeat:"Two times input is not the same",pattern:"format is wrong",number:"number required",w5cuniquecheck:"value exists please change",url:"url format is not correct",max:"value can't be larger than {max}",min:"value can't be less than {min}",customizer:"custom validation failed",isrequired:" is required.",lengthcannotlager:" length cannot be larger than ",lengthcannotlesser:" length cannot be lesser than ",valuecannotlager:" number cannot be larger than ",valuecannotlesser:" number cannot be lesser than "},"zh-CN":{required:"该选项不能为空",maxlength:"该选项输入值长度不能大于{maxlength}",minlength:"该选项输入值长度不能小于{minlength}",email:"输入邮件的格式不正确",repeat:"两次输入不一致",pattern:"输入格式不正确",number:"必须输入数字",w5cuniquecheck:"该输入值已经存在，请重新输入",url:"输入URL格式不正确",max:"该选项输入值不能大于{max}",min:"该选项输入值不能小于{min}",customizer:"自定义验证不通过",isrequired:" 是必填的",lengthcannotlager:" 长度不能大于 ",lengthcannotlesser:" 长度不能小于 ",valuecannotlager:" 不能大于 ",valuecannotlesser:" 不能小于 "}};
/**** ma-language.js *****/
_shared.directive("maLanguage",["$compile","mabp.app.system",function(n,t){return{restrict:"E",replace:!0,template:function(n,t){var u="",f=t.disabled!=undefined&&t.disabled!=="false"?!0:!1,e,o,s,r,i;for(t.maRequired!=null&&(u="ma-dynamic-element required"),e="",e=t.type==="textarea"?'<textarea ng-disabled="maDisabled" '+(f?'disabled="disabled"':"")+' type="text" rows="3" name="{2}{3}" ng-model="{1}" class="validate ma-lang-content-item" ng-focus="event_Focus($event)" ng-blur="event_Blur($event)" '+u+' placeholder="{0}"/>':'<input ng-disabled="maDisabled" '+(f?'disabled="disabled"':"")+' type="text" name="{2}{3}" ng-model="{1}" class="validate ma-lang-content-item" ng-focus="event_Focus($event)" ng-blur="event_Blur($event)" '+u+' placeholder="{0}" />',o=[{text:"中文",id:"zh-CN"},{text:"English",id:"en"}],s="",r=0;r<o.length;r++)i=o[r],s+='<tr><td class="ma-lang-label"><span class="ma-lang-label-item">'+i.text+'<\/span><\/td><td class="ma-lang-content">'+e.fill(i.text,"languages['"+i.id+"']",t.name,i.id)+"<\/td><\/tr>";return"<table "+(f?'disabled="disabled"':"")+" "+(t.type||"")+' class="ma-lang">'+s+"<\/table>"},require:"ngModel",scope:{ngModel:"=",languageList:"=",maDisabled:"="},link:function(n,i,r){n.languages={"zh-CN":"",en:""};n.languageList=[];n.$watch("ngModel",function(i){t.getLangs({id:i}).then(function(t){var i,r;if(t==null){n.languages={"zh-CN":null,en:null};n.languageList=[];return}for(i=t.nameValues,r=0;r<i.length;r++)n.languages[i[r].name]=i[r].value;n.languageList=i})});n.$watch("languages",function(t){var r,i;n.languageList=n.languageList||[];r=0;for(i in t)t.hasOwnProperty(i)&&(n.languageList[r]={name:i,value:t[i]},r++)},!0);n.$watch("languageList",function(){n.languageList=n.languageList||[];var t=mabp.toObject(n.languageList);n.languages={"zh-CN":t["zh-CN"],en:t.en}},!0);n.event_Focus=function(n){$(n.currentTarget).parents("tr").addClass("active")};n.event_Blur=function(t){n.$parent.$eval(r.maBlur);$(t.currentTarget).parents("tr").removeClass("active")}}}}]);_shared.directive("maTextLanguage",["$compile","mabp.app.system",function(n,t){return{restrict:"E",replace:!0,template:function(n,t){var u="",f=t.disabled!=undefined&&t.disabled!=="false"?!0:!1,e,o,s,r,i;for(t.maRequired!=null&&(u="ma-dynamic-element required"),e="",e=t.type==="textarea"?'<textarea ng-disabled="maDisabled" '+(f?'disabled="disabled"':"")+' type="text" rows="3" name="{2}{3}" ng-model="{1}" class="validate ma-lang-content-item" ng-focus="event_Focus($event)" ng-blur="event_Blur($event)" '+u+' placeholder="{0}"/>':'<input ng-disabled="maDisabled" '+(f?'disabled="disabled"':"")+' type="text" name="{2}{3}" ng-model="{1}" class="validate ma-lang-content-item" ng-focus="event_Focus($event)" ng-blur="event_Blur($event)" '+u+' placeholder="{0}" />',o=[{text:"中文",id:"zh-CN"},{text:"English",id:"en"}],s="",r=0;r<o.length;r++)i=o[r],s+='<tr><td class="ma-lang-label"><span class="ma-lang-label-item">'+i.text+'<\/span><\/td><td class="ma-lang-content">'+e.fill(i.text,"languages['"+i.id+"']",t.name,i.id)+"<\/td><\/tr>";return"<table "+(f?'disabled="disabled"':"")+" "+(t.type||"")+' class="ma-lang">'+s+"<\/table>"},require:"ngModel",scope:{ngModel:"=",languageList:"=",maDisabled:"="},link:function(n,i,r){n.languages={"zh-CN":"",en:""};n.languageList=[];n.$watch("ngModel",function(i){t.getTextLangs({id:i}).then(function(t){var i,r;if(t==null){n.languages={"zh-CN":null,en:null};n.languageList=[];return}for(i=t.nameValues,r=0;r<i.length;r++)n.languages[i[r].name]=i[r].value;n.languageList=i})});n.$watch("languages",function(t){var r,i;n.languageList=n.languageList||[];r=0;for(i in t)t.hasOwnProperty(i)&&(n.languageList[r]={name:i,value:t[i]},r++)},!0);n.$watch("languageList",function(){n.languageList=n.languageList||[];var t=mabp.toObject(n.languageList);n.languages={"zh-CN":t["zh-CN"],en:t.en}},!0);n.event_Focus=function(n){$(n.currentTarget).parents("tr").addClass("active")};n.event_Blur=function(t){n.$parent.$eval(r.maBlur);$(t.currentTarget).parents("tr").removeClass("active")}}}}]);_shared.directive("maInformLanguage",["$compile","mabp.app.system","dialog",function(n,t,i){return{restrict:"EAC",replace:!0,template:function(n,t){var i="",r=t.disabled!=undefined&&t.disabled!=="false"?!0:!1,u,f;return t.maRequired!=null&&(i="ma-dynamic-element required"),u="",u=t.type==="textarea"?'<textarea ng-disabled="maDisabled" '+(r?'disabled="disabled"':"")+' type="text" rows="3" name="{2}{3}" ng-model="{1}" class="validate ma-lang-content-item" ng-focus="event_Focus($event)" ng-blur="event_Blur($event)" '+i+' placeholder="{0}"/>':'<input ng-disabled="maDisabled" '+(r?'disabled="disabled"':"")+' type="text" name="{2}{3}" ng-model="{1}" class="validate ma-lang-content-item" ng-focus="event_Focus($event)" ng-blur="event_Blur($event)" '+i+' placeholder="{0}" />',f="",f+='<tr ng-repeat="lang in defineLanguages "><td class="ma-lang-label"><span class="ma-lang-label-item">{{lang.text}}<\/span><\/td><td class="ma-lang-content input-group">'+u.fill("{{lang.text}}","languages[lang.id]",t.name,"{{lang.id}}")+'<span class="input-group-addon btn" ng-click="openColumn(lang.id)">+字段<\/span><\/td><\/tr>',"<table "+(r?'disabled="disabled"':"")+" "+(t.type||"")+' class="ma-lang">'+f+"<\/table>"},require:"ngModel",scope:{defineLanguages:"=",ngModel:"=",languageList:"=",maDisabled:"=",item:"="},compile:function(){return{pre:function(n){n.defineLanguages=[{text:"中文",id:"zh-CN"},{text:"English",id:"en"}];n.languages={"zh-CN":"",en:""};n.languageList=[]},post:function(n,r,u){n.$watch("ngModel",function(i){t.getTextLangs({id:i}).then(function(t){var i,r;if(t==null){n.languages={"zh-CN":null,en:null};n.languageList=[];return}for(i=t.nameValues,r=0;r<i.length;r++)n.languages[i[r].name]=i[r].value;n.languageList=i})});n.$watch("languages",function(t){var r,i;n.languageList=n.languageList||[];r=0;for(i in t)t.hasOwnProperty(i)&&(n.languageList[r]={name:i,value:t[i]},r++)},!0);n.event_Focus=function(n){$(n.currentTarget).parents("tr").addClass("active")};n.event_Blur=function(t){n.$parent.$eval(u.maBlur);$(t.currentTarget).parents("tr").removeClass("active")};n.openColumn=function(t){console.log(t);i.open(_shared.dialogs.formColumn,n.item).then(function(i){!i||(console.log(n.languages),_.forEach(n.languageList,function(r){r.name==t&&(r.value=(r.value||"")+"<%"+i.schemaName+"."+i.c_SchemaName+"%>",n.languages[t]=r.value)}))})};n.watch=function(){console.log("暂未实现")}}}}}}]);
/**** formHelper.js *****/
_shared.service("formHelper",["$timeout","fmTool","mabp.app.module","mabp.app.task","mabp.app.system","dialog","mabp.app.taskRead","mabp.app.user","mabp.app.permission","appSession","$pageDialog","$compile","mabp.app.file","mabp.app.data","$interval","$translate","$http",function(n,t,r,u,f,e,o,s,h,c,l,a,v,y,p,w,k){function tt(n,t){if(!/^([a-zA-Z0-9\.])+$/.test(n))return mabp.notify.error(L("CallFailed:MethodNameIsIncorrect{0}",n)),!1;if(t instanceof Array)return mabp.notify.error(L("CallFailed:ParameterCanOnlyBeASimpleObjectType")),!1;for(b in t)if(t[b])switch((typeof t[b]).toLowerCase()){case"string":case"int":case"number":continue;case"object":return mabp.notify.error(L("CallFailed:TheValueOfParameter{0}CanOnlyBeASimpleObjectType",b)),!1}return!0}function ut(n,t,i){mabp.openWin("/SysPages/NewTabDetailPage?origin={0}&param={1}".fill(JSON.stringify(n),JSON.stringify(t)),i)}var d={},nt=!1,it,g,rt;return d.controllerSv=function(n,t,i,r){k({method:n,url:t,data:i}).success(function(n){r(n)})},d.postMessage=function(n,t){nt&&console.log("formHelper："+n);this.postMessage({message:n,data:t},"*")},d.needValidation=function(n){return _.findIndex(["event_Submit","event_Resubmit","event_Agree"],function(t){return t===n.type})>-1},d.callSync=function(n,t,i){if(!tt(t,i))return!1;var r=mabp.toArray(i),u={pageId:n,params:{args:r},methodName:t},f=JSON.stringify(u);return this.postData("/api/module/Invoke",f)},d.postData=function(n,t){var i=null,r,u;return window.XMLHttpRequest?i=new XMLHttpRequest:window.ActiveXObject&&(i=new ActiveXObject("Microsoft.XMLHTTP")),r=null,u=function(){var n,t;i.readyState===4&&i.status===200&&(n=i.responseText,n&&(t=JSON.parse(n),console.log(t),r=t.result))},i!=null?(i.onreadystatechange=u,i.open("POST",n,!1),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(t)):alert("Your browser does not support XMLHTTP."),r},d.dateTimeNow=function(){return new Date(this.postData("/api/system/GetDateTimeNow",null))},d.callAsync=function(n,t,i,u,f){var e=mabp.toArray(i);return tt(t,i)?(f!=null&&f.type=="file"?r.invokeDownload({pageId:n,params:{args:e},methodName:t},{responseType:"blob"}).then(function(n){u(n)}):r.invoke({pageId:n,params:{args:e},methodName:t}).then(function(n){u(n)}),null):null},d.pageLoad=function(n,t){angular.isFunction(t.$page_load)&&(nt&&console.log("calling page_load "),t.$page_load())},d.pageLoaded=function(t,i){angular.isFunction(i.$page_loaded)&&n(function(){console.log("calling page_loaded ");i.$page_loaded()})},d.beforeCallEvent=function(n){var e=n.btn,t=n.form,u=n.base,f=!1,r=!1,i=function(){};switch(e.type){case"event_Submit":angular.isFunction(t.$event_submit_before)?i=t.$event_submit_before:r=!0;break;case"event_Resubmit":angular.isFunction(t.$event_resubmit_before)?i=t.$event_resubmit_before:r=!0;break;case"event_SaveToDraft":angular.isFunction(t.$event_saveToDraft_before)?i=t.$event_saveToDraft_before:r=!0;break;case"event_DeleteDraft":angular.isFunction(t.$event_DeleteDraft_before)?i=t.$event_DeleteDraft_before:r=!0;break;case"event_SaveForm":angular.isFunction(t.$event_SaveForm_before)?i=t.$event_SaveForm_before:r=!0;break;case"event_SaveToTemplate":angular.isFunction(t.$event_saveToTemplate_before)?i=t.$event_saveToTemplate_before:r=!0;break;case"event_Delete":angular.isFunction(t.$event_delete_before)?i=t.$event_delete_before:r=!0;f=!1;break;case"event_Agree":angular.isFunction(t.$event_agree_before)?i=t.$event_agree_before:r=!0;break;case"event_Reject":angular.isFunction(t.$event_reject_before)?i=t.$event_reject_before:r=!0;f=u.$rejectNeedMemo;break;case"event_TurnOver":angular.isFunction(t.$event_turnOver_before)?i=t.$event_turnOver_before:r=!0;break;case"event_Copy":angular.isFunction(t.$event_copy_before)?i=t.$event_copy_before:r=!0;break;case"event_Cancel":angular.isFunction(t.$event_cancel_before)?i=t.$event_cancel_before:r=!0;break;case"event_Waiting":angular.isFunction(t.$event_waiting_before)?i=t.$event_waiting_before:r=!0;break;case"event_Recede":angular.isFunction(t.$event_recede_before)?i=t.$event_recede_before:r=!0;break;case"event_RecedeToProposer":angular.isFunction(t.$event_recedeToProposer_before)?i=t.$event_recedeToProposer_before:r=!0;f=u.$rejectNeedMemo;break;case"event_RecedeToPreviousStep":angular.isFunction(t.$event_recedeToPreviousStep_before)?i=t.$event_recedeToPreviousStep_before:r=!0;f=u.$rejectNeedMemo;break;case"event_RecedeToAnyStep":angular.isFunction(t.$event_RecedeToAnyStep_before)?i=t.$event_RecedeToAnyStep_before:r=!0;f=u.$rejectNeedMemo;break;case"event_RecedeToSepcificStep":angular.isFunction(t.$event_recedeToSepcificStep_before)?i=t.$event_recedeToSepcificStep_before:r=!0;f=u.$rejectNeedMemo;break;case"event_event_AutoHandle":angular.isFunction(t.$event_autoHandle_before)?i=t.$event_autoHandle_before:r=!0;break;case"event_And":angular.isFunction(t.$event_and_before)?i=t.$event_and_before:r=!0;break;case"event_Connect":angular.isFunction(t.$event_connect_before)?i=t.$event_connect_before:r=!0;break;case"event_Judge":angular.isFunction(t.$event_judge_before)?i=t.$event_judge_before:r=!0;break;case"event_Finish":angular.isFunction(t.$event_finish_before)?i=t.$event_finish_before:r=!0;break;case"event_Print":angular.isFunction(t.$event_print_before)?i=t.$event_print_before:window.open("/Pages/Wf?nodeId={0}&pageId={1}&jobId={2}&taskId={3}&procId={4}&draftId={5}&areaCode={6}&isPrint={7}".fill(u.nodeId,u.pageId,u.jobId,u.taskId,"","",u.areaCode,"1"));break;default:return n.$continue()}return!u.memo&&f?(mabp.notify.error(L("PleaseWriteApprovalOpinion")),n.$stop()):(i(n),r?n.$continue():void 0)},d.prepareFormDataAndExecute=function(n,t,i){var u=t.base,f=t.form,r={tables:{},files:[],variables:[],returnToNodes:[]},e,o;u.aliasTables!=null&&(_.forEach(u.aliasTables,function(n){var t="";t=n.isMainTable?f[n.aliasName]:f[n.aliasName];r.tables[n.aliasName]=t}),r.tableJson=JSON.stringify(r.tables));u.aliasTables!=null&&_.forEach(u.aliasTables,function(n){var t=[],i,u;if(n.isMainTable)t=mabp.toArray(f[n.aliasName]);else{for(i=0;i<f[n.aliasName].length;i++)u=f[n.aliasName][i],t.push(mabp.toDetailArray(u,i));t=_.reduce(t,function(n,t){return n.concat(t)})}r.tables[n.aliasName]=t});r.fileJson=JSON.stringify(f.$attachments);e=mabp.toArray({applicant:u.applicant});e=e.concat(mabp.toArray({memo:u.memo}));e=e.concat(mabp.toArray({areaCode:u.areaCode}));r.baseJson=JSON.stringify(e);r.topic=u.topic;r.nodeId=u.nodeId;r.jobId=u.jobId;r.areaCode=u.areaCode;r.applicantId=u.applicant.userId;r.applicantJobId=u.applicant.jobId;r.wfId=u.workflowId;r.nextProcId=u.nextProcId;r.procId=u.procId;r.pageId=u.pageId;r.actionText=n.name;r.actionId=n.id;r.actionType=n.type;r.draftId=u.draftId;r.files=f.$attachments;r.procId=u.procId;r.taskId=u.taskId;r.memo=u.memo;o=this;this.preHandler(r,n,function(){o.callEvent(n,r,f,function(n){i(n)})})},d.preHandler=function(n,t,i){n.actionType==="event_AdditionalSigner"?o.getPreProcessor(n).then(function(r){r!=null&&r.length>0?e.open(_shared.dialogs.preProcessorDialog,r).then(function(t){t!=null&&t.length>0&&(n.variables=n.variables.concat(t),i(t))}):mabp.notify.error(L("No{0}HandlerConfigured",t.name))}):n.actionType==="event_TurnOver"?t.forwardType==0?e.open(_shared.dialogs.jobUserDialog,{enterpriseId:null}).then(function(r){r?(n.forwardToJobUserId=r[0].jobUserId,i(r)):mabp.notify.error(L("NoChoiceFor{0}Staff",t.name))}):t.forwardValue?i():mabp.notify.error(L("PleaseConfigureTheHandler")):n.actionType==="event_RecedeToAnyStep"?o.getHandledNodes(n).then(function(r){r!=null&&r.length>0?e.open(_shared.dialogs.workflowNodeDialog,{data:r,noLoadData:!0}).then(function(r){r?(n.returnToNodes.push(r.id),i(r)):mabp.notify.error(L("NoNodeSelectedFor{0}",t.name))}):mabp.notify.error(L("NoNodeFor{0}ToChoise",t.name))}):n.actionType==="event_Copy"?e.open(_shared.dialogs.maUserSelectDialog,{ismulti:!0,initSelectData:null}).then(function(r){if(n.userIds=[],n.sharedNameList=[],!r)mabp.notify.error(L("NoChoiceFor{0}Staff",t.name));else{for(var u=0;u<r.length;u++)n.userIds.push(r[u].id),n.sharedNameList.push(r[u].name);n.sharedNames=n.sharedNameList.toString();i(r)}}):n.actionType!=="event_SaveToDraft"&&n.actionType!=="event_SaveToTemplate"||n.topic?i():e.open(_shared.dialogs.topicDialog,{topic:n.topic}).then(function(t){!t||(t.topic?(n.topic=t.topic,i(t)):mabp.notify.error(L("PleaseWriteTheTheme")))})},d.callEvent=function(n,t,i,r){var f=null;switch(n.type){case"event_Submit":f=u.event_Submit(t).then(function(n){r(n);mabp.notify.success(L("PleaseWaitTheApprovalOf{0},SubmitSuccessfully",n.nextProcUsers));angular.isFunction(i.event_Submit_after)&&(console.log("调用event_Submit_after "+i.event_Submit_after(t)),console.log("after已调用"))});break;case"event_SaveToDraft":f=u.event_SaveToDraft(t).then(function(n){mabp.notify.success(L("SaveDraftSuccessfully"));r(n)});break;case"event_DeleteDraft":f=u.event_DeleteDraft(t).then(function(n){mabp.notify.success(L("DeleteDraftSuccessfully"));r(n)});break;case"event_SaveForm":f=u.event_SaveForm(t).then(function(n){mabp.notify.success(L("SaveSuccess"));r(n)});break;case"event_SaveToTemplate":f=u.event_SaveToTemplate(t).then(function(n){mabp.notify.success(L("SaveTemplateSucessfully"));r(n)});break;case"event_Delete":f=u.event_Delete(t).then(function(n){mabp.notify.success(L("DeleteSuccess"));r(n)});break;case"event_Agree":f=u.event_Agree(t).then(function(n){n.haveEndProc?mabp.notify.success(L("ApprovalFinished")):n.nextProcUsers==""||n.nextProcUsers==null?mabp.notify.success(L("PleaseWaitTheApprovalOfOtherProcessor,submitSuccessfully")):mabp.notify.success(L("SubmitSuccessfully,nextProcessorIs[{0}]",n.nextProcUsers));r(n)});break;case"event_Reject":f=u.event_Reject(t).then(function(n){mabp.notify.success(L("ProcessRejected"));r(n)});break;case"event_TurnOver":f=u.event_TurnOver(t).then(function(t){mabp.notify.success(L("{0}[{1}]Success",n.name,t.nextProcUsers));r(t)});break;case"event_Copy":u.event_Copy(t).then(function(i){mabp.notify.success(L("{0}[{1}]Success",n.name,t.sharedNames));r(i)});break;case"event_Cancel":u.event_Cancel(t).then(function(n){mabp.notify.success(L("CancelTaskSuccessfully"));r(n)});break;case"event_Waiting":u.event_Waiting(t).then(function(n){mabp.notify.success(L("SuspendTaskSuccessfully"));r(n)});break;case"event_Recede":u.event_Recede(t).then(function(n){mabp.notify.success(L("WithdralTaskSuccessfully"));r(n)});break;case"event_RecedeToProposer":f=u.event_RecedeToProposer(t).then(function(n){n.nextProcUsers?mabp.notify.success(L("Return[{0}]Successfully",n.nextProcUsers)):mabp.notify.success(L("ReturnToFailure"));r(n)});break;case"event_RecedeToPreviousStep":f=u.event_RecedeToPreviousStep(t).then(function(n){mabp.notify.success(L("ReturnLastStepSuccessfully"));r(n)});break;case"event_RecedeToAnyStep":f=u.event_RecedeToAnyStep(t).then(function(n){n.nextProcUsers?mabp.notify.success(L("Return[{0}]Successfully",n.nextProcUsers)):mabp.notify.success(L("ReturnToFailure"));r(n)});break;case"event_RecedeToSepcificStep":f=u.event_RecedeToSepcificStep(t).then(function(n){n.nextProcUsers?mabp.notify.success(L("Return[{0}]Successfully",n.nextProcUsers)):mabp.notify.success(L("ReturnToFailure"));r(n)});break;case"event_Test":setTimeout(d.TestEvent(n,t,i),2e3);break;case"event_AdditionalSigner":f=u.event_AdditionalSigner(t).then(function(n){n.haveEndProc?mabp.notify.success(L("ApprovalFinished")):mabp.notify.success(L("SubmitSuccessfully,nextProcessorIs[{0}]",n.nextProcUsers));r(n)});break;case"event_Custome":!n.func||n.func()}!f||(mabp.ui.setBusying(".fm-form-block",f),mabp.ui.setSaving(n.id,f))},d.TestEvent=function(n,t,i,r){t.procId?u.getTopHandleProcInTask({Id:t.taskId?t.taskId:t.procId}).then(function(f){f.length==0?(mabp.notify.success(L("NoNextProcessor")),angular.isFunction(r)&&r(f)):(t.procId=f[0],u.event_Agree(t).then(function(u){if(!u.haveEndProc)u.nextProcUsers==""||u.nextProcUsers==null?mabp.notify.success(L("PleaseWaitTheApprovalOfOtherProcessor,submitSuccessfully")):mabp.notify.success(L("SubmitSuccessfully,nextProcessorIs[{0}]",u.nextProcUsers));else{mabp.notify.success(L("ApprovalFinished"));return}t.taskId=u.taskId;setTimeout(d.TestEvent(n,t,i),2e3);angular.isFunction(r)&&r(u)}))}):saving=u.event_Submit(t).then(function(u){mabp.notify.success(L("PleaseWaitTheApprovalOf{0},SubmitSuccessfully",u.nextProcUsers));angular.isFunction(i.event_Submit_after)&&(console.log("调用event_Submit_after "+i.event_Submit_after(t)),console.log("after已调用"));t.taskId=u.taskId;t.procId="下一步";t.memo="测试自动审批";setTimeout(d.TestEvent(n,t,i),2e3);angular.isFunction(r)&&r(u)})},d.validate=function(n){var t=n.form;return(t.$errors=[],this.doFormValidate(n),angular.isFunction(t.$doValidation)&&t.$doValidation(),t.$errors!=null&&t.$errors.length>0)?(this.showError(t.$errors),!1):!0},d.doFormValidate=function(n){for(var f,o,e,u,v,l,r,tt,a=n.base,d=n.form,k=$(".fm-content .normal[fm-model]"),i=[],t=0;t<k.length;t++)f=$(k[t]),i.push({element:$(k[t]),v:f.attr("fm-model"),isR:f.attr("required")=="required",vn:f.attr("field-name"),minv:f.attr("min-value"),maxv:f.attr("max-value"),minl:f.attr("min-length"),maxl:f.attr("max-length"),pattern:f.attr("pattern"),vd:f.parents("[detail-name]").attr("detail-name"),vt:f.attr("fm-text-model")});for(o=[],t=0;t<i.length;t++){var y=i[t].element.parents("[ng-repeat]"),r=null,p=null,s=!1,h=null;if(y.length==0)r=n.$eval(i[t].v),p=n.$eval(i[t].vt);else if(i[t].element.attr("linenum")!=undefined)e=i[t].element.attr("linenum"),r=n.$eval(i[t].element.attr("fm-model").replace("$index",e)),p=n.$eval((i[t].element.attr("fm-text-model")||"").replace("$index",e));else{e=-1;u=y.attr("ng-repeat");u.indexOf("track")>-1&&(u=u.substring(0,u.indexOf("track")-1));var b=u.indexOf("|"),c=u,g={},nt="",w="";for(b>0&&(c=u.substr(0,b-1),nt=u.substring(u.indexOf("{")+1,u.lastIndexOf(":")).trim(),w=n.$eval(u.substring(u.lastIndexOf(":")+1,u.length-1).trim()),w||(w=y.attr("filter-value")),g[nt]=w),v=$("[ng-repeat*='"+c+"']"),b>0&&(v=$("[ng-repeat*='"+c+"'][filter-value='"+w+"']")),l=0;l<v.length;l++)v[l].$$hashKey?v[l].$$hashKey==y[0].$$hashKey&&(e=l):v[l].innerText==y[0].innerText&&(e=l);c=c.substr(c.lastIndexOf(" ")+1);r=n.$eval(c+"["+e+"]."+i[t].v.substr(i[t].v.lastIndexOf(".")+1));b>0&&(tt=_.filter(n.$eval(c),g),r=tt[e][i[t].v.substr(i[t].v.lastIndexOf(".")+1)]);p=i[t].vt===undefined?undefined:n.$eval(u+"["+e+"]."+i[t].vt.substr(i[t].vt.lastIndexOf(".")+1));s=!0;h=e+1}i[t].isR&&(p!==undefined?p===""&&r===""&&o.push({element:i[t].element,id:i[t].v,msg:(s?i[t].vd+"第"+h+"行 ":"")+i[t].vn+a.ruleL.isrequired}):(r==undefined||r==="")&&o.push({element:i[t].element,id:i[t].v,msg:(s?i[t].vd+"第"+h+"行 ":"")+i[t].vn+a.ruleL.isrequired}));i[t].maxl!=undefined&&r!=undefined&&parseInt(i[t].maxl)<(r||"").length&&o.push({element:i[t].element,id:i[t].v,msg:(s?i[t].vd+"第"+h+"行 ":"")+i[t].vn+a.ruleL.lengthcannotlager+i[t].maxl});i[t].minl!=undefined&&r!=undefined&&parseInt(i[t].minl)>(r||"").length&&o.push({element:i[t].element,id:i[t].v,msg:(s?i[t].vd+"第"+h+"行 ":"")+i[t].vn+a.ruleL.lengthcannotlesser+i[t].minl});i[t].minv!=undefined&&(isNaN(r)||parseFloat(i[t].minv)>parseFloat(r)&&o.push({element:i[t].element,id:i[t].v,msg:(s?i[t].vd+"第"+h+"行 ":"")+i[t].vn+a.ruleL.valuecannotlesser+i[t].minv}));i[t].maxv!=undefined&&(isNaN(r)||parseFloat(i[t].maxv)<parseFloat(r)&&o.push({element:i[t].element,id:i[t].v,msg:(s?i[t].vd+"第"+h+"行 ":"")+i[t].vn+a.ruleL.valuecannotlager+i[t].maxv}));i[t].pattern!=undefined&&(r==undefined||r==""||new RegExp(i[t].pattern).test(""+r)||o.push({element:i[t].element,id:i[t].v,msg:(s?i[t].vd+"第"+h+"行 ":"")+i[t].vn+a.ruleL.pattern}))}d.$errors=d.$errors.concat(o)},d.showError=function(n){_.each(n,function(n){n.element.addClass("fm-has-error");$(n.element).one("mousedown",function(){$(this).removeClass("fm-has-error")})})},d.submit=function(n,t,i){var e=t.base,o=t.form,u,r,f;($(".fm-has-error").removeClass("fm-has-error"),!this.needValidation(n)||(u=this.validate(t),u))&&(r=this,f={btn:n,base:e,form:o,$stop:function(){},$continue:function(){n.noConfirm?r.prepareFormDataAndExecute(n,t,i):mabp.message.confirm({"zh-CN":"点击确定后将 "+n.name,en:"Click to "+n.name},{"zh-CN":"确认-"+n.name,en:n.name},function(u){u&&r.prepareFormDataAndExecute(n,t,i)})}},r.beforeCallEvent(f))},d.getTaskData=function(n){var t=n.base,u=n.form,r,i;(t.taskId||!!t.draftId)&&(r=t.formBody,!r||r=="{}"||(i=JSON.parse(r),_.forEach(t.aliasTables,function(r){if(r.isMainTable){var f=null;f=t.draftId?i[r.aliasName]:i[r.aliasName].length>0?i[r.aliasName][0]:{};u[r.aliasName]=f;n.$initial[r.aliasName]=angular.copy(f);t.snNumber=t.snNumber||f&&f.snNumber;t.applyDate=t.applyDate||f&&f.creationTime;t.isFromAutoPost=f&&f.isFromAutoPost||!1}else u[r.aliasName]=i[r.aliasName],n.$initial[r.aliasName]=angular.copy(i[r.aliasName])})))},d.getPageRight=function(n){var u=n.base,r=n.form,t=u.pageRight;for(i in t)r.$pageRight[i.upperFirst()]=t[i],r.$pageRight[i]=t[i]},d.getPageLang=function(n){var t=n.base,u=n.form,f=t.displayLanguages?t.displayLanguages.split(",")[0]:app.language,r;t.$pageLang=MultiL(f);r=t.pageLanguages;for(i in r)u.$pageLang[i.upperFirst()]=r[i],u.$pageLang[i]=r[i]},d.getActionButton=function(n){var t=n.base,i=t.formAction;t.actionButtons=_.filter(i,{displayLanguages:t.language});t.taskId||_.remove(t.actionButtons,function(n){return n.type=="event_Delete"});t.pageState==1&&t.isWaiting==1&&_.remove(t.actionButtons,function(n){return n.type=="event_Waiting"})},d.getMoreActionButton=function(n){var i=n.base,t,r;if(!i.nextProcId||i.actionButtons.push({type:"event_Recede",name:"撤回",id:"1"}),!i.draftId||i.actionButtons.push({type:"event_DeleteDraft",name:L("DeleteDraft"),id:"2"}),!!n.form.$customeButtons)for(t=0;t<n.form.$customeButtons.length;t++)r=_.findIndex(i.actionButtons,{type:n.form.$customeButtons[t].type})>-1,r||i.actionButtons.push({type:n.form.$customeButtons[t].type,name:n.form.$customeButtons[t].name,id:(3+t).toString(),func:n.form.$customeButtons[t].func})},d.syncTasks=function(){function f(){for(var n=0;n<i.length;n++)if(i[n].complete==!1)return!1;return u.resolve(!0),!0}function e(n){var t=n.task;t.promise&&(t.promise.always?t.promise.always(function(){n.complete=!0;f()}):t.promise["finally"]&&t.promise["finally"](function(){n.complete=!0;f()}))}for(var r,u=$.Deferred(),t=arguments,i=[],n=0;n<t.length;n++)t[n]!=null&&(t[n].always||t[n]["finally"])&&(t[n]={promise:t[n]},i.push({id:n,task:t[n],complete:!1}));for(r=0;r<i.length;r++)e(i[r]);return u.promise()},d.getHeaderInfo=function(n){if(n.base.taskStatus=-1,!n.base.taskId||n.base.draftId){if(!n.base.draftId)return o.getUserInfo({jobId:n.base.applicantJobId}).then(function(t){n.base.initiator={jobId:t.jobId,groupId:t.groupId,userId:t.userId,directManagerJobId:t.directManagerJobId,department:t.department,userName:t.userName,employeeNumber:t.employeeNumber,departmentName:t.departmentName,contactNumber:t.telephone,mobileNumber:t.cellPhone,emailAddress:t.emailAddress,directManagerName:t.directManagerName,areaCode:t.areaCode};n.base.applicant={jobId:t.jobId,groupId:t.groupId,userId:t.userId,directManagerJobId:t.directManagerJobId,userName:t.userName,employeeNumber:t.employeeNumber,departmentName:t.departmentName,contactNumber:t.telephone,mobileNumber:t.cellPhone,emailAddress:t.emailAddress,directManagerName:t.directManagerName,areaCode:t.areaCode}});o.getDraftFormHeaderInfo({draftId:n.base.draftId}).then(function(t){if(!!t){var i=mabp.toObject(JSON.parse(t));i.applicant&&(n.base.applicant=i.applicant);n.base.memo=i.memo;n.base.areaCode=i.areaCode}});o.getUserInfo({jobId:n.base.applicantJobId}).then(function(t){n.base.initiator={jobId:t.jobId,groupId:t.groupId,userId:t.userId,directManagerJobId:t.directManagerJobId,department:t.department,userName:t.userName,employeeNumber:t.employeeNumber,departmentName:t.departmentName,contactNumber:t.telephone,mobileNumber:t.cellPhone,emailAddress:t.emailAddress,directManagerName:t.directManagerName,areaCode:t.areaCode}})}else{var t=n.base.formHeader;if(!t||!t.applicantJobId)return o.getUserInfo({jobId:n.base.applicantJobId}).then(function(t){n.base.initiator={userId:t.userId,jobId:t.jobId,groupId:t.groupId,directManagerJobId:t.directManagerJobId,userName:t.userName,jobName:t.jobName,groupName:t.jobName,directManagerName:t.directManagerName,departmentName:t.departmentName,employeeNumber:t.employeeNumber,contactNumber:t.telephone,mobileNumber:t.cellPhone,emailAddress:t.emailAddress,areaCode:t.areaCode};n.base.applicant={userId:t.userId,jobId:t.jobId,groupId:t.groupId,directManagerJobId:t.directManagerJobId,userName:t.userName,jobName:t.jobName,groupName:t.jobName,directManagerName:t.directManagerName,departmentName:t.departmentName,employeeNumber:t.employeeNumber,contactNumber:t.telephone,mobileNumber:t.cellPhone,emailAddress:t.emailAddress,areaCode:t.areaCode}});n.base.taskStatus=t.taskStatus;n.base.initiator={userId:t.initiatorId,jobId:t.initiatorJobId,groupId:t.initiatorGroupId,directManagerJobId:t.initiatorDirectManagerJobId,userName:t.initiatorName,jobName:t.initiatorJobName,groupName:t.initiatorGroupName,directManagerName:t.initiatorDirectManagerName,departmentName:t.initiatorDepartmentName,employeeNumber:t.initiatorEmployeeNumber,contactNumber:t.initiatorContactNumber,mobileNumber:t.initiatorMobileNumber,emailAddress:t.initiatorEmailAddress,areaCode:t.initiatorAreaCode};n.base.applicant={userId:t.applicantId,jobId:t.applicantJobId,groupId:t.applicantGroupId,directManagerJobId:t.applicantDirectManagerJobId,userName:t.applicantUserName,jobName:t.applicantJobName,groupName:t.applicantGroupName,directManagerName:t.applicantDirectManagerName,departmentName:t.applicantDepartmentName,employeeNumber:t.applicantEmployeeNumber,contactNumber:t.applicantContactNumber,mobileNumber:t.applicantMobileNumber,emailAddress:t.applicantEmailAddress,areaCode:t.applicantAreaCode}}},d.getPageBasicDataAndViewData=function(n){var t=n.base;if(t.taskId)return r.getPageBasicDataAndViewData({taskId:t.taskId,nodeId:t.nodeId,procId:t.procId,draftId:t.draftId,pageId:t.pageId}).then(function(t){if(!!t)for(var i=0;i<t.length;i++)n.base.basicAndViewData[t[i].source]=t[i].data})},d.getUserCompanyPermission=function(n){var t=n.base,i;t.areaEnable&&!t.taskId&&(i=t.companyPermission,!i||(t.areaCodeList=i))},it=function(n,t,i,r,u){var f={};f.pageId=t.pageId;f.parentPageId=t.pageId;f.moduleId=t.moduleId;f.fileName=n;f.displayLanguages=t.displayLanguages;f.nodeId=t.nodeId;f.pageState=t.pageState;f.areaCode=t.areaCode;f.areaEnable=t.areaEnable;f.areaCodeList=t.areaCodeList;f.applicantJobId=t.applicantJobId;f.currentUserId=t.currentUserId;f.draftId=t.draftId;f.taskStatus=t.taskStatus;f.taskId=t.taskId;f.isPrint=t.isPrint;f.isPdf=t.isPdf;f.jobId=t.jobId;f.procId=t.procId;f.isNewTab=!0;ut(f,r,u)},d.buildForm=function(t){t.$initial={};t.$initial.$initaled={};return{$pageRight:{},$pageLang:{},$attachments:[],$state:{},$errors:[],$timeout:n,$watch:function(n,i,r){t.$watch(n,i,r)},$alert:function(n){mabp.notify.error(n)},$toast:function(n){mabp.notify.error(n)},$openDialog:function(n,i,r,u){l.open(n,t.base,t.form,i,r,u)},$confirm:mabp.message.confirm,$checkAll:function(n,t){if(!!t&&t.length>0)for(var i=0;i<t.length;i++)t[i].checked=!!n},$openNewWin:function(n,i,r){it(n,t.base,t.form,i,r)}}},d.pageStart=function(i,u,f,s){var h=this,l;u.$nodeCode=i.nodeCode;i.aliasTables!=null&&_.forEach(i.aliasTables,function(n){u[n.aliasName]=n.isMainTable?{}:[]});l=new mabp.ui.loader(".entire-block");l.start();h.getTaskData(f);h.getPageRight(f);h.getPageLang(f);h.getActionButton(f);h.getHeaderInfo(f);h.getUserCompanyPermission(f);s.title=i.applicant||i.applicant.userName?i.title:i.applicant.userName+"的"+i.title;n(function(){i.currentUserId=c.userId;i.areaCode||i.areaEnable||(i.areaCode=i.applicant.areaCode);try{eval(i.js);function t(n,t,r,u){if(angular.isFunction(r))h.callAsync(i.pageId,n,t,r,u);else return h.callSync(i.pageId,n,t);return null}controller(i,u,t)}catch(r){mabp.notify.error(r)}h.pageLoad(i,u);d.getMoreActionButton(f);var e=a("<fm-cache>"+i.html+"<\/fm-cache>")(f);angular.element(".fm-content").html(e);l.stop();h.pageLoaded(i,u);i.isPrint===!0&&n(function(){window.print()},2500)},200);i.submit=function(n){h.submit(n,f,function(){i.close(!0)})};i.showErrorControl=function(n){var i=$(n.element).offset(),t=$(n.element).parents(".entire-block");t.animate({scrollTop:t.scrollTop()+i.top-100},300,"linear",function(){$(n.element).removeClass("fm-has-error");setTimeout(function(){$(n.element).addClass("fm-has-error");setTimeout(function(){$(n.element).removeClass("fm-has-error");setTimeout(function(){$(n.element).addClass("fm-has-error")},300)},300)},300)})};i.$readViewData=function(n,i,r){t.getView(n,i,function(n){var t=n.viewTable,i=n.viewName;!r||r(t)})};i.$approveInfo=function(){var t,n,r;if(!!i.taskId)for(t=i.formHistory,i.$approveInfoList=[],n=0;n<t.length;n++)r=t[n].procUserName+"　　"+new Date(t[n].approveDate).format("yyyy-MM-dd"),!t[n].jobCode||i.$approveInfoList[t[n].jobCode]||(i.$approveInfoList[t[n].jobCode]=r),!t[n].nodeCode||(i.$approveInfoList[t[n].nodeCode]=!i.$approveInfoList[t[n].nodeCode]?r:i.$approveInfoList[t[n].nodeCode]+"\n"+r)};i.$approveInfo();i.$getBasicData=function(n,t){r.getBasicData({code:n}).then(function(n){!n||!t||t(n)})};i.$selectApplicant=function(){e.open(_shared.dialogs.formSelect,{datatype:"service",jobId:i.jobId,wfdWorkflowId:i.workflowId}).then(function(n){var t=i.jobId,r=null;!n||!n.items[n.selectItem]||(t=n.items[n.selectItem].applicantJobId,r=n.items[n.selectItem].applicantUserId);o.getUserInfo({jobId:t,userId:r}).then(function(n){i.applicant={jobId:n.jobId,groupId:n.groupId,userId:n.userId,directManagerJobId:n.directManagerJobId,department:n.department,userName:n.userName,employeeNumber:n.employeeNumber,departmentName:n.departmentName,contactNumber:n.telephone,mobileNumber:n.cellPhone,emailAddress:n.emailAddress,directManagerName:n.directManagerName}})})}},d.getUserInfo=function(n){var t=n.base;return s.getCurrentUserUserJobGroup({JobId:t.jobId}).then(function(n){!n||(t.areaCode=n.areaCode)})},g=/^\d{4}-\d{2}-\d{2}[T]([01]?\d|2[0-3]):[0-5]?\d:[0-5]?\d.\d?\d?\d?$/,d.initReportTable=function(n,t,i,u,f,e){u?r.getViewTable({code:n,filters:mabp.toArray(t),pageInput:u}).then(function(n){var o,t,r,u;if(!!n){if(!i){for(o={},e.$column=[],e.$columnText=[],t=0;t<n.displayColumList.length;t++)n.displayColumList[t].displayColumn=n.displayColumList[t].displayColumn.substring(0,1).toLowerCase()+n.displayColumList[t].displayColumn.substring(1),o[n.displayColumList[t].displayColumn]=n.displayColumList[t].name;r=o;for(u in r)r.hasOwnProperty(u)&&(e.$column.push(u),e.$columnText.push(r[u]))}_.forEach(e.$column,function(t){_.forEach(n.viewTable,function(n){g.test(n[t])&&(n[t]=moment(n[t]).format("YYYY-MM-DD"))})});f&&f(n)}}):r.getViewTable({code:n,filters:mabp.toArray(t)}).then(function(n){var o,t,r,u;if(!!n){if(!i){for(o={},t=0;t<n.displayColumList.length;t++)n.displayColumList[t].displayColumn=n.displayColumList[t].displayColumn.substring(0,1).toLowerCase()+n.displayColumList[t].displayColumn.substring(1),o[n.displayColumList[t].displayColumn]=n.displayColumList[t].name;r=o;for(u in r)r.hasOwnProperty(u)&&(e.$column.push(u),e.$columnText.push(r[u]))}_.forEach(e.$column,function(t){_.forEach(n.viewTable,function(n){g.test(n[t])&&(n[t]=moment(n[t]).format("YYYY-MM-DD"))})});f&&f(n)}})},d.initBasicData=function(n,t,i){var r=[],u=[],f=[];_.forEach(n.aliasTables,function(n){r.push({key:n,value:mabp.toArray(t[n].filter)});u.push({key:n,value:mabp.toArray(t[n].exactFilter)});f.push({key:n,page:t[n].paging})});y.getFormData({aliasName:i,pageId:n.pageId,pages:f,dictFilters:r,dictExactFilters:u}).then(function(r){var u=JSON.parse(r.datas),f=JSON.parse(r.totalCounts);i?(t[i].datas=JSON.stringify(u)=="{}"?{}:u[i],t[i].paging.totalCount=JSON.stringify(f)=="{}"?{}:f[i]):_.forEach(n.aliasTables,function(n){t[n].datas=u[n];t[n].paging.totalCount=f[n]})})},d.prepaddareBasicDataAndExecute=function(n,t){var i={tables:{}};_.forEach(base.aliasTables,function(t){i.tables[t.aliasName]=mabp.toArray(n)});i.id=n.id;i.pageId=base.pageId;y.saveBasicData(i).then(function(){t.$load()})},d.deleteBasicData=function(n,t,i){var r={tables:{}};_.forEach(n.aliasTables,function(n){r.tables[n]=mabp.toArray(t)});r.id=t.id;r.pageId=n.pageId;y.deleteBasicData(r).then(function(){i.$load()})},d.downloadBasicData=function(n,t){var i=[],r=[],u=[];_.forEach(n.aliasTables,function(n){i.push({key:n,value:mabp.toArray(t[n].filter)});r.push({key:n,value:mabp.toArray(t[n].exactFilter)});u.push({key:n,page:t[n].paging})});v.downloadBasicData({pageId:n.pageId,pages:u,dictFilters:i,dictExactFilters:r},{responseType:"blob"})},rt=_.debounce(function(t,i,r,u){t.aliasTables!=null&&_.forEach(t.aliasTables,function(n){i[n]=[]});var f=new mabp.ui.loader(".entire-block");f.start();u.title=t.title;n(function(){t.currentUserId=c.userId;try{eval(t.js);function n(n,i,r,u){if(angular.isFunction(r))d.callAsync(t.pageId,n,i,r,u);else return d.callSync(t.pageId,n,i);return null}controller(t,i,n);d.pageLoad(t,i)}catch(u){mabp.notify.error(u)}var e=a("<fm-cache>"+t.html+"<\/fm-cache>")(r);angular.element(".page_content").html(e);f.stop();that.pageLoaded(t,i)},200)},200),d.pageStart2=function(n,t,i,r){rt(n,t,i,r)},d}]);
/**** moduleHandler.js *****/
_shared.service("moduleHandler",["asdialog","dialog","mabp.app.module","appSession","$rootScope","basicDataModuleTransfer","reportModuleTransfer","workflowModuleTransfer",function(n,t,i,r,u,f,e,o){var s={};return s.getNum=function(){return $(".data_load").find(".orangered").length>=6?!1:!0},s.approve=o.approve,s.checkout=o.checkout,s.setFavourite=function(n,t){n.moduleId=n.id;n.isFavourite=n.isFavourite==0?1:0;this.getNum()===!1&&n.isFavourite?(mabp.notify.success("常用流程已到上限"),n.isFavourite=n.isFavourite==0?1:0):(i.setFavouriteModule(n).then(function(){n.isFavourite?this.getNum()===!1?(mabp.notify.success(L("AddToCommonWorkflowSuccessfullyUpToMax")),n.isFavourite=n.isFavourite==0?1:0):mabp.notify.success(L("AddToCommonWorkflowSuccessfully")):mabp.notify.success(L("RemoveFromCommonWorkflowSuccessfully"))},function(){}),t.stopPropagation())},s.open=function(n){var t={};switch(n.type){case 1:t=f.open(n);break;case 2:t=e.open(n);break;case 3:t=o.raise(n.indexPageId,n.indexNodeId);break;default:console.error("No handled module Type")}return t},s}]);
/**** page.dialog.js *****/
(function(){var n=_shared.dialogs.define("$pageDialog","/App/_shared_mobile/module/page.dialog.html");_shared.controller(n,["$scope","params","mabp.app.workflow","mabp.app.data","formHelper","$compile","$timeout","$pageDialog",function(n,t,i,r,u,f,e,o){var c=this,h=t||{pageData:{}},s=n.base={basicAndViewData:h.base.basicAndViewData,pageId:h.base.pageId,parentPageId:h.base.pageId,fileName:h.base.fileName,size:h.base.size||"md",js:h.pageData.pcController,html:h.pageData.pcHtml,title:h.pageData.pageName,aliasTables:h.pageData.aliasTables,close:function(t){n.$close(t)},$pageLang:mabp.localization["Bpm."+app.language],ruleL:_shared.languageSetting.defaultRules[app.language],language:app.language,parameter:h.param},l=n.form={$openDialog:function(t,i,r,u){o.open(t,n.base,i,r,u)},$save:function(n){c.prepaddareBasicDataAndExecute(n)},$delete:function(n){c.delete(n)},$toast:function(n){mabp.notify.error(n)}};e(function(){function t(n,t,i){if(angular.isFunction(i))u.callAsync(s.parentPageId,n,t,i);else return u.callSync(s.parentPageId,n,t);return null}eval(s.js);controller(s,l,t);var i=f(s.html)(n);angular.element("._page-dialog").html(i);u.pageLoad(s,l);c.isLoaded=!0;u.pageLoaded(s,l);$(".entire-block").css("visibility","visible")},200);c.prepaddareBasicDataAndExecute=function(t){var f,i;($(".fm-has-error").removeClass("fm-has-error"),f=u.validate(n),f)&&(i={tables:{}},_.forEach(s.aliasTables,function(n){i.tables[n.aliasName]=mabp.toArray(t)}),i.id=t.id,i.pageId=s.pageId,r.saveBasicData(i).then(function(){l.$toast("保存成功");s.close(!0)}))};c.delete=function(n){var t={tables:{}};_.forEach(s.aliasTables,function(i){t.tables[i.aliasName]=mabp.toArray(n)});t.id=n.id;t.pageId=s.pageId;r.deleteBasicData(t).then(function(){l.$toast("删除成功");s.close(!0)})};s.showErrorControl=function(n){var i=$(n.element).offset(),t=$(n.element).parents(".entire-block");t.animate({scrollTop:t.scrollTop()+i.top-100},300,"linear",function(){$(n.element).removeClass("fm-has-error");setTimeout(function(){$(n.element).addClass("fm-has-error");setTimeout(function(){$(n.element).removeClass("fm-has-error");setTimeout(function(){$(n.element).addClass("fm-has-error")},300)},300)},300)})}}]);_shared.service("$pageDialog",["mabp.app.module","dialog",function(n,t){var i={};return i.open=function(i,r,u,f,e){r.size=e&&e.size;n.getSubPage({parentPageId:r.pageId,moduleId:r.moduleId,fileName:i}).then(function(n){var e={fileName:i,base:r,param:u,pageData:n};e.pageData.pageName=r.titleNew===undefined?e.pageData.pageName:r.titleNew;t.open(_shared.dialogs.$pageDialog,e).then(function(n){f&&f(n)})})},i}])})();
/**** topic.dialog.js *****/
(function(){var n=_shared.dialogs.define("topicDialog","/App/_shared_mobile/module/topic.dialog.html");_shared.controller(n,["params","$scope",function(n,t){var i=this;i.model=n;i.save=function(){i.model.topic?t.$close(i.model):mabp.notify.error("请填写主题")};i.cancel=function(){t.$close(!1)}}])})();
/**** container.js *****/
(function(){_shared.controller("app.shared.datamodule",["$stateParams","$compile","$scope","formHelper","$rootScope",function(n,t,i,r,u){var f=this,e,o;f.pageInfo=n;f.pageInfo.close=function(){i.$close()};e=i.base=r.buildBasicDataBase(f.pageInfo);o=i.form=r.buildBasicDataForm(i,e);r.basicDataStart(e,o,i,u)}])})();
/**** moduleTransfer.js *****/
_shared.service("basicDataModuleTransfer",["asdialog","dialog","mabp.app.module","appSession","$state","$rootScope",function(n,t,i,r,u,f){function e(n){u.go("my.datamodule",{moduleId:n.id})}function s(n){window.open("/BasicData/BasicDataModule?moduleId={0}".fill(n.id))}function h(n){var t=$.Deferred();return n.openType===0?f.basicDataGlobalOpenType==="1"?e(n):f.basicDataGlobalOpenType==="2"?(s(n),t.resolve(!0)):e(n):n.openType===1?e(n):n.openType===2?(s(n),t.resolve(!0)):e(n),t.promise()}var o={};return o.open=function(n){return h(n)},o}]);
/**** container.js *****/
(function(){_shared.controller("app.shared.reportmodule",["mabp.app.module","mabp.app.task","$stateParams","$compile","$scope","$timeout","formHelper","$rootScope",function(n,t,i,r,u,f,e,o){var s=this,h,c;s.pageInfo=i;s.pageInfo.close=function(){u.$close()};h=u.base=e.buildReportBase(s.pageInfo);c=u.form=e.buildReportForm(u);e.reportStart(h,c,u,o)}])})();
/**** moduleTransfer.js *****/
_shared.service("reportModuleTransfer",["asdialog","dialog","mabp.app.module","appSession","$state","$rootScope",function(n,t,i,r,u,f){function e(n){u.go("my.reportmodule",{moduleId:n.id})}function s(n){window.open("/Report/ReportModule?moduleId={0}".fill(n.id))}function h(n){var t=$.Deferred();return n.openType===0?f.reportGlobalOpenType==="1"?e(n):f.reportGlobalOpenType==="2"?(s(n),t.resolve(!0)):e(n):n.openType===1?e(n):n.openType===2?(s(n),t.resolve(!0)):e(n),t.promise()}var o={};return o.open=function(n){return h(n)},o}]);
/**** container.js *****/
(function(){var n=_shared.dialogs.define("moduleManagement","/App/_shared_mobile/module/workflow/container.html");_shared.controller(n,["mabp.app.module","mabp.app.task","params","$compile","$scope","$timeout","formHelper","$rootScope",function(n,t,i,r,u,f,e,o){var s=this,h,c;s.pageInfo=i;s.pageInfo.close=function(){u.$close()};s.pageInfo.isPrint=!1;h=u.base=e.buildBase(s.pageInfo);console.log("taskId:"+h.taskId);c=u.form=e.buildForm(u);e.pageStart(h,c,u,o)}])})();
/**** handledNode.select.js *****/
(function(){var n=_shared.dialogs.define("handledNodeSelect","/App/_shared_mobile/module/workflow/handledNode.select.html");_shared.controller(n,["params","$scope","dialog",function(n,t){var i=this;i.models=n;i.save=function(){i.selectNodeId?t.$close(i.selectNodeId):mabp.notify.warn("请选择一个节点！")};i.select=function(n){i.selectNodeId=n.id};i.cancel=function(){t.$close(!1)}}])})();
/**** moduleTransfer.js *****/
_shared.service("workflowModuleTransfer",["asdialog","dialog","mabp.app.module","mabp.app.bpm","appSession","$rootScope",function(n,t,i,r,u,f){function s(n,i){t.open(_shared.dialogs.moduleManagement,n).then(function(){i.resolve(!0)})}function h(n){mabp.openWin("/SysPages/AppPage?nodeId={0}&pageId={1}&jobId={2}&taskId={3}&procId={4}&draftId={5}&areaCode={6}&topic={7}&isWaiting={8}".fill(n.nodeId,n.pageId,n.jobId,n.taskId,n.procId,n.draftId,n.areaCode,n.topic,n.isWaiting),n.reloadTasks)}function o(n,t,i,r){var u=$.Deferred();return n.pageId=t,n.nodeId=i,!r||(n.jobId=r.applicantJobId,n.applicantJobId=r.applicantJobId,n.taskId=r.taskId,n.draftId=r.draftId,n.procId=r.procId,n.nextProcId=r.nextProcId,n.sn=r.sn,n.areaCode=r.areaCode,n.creationTime=r.creationTime,n.nodeType=r.nodeType,n.topic=r.topic,n.isWaiting=r.isWaiting,n.reloadTasks=r.reloadTasks),r!=null&&r.createByJobId!=null&&(n.jobId=r.createByJobId,n.applicantJobId=r.createByJobId),r!=null?r.openType===0?f.workflowGlobalOpenType==="1"?s(n,u):f.workflowGlobalOpenType==="2"?(h(n),u.resolve(!0)):s(n,u):r.openType===1?s(n,u):r.openType===2?(h(n),u.resolve(!0)):s(n,u):(h(n),u.resolve(!0)),u.promise()}var e={};return e.raise=function(n,i,f){var e=$.Deferred();return r.getUserJobs().then(function(r){var s={};if(!u.telephone||u.telephone=="0")return mabp.notify.error("请先完善个人中心的联系方式"),e.resolve(!1),e.promise();(r==null||r.length===0)&&(mabp.notify.error("没有身份,无法发起流程"),e.resolve(!1));r.length>1?t.open(_shared.dialogs.jobSelect,r).then(function(t){t&&(s.jobId=t,s.applicantJobId=t,o(s,n,i,f).then(function(n){e.resolve(n)}))}).always(function(){e.resolve(!1)}):(s.jobId=r[0].jobId,s.applicantJobId=r[0].jobId,o(s,n,i,f).then(function(n){e.resolve(n)}))}),e.promise()},e.openDraft=function(n,t,i,r){var f=$.Deferred(),u={};return u.jobId=i[0].jobId,u.applicantJobId=i[0].jobId,o(u,n,t,r).then(function(n){f.resolve(n)}),f.promise()},e.approve=function(n,t,i){var r=$.Deferred();return o({},n,t,i).then(function(n){r.resolve(n)}),r.promise()},e.checkout=function(n,t,i){var r=$.Deferred();return o({},n,t,i).then(function(n){r.resolve(n)}),r.promise()},e}]);
/**** raiseJob.select.js *****/
(function(){var n=_shared.dialogs.define("jobSelect","/App/_shared_mobile/module/workflow/raiseJob.select.html");_shared.controller(n,["$scope","dialog",function(n){var t=this;t.selectJobId=null;t.models=n.models||[];t.isCheck=function(n){for(var i=0;i<t.models.length;i++)return console.log(t.models[i].jobId,n.jobId),n&&t.models[i].jobId===n.jobId};t.save=function(){t.selectJobId?n.$close(t.selectJobId):mabp.notify.warn("请选择一个岗位！")};t.select=function(n){t.selectJobId=n.jobId};t.select(t.models[0]);t.cancel=function(){n.$close(!1)}}])})();
